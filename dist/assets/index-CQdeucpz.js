(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();class m{constructor(t,e,s,i){this.x=t,this.y=e,this.radius=s,this.color=i;const a=i.hp;this.maxHp=Math.floor(a+Math.random()*a*.5),this.currentHp=this.maxHp}flashTime=0;flashDuration=.15;currentHp;maxHp;breakAnimTime=0;breakAnimDuration=.4;static getRandomColor(){const t=[{fill:"#ff4444",stroke:"#cc0000",hp:100},{fill:"#ff8800",stroke:"#cc6600",hp:100},{fill:"#ffdd00",stroke:"#ccaa00",hp:100},{fill:"#88ff00",stroke:"#66cc00",hp:100},{fill:"#00ff88",stroke:"#00cc66",hp:100},{fill:"#0088ff",stroke:"#0066cc",hp:100},{fill:"#8800ff",stroke:"#6600cc",hp:100},{fill:"#ff0088",stroke:"#cc0066",hp:100},{fill:"#ff6600",stroke:"#cc4400",hp:100},{fill:"#ffaa00",stroke:"#cc8800",hp:100},{fill:"#00ffff",stroke:"#00cccc",hp:100},{fill:"#ff00ff",stroke:"#cc00cc",hp:100},{fill:"#66ff66",stroke:"#44cc44",hp:100},{fill:"#ff6666",stroke:"#cc4444",hp:100},{fill:"#6666ff",stroke:"#4444cc",hp:100}];return t[Math.floor(Math.random()*t.length)]}static createRandom(t,e,s,i){const a=m.getRandomColor(),r={...a,hp:Math.floor(a.hp*(1+i*.3))};return new m(t,e,s,r)}isPointInside(t){const e=t.x-this.x,s=t.y-this.y;return Math.sqrt(e*e+s*s)<=this.radius}takeDamage(t){return this.currentHp=Math.max(0,this.currentHp-t),this.triggerFlash(),this.currentHp<=0?(this.breakAnimTime=this.breakAnimDuration,!0):!1}triggerFlash(){this.flashTime=this.flashDuration}isBreaking(){return this.breakAnimTime>0}update(t){this.flashTime>0&&(this.flashTime=Math.max(0,this.flashTime-t)),this.breakAnimTime>0&&(this.breakAnimTime=Math.max(0,this.breakAnimTime-t))}draw(t){if(this.breakAnimTime>0){const r=1-this.breakAnimTime/this.breakAnimDuration,o=1-r,h=1+r*.5;t.setAlpha(o),t.setFill(this.color.fill),t.circle(this.x,this.y,this.radius*h),t.setStroke(this.color.stroke,3),t.circle(this.x,this.y,this.radius*h,!1),t.resetAlpha();return}t.setFill(this.color.fill),t.circle(this.x,this.y,this.radius),t.setStroke(this.color.stroke,2),t.circle(this.x,this.y,this.radius,!1);const e=this.radius*1.5,s=6,i=this.y-this.radius-15,a=this.currentHp/this.maxHp;if(t.setStroke("#fff",1),t.setFill("#000"),t.getContext().fillRect(this.x-e/2,i,e,s),t.getContext().strokeRect(this.x-e/2,i,e,s),t.setFill(this.color.fill),t.getContext().fillRect(this.x-e/2+1,i+1,(e-2)*a,s-2),this.flashTime>0){const r=this.flashTime/this.flashDuration;t.setAlpha(r*.5),t.setStroke("#fff",3);const o=this.radius*(1+(1-r)*.3);t.circle(this.x,this.y,o,!1),t.resetAlpha()}}}class S{constructor(t,e,s,i){this.radius=s,this.x=t,this.y=e,this.maxHp=i,this.currentHp=this.maxHp;const a=Math.random()*Math.PI*2;this.vx=Math.cos(a)*this.speed,this.vy=Math.sin(a)*this.speed}flashTime=0;flashDuration=.15;currentHp;maxHp;breakAnimTime=0;breakAnimDuration=.6;x;y;vx=0;vy=0;speed=150;attackTimer=0;attackCooldown=2;phase=1;isPointInside(t){const e=t.x-this.x,s=t.y-this.y;return Math.sqrt(e*e+s*s)<=this.radius}takeDamage(t){return this.currentHp=Math.max(0,this.currentHp-t),this.triggerFlash(),this.currentHp<=0?(this.breakAnimTime=this.breakAnimDuration,!0):!1}triggerFlash(){this.flashTime=this.flashDuration}isBreaking(){return this.breakAnimTime>0}update(t,e,s){if(this.flashTime>0&&(this.flashTime=Math.max(0,this.flashTime-t)),this.breakAnimTime>0){this.breakAnimTime=Math.max(0,this.breakAnimTime-t);return}const i=this.currentHp/this.maxHp;i<.33?(this.phase=3,this.speed=250,this.attackCooldown=.8):i<.66&&(this.phase=2,this.speed=200,this.attackCooldown=1.2),this.x+=this.vx*t,this.y+=this.vy*t,(this.x-this.radius<0||this.x+this.radius>e)&&(this.vx*=-1,this.x=Math.max(this.radius,Math.min(e-this.radius,this.x))),(this.y-this.radius<0||this.y+this.radius>s)&&(this.vy*=-1,this.y=Math.max(this.radius,Math.min(s-this.radius,this.y))),this.attackTimer+=t}shouldAttack(){return this.attackTimer>=this.attackCooldown?(this.attackTimer=0,!0):!1}getPhase(){return this.phase}getAttackPattern(){return this.phase===3?"spiral":this.phase===2?"spread":"single"}draw(t){if(this.breakAnimTime>0){const h=1-this.breakAnimTime/this.breakAnimDuration,c=1-h,n=1+h*.8;t.setAlpha(c),t.setFill("#fff"),t.circle(this.x,this.y,this.radius*n),t.setStroke("#fff",4),t.circle(this.x,this.y,this.radius*n,!1),t.resetAlpha();return}t.setFill("#fff"),t.circle(this.x,this.y,this.radius),t.setStroke("#fff",3),t.circle(this.x,this.y,this.radius,!1);const e=this.radius*.3,s=this.radius*.15;t.setFill("#000"),t.circle(this.x-e,this.y-e*.5,s),t.circle(this.x+e,this.y-e*.5,s);const i=this.radius*2,a=10,r=this.y-this.radius-20,o=this.currentHp/this.maxHp;if(t.setStroke("#fff",2),t.setFill("#000"),t.getContext().fillRect(this.x-i/2,r,i,a),t.getContext().strokeRect(this.x-i/2,r,i,a),t.setFill("#fff"),t.getContext().fillRect(this.x-i/2+2,r+2,(i-4)*o,a-4),this.flashTime>0){const h=this.flashTime/this.flashDuration;t.setAlpha(h*.6),t.setStroke("#fff",4);const c=this.radius*(1+(1-h)*.4);t.circle(this.x,this.y,c,!1),t.resetAlpha()}}getPosition(){return{x:this.x,y:this.y}}}class y{x;y;vx;vy;radius=8;lifetime=5;age=0;constructor(t,e,s,i,a){this.x=t,this.y=e;const r=s-t,o=i-e,h=Math.sqrt(r*r+o*o);this.vx=r/h*a,this.vy=o/h*a}update(t){return this.x+=this.vx*t*60,this.y+=this.vy*t*60,this.age+=t,this.age>=this.lifetime}draw(t){const e=Math.max(0,1-this.age/this.lifetime);t.setAlpha(e),t.setFill("#ff0000"),t.circle(this.x,this.y,this.radius,!0),t.setFill("#ff6666"),t.circle(this.x,this.y,this.radius*.5,!0),t.resetAlpha()}getPosition(){return{x:this.x,y:this.y}}getRadius(){return this.radius}checkCollision(t,e){const s=this.x-t.x,i=this.y-t.y;return Math.sqrt(s*s+i*i)<this.radius+e}}class M{constructor(t,e,s,i,a=!1){this.angle=t,this.centerX=e,this.centerY=s,this.orbitRadius=i,this.isMainShip=a,this.updatePosition()}x=0;y=0;updatePosition(){this.x=this.centerX+Math.cos(this.angle)*this.orbitRadius,this.y=this.centerY+Math.sin(this.angle)*this.orbitRadius}rotate(t,e=.5){this.angle+=e*t,this.updatePosition()}setOrbit(t,e,s){this.centerX=t,this.centerY=e,this.orbitRadius=s,this.updatePosition()}getPosition(){return{x:this.x,y:this.y}}getFrontPosition(){const t=this.isMainShip?12:8;return{x:this.x+Math.cos(this.angle+Math.PI)*t,y:this.y+Math.sin(this.angle+Math.PI)*t}}draw(t){const e=this.isMainShip?12:8,s=this.x+Math.cos(this.angle+Math.PI)*e,i=this.y+Math.sin(this.angle+Math.PI)*e,a={x:this.x+Math.cos(this.angle+Math.PI*.7)*e*.6,y:this.y+Math.sin(this.angle+Math.PI*.7)*e*.6},r={x:this.x+Math.cos(this.angle+Math.PI*1.3)*e*.6,y:this.y+Math.sin(this.angle+Math.PI*1.3)*e*.6};if(this.isMainShip){t.setStroke("#fff",2),t.triangle({x:s,y:i},a,r,!1),t.setFill("#fff");const o=e*.5,h=this.x+Math.cos(this.angle+Math.PI)*o,c=this.y+Math.sin(this.angle+Math.PI)*o,n={x:this.x+Math.cos(this.angle+Math.PI*.75)*o*.6,y:this.y+Math.sin(this.angle+Math.PI*.75)*o*.6},p={x:this.x+Math.cos(this.angle+Math.PI*1.25)*o*.6,y:this.y+Math.sin(this.angle+Math.PI*1.25)*o*.6};t.triangle({x:h,y:c},n,p)}else t.setFill("#fff"),t.triangle({x:s,y:i},a,r)}}class w{x;y;vx=0;vy=0;angle=-Math.PI/2;rotationSpeed=4;acceleration=300;maxSpeed=250;friction=.98;constructor(t,e){this.x=t,this.y=e}rotate(t,e){this.angle+=t*this.rotationSpeed*e}thrust(t){this.vx+=Math.cos(this.angle)*this.acceleration*t,this.vy+=Math.sin(this.angle)*this.acceleration*t;const e=Math.sqrt(this.vx*this.vx+this.vy*this.vy);e>this.maxSpeed&&(this.vx=this.vx/e*this.maxSpeed,this.vy=this.vy/e*this.maxSpeed)}update(t,e,s){this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx*t,this.y+=this.vy*t,this.x<0&&(this.x=e),this.x>e&&(this.x=0),this.y<0&&(this.y=s),this.y>s&&(this.y=0)}getFrontPosition(){return{x:this.x+Math.cos(this.angle)*15,y:this.y+Math.sin(this.angle)*15}}getPosition(){return{x:this.x,y:this.y}}getAngle(){return this.angle}draw(t){const s=this.x+Math.cos(this.angle)*15,i=this.y+Math.sin(this.angle)*15,a={x:this.x+Math.cos(this.angle+Math.PI*2.5/3)*15*.7,y:this.y+Math.sin(this.angle+Math.PI*2.5/3)*15*.7},r={x:this.x+Math.cos(this.angle+Math.PI*3.5/3)*15*.7,y:this.y+Math.sin(this.angle+Math.PI*3.5/3)*15*.7};t.setStroke("#fff",2),t.triangle({x:s,y:i},a,r,!1);const o=Math.sqrt(this.vx*this.vx+this.vy*this.vy);if(o>50){const h=o/this.maxSpeed*15*.5,c=this.x-Math.cos(this.angle)*15*.3,n=this.y-Math.sin(this.angle)*15*.3,p=c-Math.cos(this.angle)*h,f=n-Math.sin(this.angle)*h;t.setStroke("#fff",1),t.line(c,n,p,f)}}}class C{canvas;ctx;dpr;constructor(t){this.canvas=t;const e=this.canvas.getContext("2d");if(!e)throw new Error("Failed to get 2D context");this.ctx=e,this.dpr=window.devicePixelRatio||1,this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){const t=this.canvas.getBoundingClientRect();this.canvas.width=t.width*this.dpr,this.canvas.height=t.height*this.dpr,this.ctx.scale(this.dpr,this.dpr)}getContext(){return this.ctx}getWidth(){return this.canvas.width/this.dpr}getHeight(){return this.canvas.height/this.dpr}getCenterX(){return this.getWidth()/2}getCenterY(){return this.getHeight()/2}clear(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore()}}class T{constructor(t){this.ctx=t}getContext(){return this.ctx}circle(t,e,s,i=!0){this.ctx.beginPath(),this.ctx.arc(t,e,s,0,Math.PI*2),i?this.ctx.fill():this.ctx.stroke()}line(t,e,s,i){this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(s,i),this.ctx.stroke()}setStroke(t,e=1){this.ctx.strokeStyle=t,this.ctx.lineWidth=e}setFill(t){this.ctx.fillStyle=t}setAlpha(t){this.ctx.globalAlpha=t}resetAlpha(){this.ctx.globalAlpha=1}triangle(t,e,s,i=!0){this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(e.x,e.y),this.ctx.lineTo(s.x,s.y),this.ctx.closePath(),i?this.ctx.fill():this.ctx.stroke()}}class P{constructor(t,e){this.update=t,this.render=e}running=!1;lastTime=0;accumulator=0;fixedDt=1/60;start(){this.running||(this.running=!0,this.lastTime=performance.now(),this.loop(this.lastTime))}stop(){this.running=!1}loop=t=>{if(!this.running)return;const e=Math.min((t-this.lastTime)/1e3,.1);for(this.lastTime=t,this.accumulator+=e;this.accumulator>=this.fixedDt;)this.update(this.fixedDt),this.accumulator-=this.fixedDt;this.render(),requestAnimationFrame(this.loop)}}class U{constructor(t){this.canvas=t,this.setupListeners()}clickHandlers=[];setupListeners(){this.canvas.addEventListener("click",this.handleClick),this.canvas.addEventListener("touchstart",this.handleTouch,{passive:!1})}handleClick=t=>{const e=this.getCanvasPosition(t.clientX,t.clientY);this.clickHandlers.forEach(s=>s(e))};handleTouch=t=>{if(t.preventDefault(),t.touches.length>0){const e=t.touches[0];if(e){const s=this.getCanvasPosition(e.clientX,e.clientY);this.clickHandlers.forEach(i=>i(s))}}};getCanvasPosition(t,e){const s=this.canvas.getBoundingClientRect(),i=this.canvas.width/s.width,a=this.canvas.height/s.height;return{x:(t-s.left)*i,y:(e-s.top)*a}}onClick(t){this.clickHandlers.push(t)}destroy(){this.canvas.removeEventListener("click",this.handleClick),this.canvas.removeEventListener("touchstart",this.handleTouch)}}class L{state;listeners=[];constructor(t){this.state={...t}}getState(){return{...this.state}}setState(t){this.state={...this.state,...t},this.notifyListeners()}addPoints(t){this.state.points+=t,this.notifyListeners()}spendPoints(t){return this.state.points>=t?(this.state.points-=t,this.notifyListeners(),!0):!1}subscribe(t){return this.listeners.push(t),()=>{this.listeners=this.listeners.filter(e=>e!==t)}}notifyListeners(){this.listeners.forEach(t=>t())}}function u(l,t,e){return Math.max(t,Math.min(e,l))}const v="alien-clicker-save";class d{static save(t){const e={points:t.points,shipsCount:t.shipsCount,attackSpeedLevel:t.attackSpeedLevel,autoFireUnlocked:t.autoFireUnlocked,pointMultiplierLevel:t.pointMultiplierLevel,level:t.level,experience:t.experience,subUpgrades:t.subUpgrades};try{localStorage.setItem(v,JSON.stringify(e))}catch(s){console.error("Failed to save:",s)}}static load(){try{const t=localStorage.getItem(v);if(t){const e=JSON.parse(t);return d.validate(e)}}catch(t){console.error("Failed to load save:",t)}return d.getDefault()}static clear(){try{localStorage.removeItem(v)}catch(t){console.error("Failed to clear save:",t)}}static validate(t){return{points:u(t.points??0,0,1e15),shipsCount:u(t.shipsCount??1,1,1e3),attackSpeedLevel:u(t.attackSpeedLevel??0,0,1e3),autoFireUnlocked:t.autoFireUnlocked??!1,pointMultiplierLevel:u(t.pointMultiplierLevel??0,0,1e3),level:u(t.level??1,1,1e4),experience:u(t.experience??0,0,1e15),subUpgrades:t.subUpgrades??{}}}static getDefault(){return{points:0,shipsCount:1,attackSpeedLevel:0,autoFireUnlocked:!1,pointMultiplierLevel:0,level:1,experience:0,subUpgrades:{}}}}class E{constructor(t,e,s,i){this.origin=t,this.target=e,this.damage=s,i&&(this.isCrit=i.isCrit??!1,this.color=i.color??"#fff",this.width=i.width??2)}alive=!0;travelTime=.3;fadeTime=.15;age=0;hasHit=!1;damage;isCrit=!1;color="#fff";width=2;update(t){this.age+=t,this.age>=this.travelTime+this.fadeTime&&(this.alive=!1)}getCurrentPosition(){if(this.age>=this.travelTime)return this.target;const t=Math.min(1,this.age/this.travelTime);return{x:this.origin.x+(this.target.x-this.origin.x)*t,y:this.origin.y+(this.target.y-this.origin.y)*t}}checkHit(){return this.hasHit?!1:this.age>=this.travelTime?(this.hasHit=!0,!0):!1}draw(t){if(!this.alive)return;const e=this.getCurrentPosition();let s=1;this.age>this.travelTime&&(s=1-(this.age-this.travelTime)/this.fadeTime),t.setAlpha(s),t.setStroke(this.color,this.width),t.line(this.origin.x,this.origin.y,e.x,e.y),this.isCrit&&(t.setStroke(this.color,this.width+4),t.setAlpha(s*.3),t.line(this.origin.x,this.origin.y,e.x,e.y),t.setAlpha(s)),t.setFill(this.color),t.circle(e.x,e.y,this.isCrit?5:3),t.resetAlpha()}}class A{lasers=[];spawnLaser(t,e,s,i){this.lasers.push(new E(t,e,s,i))}update(t,e){for(const s of this.lasers)s.update(t),e&&s.checkHit()&&e(s.damage);this.lasers=this.lasers.filter(s=>s.alive)}draw(t){for(const e of this.lasers)e.draw(t)}clear(){this.lasers=[]}getLasers(){return this.lasers}}class _{constructor(t,e){this.center=t,this.maxRadius=e}alive=!0;lifespan=.5;age=0;maxRadius;update(t){this.age+=t,this.age>=this.lifespan&&(this.alive=!1)}draw(t){if(!this.alive)return;const e=this.age/this.lifespan,s=this.maxRadius*e,i=(1-e)*.8,a=Math.floor(255*.7);t.setAlpha(i),t.setStroke(`rgb(${a},${a},${a})`,2),t.circle(this.center.x,this.center.y,s,!1),t.resetAlpha()}}class B{ripples=[];spawnRipple(t,e){this.ripples.push(new _(t,e))}update(t){for(const e of this.ripples)e.update(t);this.ripples=this.ripples.filter(e=>e.alive)}draw(t){for(const e of this.ripples)e.draw(t)}clear(){this.ripples=[]}}class F{basePoints=1;subUpgrades=[];constructor(){this.initializeSubUpgrades()}initializeSubUpgrades(){this.subUpgrades=[{id:"death_pact",name:"Death Pact Agreement",description:"Ships gain +10% attack speed",flavor:"In space, no one can hear you sign contracts.",cost:500,owned:!1,requires:t=>t.shipsCount>=3,isVisible:t=>t.shipsCount>=3,buy:t=>{t.subUpgrades.death_pact=!0}},{id:"laser_focusing",name:"Laser Focusing Crystals",description:"Increase point gain by 15%",flavor:"These crystals are definitely not from that one forbidden planet...",cost:1e3,owned:!1,requires:t=>t.pointMultiplierLevel>=5,isVisible:t=>t.pointMultiplierLevel>=5,buy:t=>{t.subUpgrades.laser_focusing=!0}},{id:"quantum_targeting",name:"Quantum Targeting Array",description:"Ships fire 20% faster",flavor:"Aims at where the target was, is, and will be simultaneously.",cost:2500,owned:!1,requires:t=>t.attackSpeedLevel>=10,isVisible:t=>t.attackSpeedLevel>=10,buy:t=>{t.subUpgrades.quantum_targeting=!0}},{id:"energy_recycling",name:"Energy Recycling System",description:"All upgrades are 5% cheaper",flavor:"Reduce, reuse, recycle... plasma.",cost:5e3,owned:!1,requires:t=>t.shipsCount>=10,isVisible:t=>t.shipsCount>=10,buy:t=>{t.subUpgrades.energy_recycling=!0}},{id:"overclocked_reactors",name:"Overclocked Reactors",description:"Gain 25% more points per hit",flavor:"Safety protocols are just suggestions anyway.",cost:1e4,owned:!1,requires:t=>t.level>=10,isVisible:t=>t.level>=10,buy:t=>{t.subUpgrades.overclocked_reactors=!0}},{id:"ship_swarm",name:"Swarm Intelligence Protocol",description:"Ships coordinate attacks for +20% damage",flavor:"The hivemind accepts all. Resistance is futile.",cost:15e3,owned:!1,requires:t=>t.shipsCount>=15,isVisible:t=>t.shipsCount>=15,buy:t=>{t.subUpgrades.ship_swarm=!0}},{id:"neural_link",name:"Neural Link Interface",description:"Clicking grants 10% bonus points",flavor:"Think faster, click harder.",cost:25e3,owned:!1,requires:t=>t.level>=20,isVisible:t=>t.level>=20,buy:t=>{t.subUpgrades.neural_link=!0}},{id:"antimatter_rounds",name:"Antimatter Ammunition",description:"Double all point gains",flavor:"What could possibly go wrong with weaponized antimatter?",cost:5e4,owned:!1,requires:t=>t.pointMultiplierLevel>=20,isVisible:t=>t.pointMultiplierLevel>=20,buy:t=>{t.subUpgrades.antimatter_rounds=!0}},{id:"warp_core",name:"Experimental Warp Core",description:"Ships fire 50% faster",flavor:"Theoretical physics becomes practical firepower.",cost:75e3,owned:!1,requires:t=>t.attackSpeedLevel>=25,isVisible:t=>t.attackSpeedLevel>=25,buy:t=>{t.subUpgrades.warp_core=!0}},{id:"ai_optimizer",name:"AI Optimization Subroutines",description:"Auto-fire cooldown reduced by 30%",flavor:"The AI promises it won't become self-aware. Probably.",cost:1e5,owned:!1,requires:t=>t.autoFireUnlocked&&t.attackSpeedLevel>=30,isVisible:t=>t.autoFireUnlocked&&t.attackSpeedLevel>=30,buy:t=>{t.subUpgrades.ai_optimizer=!0}},{id:"perfect_precision",name:"Perfect Precision Arrays",description:"Critical hits: 5% chance for 10x damage",flavor:"Every shot finds its mark. Every. Single. One.",cost:15e4,owned:!1,requires:t=>t.shipsCount>=25,isVisible:t=>t.shipsCount>=25,buy:t=>{t.subUpgrades.perfect_precision=!0}},{id:"void_channeling",name:"Void Energy Channeling",description:"Destroying aliens grants bonus XP",flavor:"The void stares back, and it likes what it sees.",cost:2e5,owned:!1,requires:t=>t.level>=40,isVisible:t=>t.level>=40,buy:t=>{t.subUpgrades.void_channeling=!0}},{id:"temporal_acceleration",name:"Temporal Acceleration Field",description:"All ships gain +100% attack speed",flavor:"Time is relative. Especially when you control it.",cost:5e5,owned:!1,requires:t=>t.level>=60,isVisible:t=>t.level>=60,buy:t=>{t.subUpgrades.temporal_acceleration=!0}},{id:"singularity_core",name:"Singularity Power Core",description:"Gain 5x points from all sources",flavor:"A black hole in a box. What could be safer?",cost:1e6,owned:!1,requires:t=>t.level>=80,isVisible:t=>t.level>=80,buy:t=>{t.subUpgrades.singularity_core=!0}},{id:"cosmic_ascension",name:"Cosmic Ascension Protocol",description:"Unlock ultimate power: 10x all gains",flavor:"You have become death, destroyer of alien balls.",cost:1e7,owned:!1,requires:t=>t.level>=95,isVisible:t=>t.level>=95,buy:t=>{t.subUpgrades.cosmic_ascension=!0}}]}getSubUpgrades(){return this.subUpgrades.map(t=>({...t,owned:t.owned}))}updateSubUpgradesFromState(t){for(const e of this.subUpgrades)e.owned=t.subUpgrades[e.id]??!1}getUpgrades(){const t={id:"auto_fire",name:"Auto-Fire Module",description:"Ships automatically fire without clicking.",flavor:"Let the machines do the work.",cost:150,owned:!1,requires:n=>n.shipsCount>=1,isVisible:n=>n.shipsCount>=1&&!n.autoFireUnlocked,buy:n=>{n.autoFireUnlocked=!0,n.subUpgrades.auto_fire=!0}};t.owned=this.subUpgrades.find(n=>n.id==="auto_fire")?.owned??!1;const e=[t,...this.subUpgrades.filter(n=>["death_pact","ship_swarm","perfect_precision"].includes(n.id))],s=this.subUpgrades.filter(n=>["quantum_targeting","warp_core","ai_optimizer","temporal_acceleration"].includes(n.id)),i=this.subUpgrades.filter(n=>["laser_focusing","overclocked_reactors","neural_link","antimatter_rounds","singularity_core","cosmic_ascension"].includes(n.id)),a=this.subUpgrades.filter(n=>["energy_recycling","void_channeling"].includes(n.id));return[{id:"ship",name:"🚀 Starship Fleet",description:"Recruit another starship to your armada. More ships = more firepower!",getCost:n=>this.applyDiscount(Math.ceil(10*Math.pow(1.15,n))),canBuy:n=>{const p=this.applyDiscount(Math.ceil(10*Math.pow(1.15,n.shipsCount)));return n.points>=p},buy:n=>{n.shipsCount++},getLevel:n=>n.shipsCount,getDisplayText:n=>`Fleet: ${n.shipsCount.toString()}`,subUpgrades:e},{id:"attackSpeed",name:"⚡ Attack Speed",description:"Upgrade targeting computers to fire faster. Speed is everything.",getCost:n=>this.applyDiscount(Math.ceil(50*Math.pow(1.25,n))),canBuy:n=>{const p=this.applyDiscount(Math.ceil(50*Math.pow(1.25,n.attackSpeedLevel)));return n.points>=p},buy:n=>{n.attackSpeedLevel++},getLevel:n=>n.attackSpeedLevel,getDisplayText:n=>`Lv.${n.attackSpeedLevel.toString()} (${this.getFireCooldown(n).toString()}ms)`,subUpgrades:s},{id:"pointMultiplier",name:"💎 Damage Amplifier",description:"Enhance laser power for maximum destruction per hit.",getCost:n=>this.applyDiscount(Math.ceil(100*Math.pow(1.3,n))),canBuy:n=>{const p=this.applyDiscount(Math.ceil(100*Math.pow(1.3,n.pointMultiplierLevel)));return n.points>=p},buy:n=>{n.pointMultiplierLevel++},getLevel:n=>n.pointMultiplierLevel,getDisplayText:n=>`Lv.${n.pointMultiplierLevel.toString()} (${this.getPointsPerHit(n).toFixed(1)}/hit)`,subUpgrades:i},{id:"misc",name:"🔬 Research & Development",description:"Unlock experimental technologies and forbidden knowledge.",getCost:()=>0,canBuy:()=>!1,buy:()=>{},getLevel:()=>0,getDisplayText:()=>"Special Technologies",subUpgrades:a}]}applyDiscount(t){return this.subUpgrades.find(e=>e.id==="energy_recycling")?.owned?Math.floor(t*.95):t}getPointsPerHit(t){this.updateSubUpgradesFromState(t);let e=this.basePoints*(1+.15*t.pointMultiplierLevel);return t.subUpgrades.laser_focusing&&(e*=1.15),t.subUpgrades.overclocked_reactors&&(e*=1.25),t.subUpgrades.ship_swarm&&(e*=1.2),t.subUpgrades.neural_link&&(e*=1.1),t.subUpgrades.antimatter_rounds&&(e*=2),t.subUpgrades.singularity_core&&(e*=5),t.subUpgrades.cosmic_ascension&&(e*=10),t.subUpgrades.perfect_precision&&Math.random()<.05&&(e*=10),e}getFireCooldown(t){this.updateSubUpgradesFromState(t);let e=Math.max(Math.floor(1e3*Math.pow(.95,t.attackSpeedLevel)),120);return t.subUpgrades.death_pact&&(e*=.9),t.subUpgrades.quantum_targeting&&(e*=.8),t.subUpgrades.warp_core&&(e*=.67),t.subUpgrades.ai_optimizer&&(e*=.7),t.subUpgrades.temporal_acceleration&&(e*=.5),Math.max(Math.floor(e),50)}getBonusXP(t){this.updateSubUpgradesFromState(t);let e=1;return t.subUpgrades.void_channeling&&(e=2),e}}class D{shipTimers=[];setShipCount(t){for(;this.shipTimers.length<t;)this.shipTimers.push(0);for(;this.shipTimers.length>t;)this.shipTimers.pop()}update(t,e,s,i){if(!e)return;const a=s/1e3;for(let r=0;r<this.shipTimers.length;r++)this.shipTimers[r]+=t,this.shipTimers[r]>=a&&(this.shipTimers[r]=0,i(r))}reset(){this.shipTimers=this.shipTimers.map(()=>0)}}class I{pointsDisplay;levelText;expText;levelBarFill;constructor(){const t=document.getElementById("points-display");if(!t)throw new Error("Points display element not found");this.pointsDisplay=t;const e=document.getElementById("level-text");if(!e)throw new Error("Level text element not found");this.levelText=e;const s=document.getElementById("exp-text");if(!s)throw new Error("Exp text element not found");this.expText=s;const i=document.getElementById("level-bar-fill");if(!i)throw new Error("Level bar fill element not found");this.levelBarFill=i}update(t){this.pointsDisplay.textContent=`Points: ${this.formatNumber(t)}`}updateLevel(t,e,s){this.levelText.textContent=`Level ${t}`,this.expText.textContent=`${Math.floor(e)} / ${s}`;const i=Math.min(100,e/s*100);this.levelBarFill.style.width=`${i}%`}formatNumber(t){return t>=1e9?`${(t/1e9).toFixed(2)}B`:t>=1e6?`${(t/1e6).toFixed(2)}M`:t>=1e3?`${(t/1e3).toFixed(2)}K`:Math.floor(t).toString()}}class H{element;clickHandler;lastClickTime=0;clickDelay=100;constructor(t,e){this.clickHandler=e,this.element=document.createElement("button"),this.element.textContent=t,this.element.className="shop-button",this.element.addEventListener("click",s=>{s.stopPropagation(),this.handleClick()}),this.element.addEventListener("keydown",s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),s.stopPropagation(),this.handleClick())})}handleClick(){const t=Date.now();t-this.lastClickTime<this.clickDelay||this.element.disabled||(this.lastClickTime=t,this.clickHandler())}getElement(){return this.element}setEnabled(t){this.element.disabled=!t}setText(t){this.element.textContent=t}}class R{constructor(t,e){this.store=t,this.upgradeSystem=e;const s=document.getElementById("shop-content");if(!s)throw new Error("Shop content element not found");this.container=s;const i=document.getElementById("shop-panel");i&&(i.addEventListener("click",a=>{a.stopPropagation()}),i.addEventListener("touchstart",a=>{a.stopPropagation()}),i.addEventListener("mousedown",a=>{a.stopPropagation()})),this.setupTabs(),this.render(),this.store.subscribe(()=>{this.scheduleRender()})}container;renderTimeout=null;isRendering=!1;isProcessingPurchase=!1;lastAffordability=new Map;currentTab="available";setupTabs(){const t=document.getElementById("tab-available"),e=document.getElementById("tab-owned");t?.addEventListener("click",()=>{this.currentTab="available",t.classList.add("active"),e?.classList.remove("active"),this.render()}),e?.addEventListener("click",()=>{this.currentTab="owned",e.classList.add("active"),t?.classList.remove("active"),this.render()})}scheduleRender(){this.isProcessingPurchase||this.hasAffordabilityChanged()&&(this.renderTimeout!==null&&clearTimeout(this.renderTimeout),this.renderTimeout=window.setTimeout(()=>{this.render(),this.renderTimeout=null},100))}hasAffordabilityChanged(){const t=this.store.getState(),e=this.upgradeSystem.getUpgrades(),s=this.upgradeSystem.getSubUpgrades();let i=!1;for(const a of e){const r=a.name,o=a.canBuy(t);this.lastAffordability.get(r)!==o&&(i=!0,this.lastAffordability.set(r,o))}for(const a of s){if(!a.isVisible(t))continue;const r=`sub_${a.name}`,o=!a.owned&&t.points>=a.cost;this.lastAffordability.get(r)!==o&&(i=!0,this.lastAffordability.set(r,o))}return i}render(){if(this.isRendering)return;this.isRendering=!0,this.container.innerHTML="";const t=this.store.getState();this.upgradeSystem.updateSubUpgradesFromState(t),this.currentTab==="available"?this.renderAvailableTab(t):this.renderOwnedTab(t),this.isRendering=!1}renderAvailableTab(t){const e=this.upgradeSystem.getUpgrades(),i=this.upgradeSystem.getSubUpgrades().filter(a=>a.isVisible(t)&&!a.owned);if(i.length>0){const a=document.createElement("div");a.className="special-upgrades-box";const r=document.createElement("h3");r.textContent="⭐ SPECIAL UPGRADES ⭐",a.appendChild(r);const o=document.createElement("div");o.className="special-upgrades-grid";for(const h of i){const c=this.createSubUpgradeCard(h,t);o.appendChild(c)}a.appendChild(o),this.container.appendChild(a)}for(const a of e){if(a.id==="misc")continue;const r=document.createElement("div");r.className="upgrade-item";const o=document.createElement("div");o.className="upgrade-header";const h=document.createElement("div");h.className="upgrade-name",h.textContent=a.name;const c=document.createElement("div");c.className="upgrade-level",c.textContent=a.getDisplayText(t),o.appendChild(h),o.appendChild(c);const n=document.createElement("div");n.className="upgrade-description",n.textContent=a.description;const p=document.createElement("div");p.className="upgrade-footer";const f=document.createElement("div");f.className="upgrade-cost";const k=a.getCost(a.getLevel(t));f.textContent=`Cost: ${this.formatNumber(k)}`;const b=new H("BUY",()=>{this.buyUpgrade(a)});b.setEnabled(a.canBuy(t)),p.appendChild(f),p.appendChild(b.getElement()),r.appendChild(o),r.appendChild(n),r.appendChild(p),this.container.appendChild(r)}}renderOwnedTab(t){const s=this.upgradeSystem.getSubUpgrades().filter(a=>a.owned);if(s.length===0){const a=document.createElement("div");a.style.padding="40px",a.style.textAlign="center",a.style.color="#666",a.textContent="No special upgrades owned yet.",this.container.appendChild(a);return}const i=document.createElement("div");i.className="special-upgrades-grid",i.style.padding="10px 0";for(const a of s){const r=this.createSubUpgradeCard(a,t);i.appendChild(r)}this.container.appendChild(i)}createSubUpgradeCard(t,e){const s=document.createElement("div");s.className=`sub-upgrade ${t.owned?"owned":""}`;const i=document.createElement("div");i.className="sub-upgrade-icon",i.textContent=this.getUpgradeEmoji(t.id),s.appendChild(i);const a=document.createElement("div");a.className="sub-upgrade-name",a.textContent=t.name,s.appendChild(a);const r=document.createElement("div");r.className="sub-upgrade-cost",r.textContent=t.owned?"✓ OWNED":`${this.formatNumber(t.cost)}`,s.appendChild(r);const o=document.createElement("div");return o.className="sub-upgrade-tooltip",o.innerHTML=`<strong>${t.name}</strong><br>${t.description}<br><em style="color: #888; font-size: 10px;">${t.flavor}</em>`,s.appendChild(o),t.owned||s.addEventListener("click",()=>{e.points>=t.cost&&this.buySubUpgrade(t)}),s}getUpgradeEmoji(t){return{auto_fire:"🔥",death_pact:"💀",laser_focusing:"💎",quantum_targeting:"🎯",energy_recycling:"♻️",overclocked_reactors:"⚛️",ship_swarm:"🐝",neural_link:"🧠",antimatter_rounds:"💥",warp_core:"🌀",ai_optimizer:"🤖",perfect_precision:"✨",void_channeling:"🌌",temporal_acceleration:"⏰",singularity_core:"🕳️",cosmic_ascension:"🌟"}[t]||"⭐"}buyUpgrade(t){if(this.isProcessingPurchase)return;this.isProcessingPurchase=!0;const e=this.store.getState();if(!t.canBuy(e)){this.isProcessingPurchase=!1;return}const s=t.getCost(t.getLevel(e));e.points>=s&&(e.points-=s,t.buy(e),this.store.setState(e),this.lastAffordability.clear(),this.render()),this.isProcessingPurchase=!1}buySubUpgrade(t){if(this.isProcessingPurchase||t.owned)return;this.isProcessingPurchase=!0;const e=this.store.getState();e.points>=t.cost&&(e.points-=t.cost,t.buy(e),this.store.setState(e),this.lastAffordability.clear(),this.render()),this.isProcessingPurchase=!1}formatNumber(t){return t>=1e9?`${(t/1e9).toFixed(2)}B`:t>=1e6?`${(t/1e6).toFixed(2)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:Math.floor(t).toString()}}class q{constructor(t){this.upgradeSystem=t;const e=document.getElementById("upgrades-display");if(!e)throw new Error("Upgrades display element not found");this.container=e}container;update(t){this.container.innerHTML="",this.upgradeSystem.updateSubUpgradesFromState(t);const s=this.upgradeSystem.getSubUpgrades().filter(i=>i.owned);if(s.length!==0)for(const i of s){const a=document.createElement("div");a.className="upgrade-icon";const r=this.getUpgradeEmoji(i.id);a.textContent=r;const o=document.createElement("div");o.className="tooltip",o.textContent=i.name,a.appendChild(o),this.container.appendChild(a)}}getUpgradeEmoji(t){return{auto_fire:"🔥",death_pact:"💀",laser_focusing:"💎",quantum_targeting:"🎯",energy_recycling:"♻️",overclocked_reactors:"⚛️",ship_swarm:"🐝",neural_link:"🧠",antimatter_rounds:"💥",warp_core:"🌀",ai_optimizer:"🤖",perfect_precision:"✨",void_channeling:"🌌",temporal_acceleration:"⏰",singularity_core:"🕳️",cosmic_ascension:"🌟"}[t]||"⭐"}}class z{static setupResetButton(t){const e=document.getElementById("reset-btn");e&&e.addEventListener("click",()=>{confirm("Are you sure you want to reset all progress? This cannot be undone.")&&t()})}}class g{static colors=[{fill:"#fff",stroke:"#ccc",hp:10},{fill:"#ddd",stroke:"#aaa",hp:20},{fill:"#bbb",stroke:"#888",hp:35},{fill:"#999",stroke:"#666",hp:55},{fill:"#ff4444",stroke:"#cc0000",hp:120},{fill:"#ff8800",stroke:"#cc6600",hp:180},{fill:"#ffdd00",stroke:"#ccaa00",hp:260},{fill:"#88ff00",stroke:"#66cc00",hp:360},{fill:"#00ff88",stroke:"#00cc66",hp:480},{fill:"#0088ff",stroke:"#0066cc",hp:620},{fill:"#8800ff",stroke:"#6600cc",hp:780},{fill:"#ff0088",stroke:"#cc0066",hp:960},{fill:"#ff6600",stroke:"#cc4400",hp:1160},{fill:"#ffaa00",stroke:"#cc8800",hp:1380},{fill:"#00ffff",stroke:"#00cccc",hp:1620},{fill:"#ff00ff",stroke:"#cc00cc",hp:1880},{fill:"#66ff66",stroke:"#44cc44",hp:2160},{fill:"#ff6666",stroke:"#cc4444",hp:2460},{fill:"#6666ff",stroke:"#4444cc",hp:2780},{fill:"#ffff00",stroke:"#cccc00",hp:3120}];static getColorForLevel(t){const e=Math.min(t-1,this.colors.length-1);return this.colors[e]??this.colors[this.colors.length-1]}static getExpRequired(t){return Math.floor(10+t*5)}static isBossLevel(t){return t===100}static getBossHp(t){return Math.floor(5e3*Math.pow(1.5,t/5-1))}}class N{canvas;draw;loop;input;store;ball=null;bossBall=null;ships=[];playerShip=null;bossProjectiles=[];laserSystem;rippleSystem;upgradeSystem;autoFireSystem;hud;upgradesDisplay;saveTimer=0;saveInterval=3;shakeTime=0;shakeAmount=0;mode="normal";transitionTime=0;transitionDuration=2;keys=new Set;shootCooldown=0;shootCooldownMax=.2;constructor(){const t=document.getElementById("game-canvas");if(!t)throw new Error("Canvas not found");this.canvas=new C(t),this.draw=new T(this.canvas.getContext()),this.store=new L(d.load()),this.upgradeSystem=new F,this.laserSystem=new A,this.rippleSystem=new B,this.autoFireSystem=new D,this.hud=new I,this.upgradesDisplay=new q(this.upgradeSystem),new R(this.store,this.upgradeSystem),this.input=new U(t),this.loop=new P(e=>this.update(e),()=>this.render()),this.initGame(),this.setupInput(),this.setupKeyboard(),this.setupAutoSave(),this.setupBossDialog(),z.setupResetButton(()=>this.resetGame())}setupBossDialog(){const t=document.getElementById("boss-start-btn");t&&t.addEventListener("click",()=>{const e=document.getElementById("boss-dialog");e&&(e.style.display="none"),this.startBossFight()})}setupKeyboard(){window.addEventListener("keydown",t=>{this.keys.add(t.key.toLowerCase()),t.key===" "&&this.mode==="boss"&&t.preventDefault()}),window.addEventListener("keyup",t=>{this.keys.delete(t.key.toLowerCase())})}initGame(){this.createBall(),this.createShips();const t=this.store.getState();this.hud.update(t.points),this.hud.updateLevel(t.level,t.experience,g.getExpRequired(t.level)),this.upgradesDisplay.update(t)}createBall(){const t=this.canvas.getCenterX(),e=this.canvas.getCenterY(),s=Math.min(this.canvas.getWidth(),this.canvas.getHeight())*.08,i=this.store.getState();this.ball=m.createRandom(t,e,s,i.level),this.bossBall=null}createBoss(){const t=this.canvas.getCenterX(),e=this.canvas.getCenterY(),s=Math.min(this.canvas.getWidth(),this.canvas.getHeight())*.12,i=this.store.getState(),a=g.getBossHp(i.level);this.bossBall=new S(t,e,s,a),this.ball=null,this.playerShip=new w(t,this.canvas.getHeight()-100)}createShips(){const t=this.store.getState(),e=this.canvas.getCenterX(),s=this.canvas.getCenterY(),i=Math.min(this.canvas.getWidth(),this.canvas.getHeight())*.4;this.ships=[];for(let a=0;a<t.shipsCount;a++){const r=a/t.shipsCount*Math.PI*2,o=a===0;this.ships.push(new M(r,e,s,i,o))}this.autoFireSystem.setShipCount(t.shipsCount)}setupInput(){this.input.onClick(t=>this.handleClick(t)),this.store.subscribe(()=>{const t=this.store.getState();this.ships.length!==t.shipsCount&&this.createShips(),this.hud.update(t.points),this.hud.updateLevel(t.level,t.experience,g.getExpRequired(t.level)),this.upgradesDisplay.update(t)})}setupAutoSave(){window.addEventListener("beforeunload",()=>{d.save(this.store.getState())})}handleClick(t){this.mode!=="transition"&&this.mode==="normal"&&this.ball?.isPointInside(t)&&this.fireVolley()}fireVolley(){const t=this.store.getState(),e=this.upgradeSystem.getPointsPerHit(t),s={x:this.ball?.x??0,y:this.ball?.y??0},i=this.getLaserVisuals(t);for(const a of this.ships)this.laserSystem.spawnLaser(a.getFrontPosition(),s,e,i);this.rippleSystem.spawnRipple(s,(this.ball?.radius??50)*2),this.ships.length>=5&&this.triggerShake(2,.1)}shootLaser(){if(!this.playerShip||this.shootCooldown>0)return;const t=this.store.getState(),e=this.upgradeSystem.getPointsPerHit(t),s=this.playerShip.getFrontPosition(),i=this.playerShip.getAngle(),a=this.getLaserVisuals(t),r=2e3,o={x:s.x+Math.cos(i)*r,y:s.y+Math.sin(i)*r};this.laserSystem.spawnLaser(s,o,e,a),this.shootCooldown=this.shootCooldownMax}fireSingleShip(t){const e=this.ships[t];if(!e)return;const s=this.store.getState(),i=this.upgradeSystem.getPointsPerHit(s),a={x:this.ball?.x??0,y:this.ball?.y??0},r=this.getLaserVisuals(s);this.laserSystem.spawnLaser(e.getFrontPosition(),a,i,r)}getLaserVisuals(t){let e="#fff",s=2,i=!1;return t.subUpgrades.perfect_precision&&Math.random()<.05?(i=!0,e="#ffff00",s=4,{isCrit:i,color:e,width:s}):(t.subUpgrades.cosmic_ascension?(e="#ff00ff",s=3):t.subUpgrades.singularity_core?(e="#8800ff",s=3):t.subUpgrades.antimatter_rounds?(e="#ff0088",s=3):t.subUpgrades.overclocked_reactors?(e="#ff6600",s=2.5):t.subUpgrades.laser_focusing?(e="#00ffff",s=2.5):t.pointMultiplierLevel>=10&&(e="#88ff88",s=2.5),{isCrit:i,color:e,width:s})}handleDamage(t){if(this.mode==="normal"&&this.ball){const e=this.ball.takeDamage(t);this.store.addPoints(t),e&&this.onBallDestroyed()}else if(this.mode==="boss"&&this.bossBall){const e=this.bossBall.takeDamage(t);this.store.addPoints(t*2),e&&this.onBossDestroyed()}}onBallDestroyed(){const t=this.store.getState(),e=this.upgradeSystem.getBonusXP(t);t.experience+=e;const s=g.getExpRequired(t.level);t.experience>=s?(t.experience-=s,t.level++,g.isBossLevel(t.level)?this.showBossDialog():setTimeout(()=>this.createBall(),400)):setTimeout(()=>this.createBall(),400),this.store.setState(t)}onBossDestroyed(){const t=this.store.getState();t.experience=0,t.level++,this.store.setState(t),setTimeout(()=>{this.startTransitionToNormal()},600)}showBossDialog(){const t=document.getElementById("boss-dialog");t&&(t.style.display="flex")}startBossFight(){this.startTransitionToBoss()}startTransitionToBoss(){this.mode="transition",this.transitionTime=0;const t=document.getElementById("boss-controls");t&&(t.style.display="none"),setTimeout(()=>{this.createBoss(),this.mode="boss",t&&(t.style.display="block")},this.transitionDuration*500)}startTransitionToNormal(){this.mode="transition",this.transitionTime=0,this.playerShip=null,this.bossProjectiles=[];const t=document.getElementById("boss-controls");t&&(t.style.display="none"),setTimeout(()=>{this.createBall(),this.mode="normal"},this.transitionDuration*500)}triggerShake(t,e){this.shakeAmount=t,this.shakeTime=e}spawnBossProjectiles(){if(!this.bossBall||!this.playerShip)return;const t=this.bossBall.getPosition(),e=this.playerShip.getPosition(),s=this.bossBall.getAttackPattern(),i=200;if(s==="single")this.bossProjectiles.push(new y(t.x,t.y,e.x,e.y,i));else if(s==="spread"){const a=Math.atan2(e.y-t.y,e.x-t.x),r=Math.PI/6;for(let o=-1;o<=1;o++){const h=a+o*r,c=t.x+Math.cos(h)*1e3,n=t.y+Math.sin(h)*1e3;this.bossProjectiles.push(new y(t.x,t.y,c,n,i))}}else if(s==="spiral")for(let r=0;r<8;r++){const o=r/8*Math.PI*2,h=t.x+Math.cos(o)*1e3,c=t.y+Math.sin(o)*1e3;this.bossProjectiles.push(new y(t.x,t.y,h,c,i*1.2))}}update(t){const e=this.store.getState();if(this.mode==="transition"&&(this.transitionTime+=t,this.transitionTime>=this.transitionDuration&&(this.transitionTime=0)),this.ball?.update(t),this.bossBall?.update(t,this.canvas.getWidth(),this.canvas.getHeight()),this.laserSystem.update(t,s=>this.handleDamage(s)),this.rippleSystem.update(t),this.mode==="normal")for(const s of this.ships)s.rotate(t,.3);this.mode==="boss"&&this.playerShip?((this.keys.has("arrowleft")||this.keys.has("a"))&&this.playerShip.rotate(-1,t),(this.keys.has("arrowright")||this.keys.has("d"))&&this.playerShip.rotate(1,t),(this.keys.has("arrowup")||this.keys.has("w"))&&this.playerShip.thrust(t),(this.keys.has(" ")||this.keys.has("spacebar"))&&this.shootLaser(),this.playerShip.update(t,this.canvas.getWidth(),this.canvas.getHeight()),this.shootCooldown>0&&(this.shootCooldown=Math.max(0,this.shootCooldown-t)),this.bossBall&&this.bossBall.shouldAttack()&&this.spawnBossProjectiles(),this.bossProjectiles=this.bossProjectiles.filter(s=>{const i=s.update(t);if(!i&&this.playerShip){const a=this.playerShip.getPosition();if(s.checkCollision(a,15))return this.triggerShake(3,.1),!0}return!i})):this.mode==="normal"&&this.autoFireSystem.update(t,e.autoFireUnlocked,this.upgradeSystem.getFireCooldown(e),s=>this.fireSingleShip(s)),this.saveTimer+=t,this.saveTimer>=this.saveInterval&&(d.save(e),this.saveTimer=0),this.shakeTime>0&&(this.shakeTime=Math.max(0,this.shakeTime-t))}render(){this.canvas.clear();const t=this.canvas.getContext();if(t.save(),this.shakeTime>0){const e=this.shakeAmount*(this.shakeTime/.1),s=(Math.random()-.5)*e,i=(Math.random()-.5)*e;t.translate(s,i)}if(this.mode==="transition")this.renderTransition();else{if(this.rippleSystem.draw(this.draw),this.ball?.draw(this.draw),this.bossBall?.draw(this.draw),this.mode==="boss"){this.playerShip?.draw(this.draw);for(const e of this.bossProjectiles)e.draw(this.draw)}else for(const e of this.ships)e.draw(this.draw);this.laserSystem.draw(this.draw)}t.restore()}renderTransition(){const t=this.transitionTime/this.transitionDuration,e=Math.sin(t*Math.PI);this.draw.setAlpha(e);const s=this.canvas.getCenterX(),i=this.canvas.getCenterY(),a=Math.max(this.canvas.getWidth(),this.canvas.getHeight());for(let r=0;r<5;r++){const o=a*(t+r*.2);this.draw.setStroke("#fff",2),this.draw.circle(s,i,o,!1)}this.draw.resetAlpha()}start(){this.loop.start()}resetGame(){d.clear(),this.store.setState(d.load()),this.mode="normal",this.createBall(),this.createShips(),this.laserSystem.clear(),this.rippleSystem.clear(),this.autoFireSystem.reset(),this.saveTimer=0}}function x(){new N().start()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",x):x();
//# sourceMappingURL=index-CQdeucpz.js.map
