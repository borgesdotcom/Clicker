(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();class P{constructor(e,t,s,a){this.x=e,this.y=t,this.radius=s,this.color=a;const i=a.hp;this.maxHp=Math.floor(i+Math.random()*i*.5),this.currentHp=this.maxHp}flashTime=0;flashDuration=.15;currentHp;maxHp;breakAnimTime=0;breakAnimDuration=.4;static getRandomColor(){const e=[{fill:"#ff4444",stroke:"#cc0000",hp:100},{fill:"#ff8800",stroke:"#cc6600",hp:100},{fill:"#ffdd00",stroke:"#ccaa00",hp:100},{fill:"#88ff00",stroke:"#66cc00",hp:100},{fill:"#00ff88",stroke:"#00cc66",hp:100},{fill:"#0088ff",stroke:"#0066cc",hp:100},{fill:"#8800ff",stroke:"#6600cc",hp:100},{fill:"#ff0088",stroke:"#cc0066",hp:100},{fill:"#ff6600",stroke:"#cc4400",hp:100},{fill:"#ffaa00",stroke:"#cc8800",hp:100},{fill:"#00ffff",stroke:"#00cccc",hp:100},{fill:"#ff00ff",stroke:"#cc00cc",hp:100},{fill:"#66ff66",stroke:"#44cc44",hp:100},{fill:"#ff6666",stroke:"#cc4444",hp:100},{fill:"#6666ff",stroke:"#4444cc",hp:100}];return e[Math.floor(Math.random()*e.length)]}static createRandom(e,t,s,a){const i=P.getRandomColor();let o;a<=25?o=Math.pow(1.15,a):a<=50?o=Math.pow(1.15,25)*Math.pow(1.22,a-25):a<=75?o=Math.pow(1.15,25)*Math.pow(1.22,25)*Math.pow(1.28,a-50):o=Math.pow(1.15,25)*Math.pow(1.22,25)*Math.pow(1.28,25)*Math.pow(1.35,a-75);const n={...i,hp:Math.floor(i.hp*o)};return new P(e,t,s,n)}isPointInside(e){const t=e.x-this.x,s=e.y-this.y;return Math.sqrt(t*t+s*s)<=this.radius}takeDamage(e){const t=this.currentHp>0;return this.currentHp=Math.max(0,this.currentHp-e),(this.flashTime<=0||e>this.maxHp*.05)&&this.triggerFlash(),this.currentHp<=0&&t?(this.breakAnimTime=this.breakAnimDuration,!0):!1}triggerFlash(){this.flashTime=this.flashDuration}isBreaking(){return this.breakAnimTime>0}update(e){this.flashTime>0&&(this.flashTime=Math.max(0,this.flashTime-e)),this.breakAnimTime>0&&(this.breakAnimTime=Math.max(0,this.breakAnimTime-e))}draw(e){if(this.breakAnimTime>0){const o=1-this.breakAnimTime/this.breakAnimDuration,n=1-o,l=1+o*.5;e.setAlpha(n),e.setFill(this.color.fill),e.circle(this.x,this.y,this.radius*l),e.setStroke(this.color.stroke,3),e.circle(this.x,this.y,this.radius*l,!1),e.resetAlpha();return}e.setFill(this.color.fill),e.circle(this.x,this.y,this.radius),e.setStroke(this.color.stroke,2),e.circle(this.x,this.y,this.radius,!1);const t=this.radius*1.5,s=6,a=this.y-this.radius-15,i=this.currentHp/this.maxHp;if(e.setStroke("#fff",1),e.setFill("#000"),e.getContext().fillRect(this.x-t/2,a,t,s),e.getContext().strokeRect(this.x-t/2,a,t,s),e.setFill(this.color.fill),e.getContext().fillRect(this.x-t/2+1,a+1,(t-2)*i,s-2),this.flashTime>0){const o=this.flashTime/this.flashDuration;e.setAlpha(o*.5),e.setStroke("#fff",3);const n=this.radius*(1+(1-o)*.3);e.circle(this.x,this.y,n,!1),e.resetAlpha()}}}class I{constructor(e,t,s,a){this.radius=s,this.x=e,this.y=t,this.maxHp=a,this.currentHp=this.maxHp;const i=Math.random()*Math.PI*2;this.vx=Math.cos(i)*this.speed,this.vy=Math.sin(i)*this.speed}flashTime=0;flashDuration=.15;currentHp;maxHp;breakAnimTime=0;breakAnimDuration=.6;x;y;vx=0;vy=0;speed=150;attackTimer=0;attackCooldown=2;phase=1;rotationAngle=0;pulseTime=0;chargeTime=0;isPointInside(e){const t=e.x-this.x,s=e.y-this.y;return Math.sqrt(t*t+s*s)<=this.radius}takeDamage(e){const t=this.currentHp>0;return this.currentHp=Math.max(0,this.currentHp-e),(this.flashTime<=0||e>this.maxHp*.02)&&this.triggerFlash(),this.currentHp<=0&&t?(this.breakAnimTime=this.breakAnimDuration,!0):!1}triggerFlash(){this.flashTime=this.flashDuration}isBreaking(){return this.breakAnimTime>0}update(e,t,s){if(this.flashTime>0&&(this.flashTime=Math.max(0,this.flashTime-e)),this.breakAnimTime>0){this.breakAnimTime=Math.max(0,this.breakAnimTime-e);return}const a=this.currentHp/this.maxHp;a<.33?(this.phase=3,this.speed=250,this.attackCooldown=.8):a<.66&&(this.phase=2,this.speed=200,this.attackCooldown=1.2),this.x+=this.vx*e,this.y+=this.vy*e,(this.x-this.radius<0||this.x+this.radius>t)&&(this.vx*=-1,this.x=Math.max(this.radius,Math.min(t-this.radius,this.x))),(this.y-this.radius<0||this.y+this.radius>s)&&(this.vy*=-1,this.y=Math.max(this.radius,Math.min(s-this.radius,this.y))),this.attackTimer+=e,this.rotationAngle+=e*this.phase,this.pulseTime+=e*2,this.attackTimer>=this.attackCooldown-.5?this.chargeTime+=e*5:this.chargeTime=0}shouldAttack(){return this.attackTimer>=this.attackCooldown?(this.attackTimer=0,!0):!1}getPhase(){return this.phase}getAttackPattern(){return this.phase===3?"spiral":this.phase===2?"spread":"single"}draw(e){if(this.breakAnimTime>0){const p=1-this.breakAnimTime/this.breakAnimDuration,y=1-p,r=1+p*.8;e.setAlpha(y),e.setGlow("#ff0000",30),e.setFill("#ff0000"),e.circle(this.x,this.y,this.radius*r),e.setStroke("#ff0000",4),e.circle(this.x,this.y,this.radius*r,!1),e.clearGlow(),e.resetAlpha();return}const t=this.currentHp/this.maxHp;let s="#ffffff",a="#ffaa00";this.phase===3?(s="#ff0000",a="#ff6600"):this.phase===2&&(s="#ffaa00",a="#ffff00");const i=Math.sin(this.pulseTime)*.5+.5,o=10+i*20*this.phase;for(let p=3;p>=1;p--){const y=.15/p;e.setAlpha(y),e.setGlow(s,o),e.setStroke(s,2),e.circle(this.x,this.y,this.radius+p*15+i*5,!1),e.clearGlow(),e.resetAlpha()}if(this.chargeTime>0){const p=Math.min(this.chargeTime,1)*.4;e.setAlpha(p),e.setGlow(a,20),e.setFill(a),e.circle(this.x,this.y,this.radius*(1+this.chargeTime*.2)),e.clearGlow(),e.resetAlpha()}e.setGlow(s,o),e.setFill(s),e.circle(this.x,this.y,this.radius),e.clearGlow();const n=e.getContext();n.save(),n.translate(this.x,this.y),n.rotate(this.rotationAngle),e.setAlpha(.6),e.setStroke(a,3);for(let p=0;p<this.phase*3;p++){const y=p/(this.phase*3)*Math.PI*2,r=Math.cos(y)*this.radius*.5,f=Math.sin(y)*this.radius*.5,b=Math.cos(y)*this.radius,S=Math.sin(y)*this.radius;e.line(r,f,b,S)}e.resetAlpha(),n.restore();const l=this.radius*.3,c=this.radius*(.12+this.phase*.03);e.setGlow("#ff0000",5),e.setFill("#000000"),e.circle(this.x-l,this.y-l*.5,c),e.circle(this.x+l,this.y-l*.5,c),e.setFill("#ff0000"),e.setAlpha(.8),e.circle(this.x-l,this.y-l*.5,c*.5),e.circle(this.x+l,this.y-l*.5,c*.5),e.resetAlpha(),e.clearGlow();const h=this.radius*2,u=10,g=this.y-this.radius-30;if(e.setGlow(s,5),e.setStroke(s,2),e.setFill("#000"),e.getContext().fillRect(this.x-h/2,g,h,u),e.getContext().strokeRect(this.x-h/2,g,h,u),e.setFill(s),e.getContext().fillRect(this.x-h/2+2,g+2,(h-4)*t,u-4),e.clearGlow(),this.flashTime>0){const p=this.flashTime/this.flashDuration;e.setAlpha(p*.8),e.setGlow("#ffffff",30),e.setStroke("#ffffff",6);const y=this.radius*(1+(1-p)*.3);e.circle(this.x,this.y,y,!1),e.clearGlow(),e.resetAlpha()}}getPosition(){return{x:this.x,y:this.y}}}class D{x;y;vx;vy;radius=10;lifetime=5;age=0;rotationAngle=0;constructor(e,t,s,a,i){this.x=e,this.y=t;const o=s-e,n=a-t,l=Math.sqrt(o*o+n*n);this.vx=o/l*i,this.vy=n/l*i}update(e){return this.x+=this.vx*e*60,this.y+=this.vy*e*60,this.age+=e,this.rotationAngle+=e*5,this.age>=this.lifetime}draw(e){const t=Math.max(0,1-this.age/this.lifetime);e.setAlpha(t*.3),e.setGlow("#ff0000",20),e.setFill("#ff0000"),e.circle(this.x,this.y,this.radius*1.5,!0),e.clearGlow(),e.setAlpha(t),e.setGlow("#ff0000",10),e.setFill("#ff3300"),e.circle(this.x,this.y,this.radius,!0),e.setFill("#ffaa00"),e.circle(this.x,this.y,this.radius*.6,!0),e.setFill("#ffffff"),e.setAlpha(t*.8),e.circle(this.x,this.y,this.radius*.3,!0),e.clearGlow(),e.resetAlpha();const s=e.getContext();s.save(),s.translate(this.x,this.y),s.rotate(this.rotationAngle),e.setAlpha(t*.6),e.setStroke("#ff6600",2);for(let a=0;a<4;a++){const i=a/4*Math.PI*2,o=Math.cos(i)*this.radius*.4,n=Math.sin(i)*this.radius*.4,l=Math.cos(i)*this.radius*.9,c=Math.sin(i)*this.radius*.9;e.line(o,n,l,c)}e.resetAlpha(),s.restore()}getPosition(){return{x:this.x,y:this.y}}getRadius(){return this.radius}checkCollision(e,t){const s=this.x-e.x,a=this.y-e.y;return Math.sqrt(s*s+a*a)<this.radius+t}}class G{constructor(e,t,s,a,i=!1){this.angle=e,this.centerX=t,this.centerY=s,this.orbitRadius=a,this.isMainShip=i,this.rotationSpeed=i?.15:.1+Math.random()*.1,this.updatePosition()}x=0;y=0;rotationSpeed;updatePosition(){this.x=this.centerX+Math.cos(this.angle)*this.orbitRadius,this.y=this.centerY+Math.sin(this.angle)*this.orbitRadius}rotate(e,t){const s=t!==void 0?t:this.rotationSpeed;this.angle+=s*e,this.updatePosition()}getRotationSpeed(){return this.rotationSpeed}setOrbit(e,t,s){this.centerX=e,this.centerY=t,this.orbitRadius=s,this.updatePosition()}getPosition(){return{x:this.x,y:this.y}}getFrontPosition(){const e=this.isMainShip?12:8;return{x:this.x+Math.cos(this.angle+Math.PI)*e,y:this.y+Math.sin(this.angle+Math.PI)*e}}draw(e){const t=this.isMainShip?12:8,s=this.x+Math.cos(this.angle+Math.PI)*t,a=this.y+Math.sin(this.angle+Math.PI)*t,i={x:this.x+Math.cos(this.angle+Math.PI*.7)*t*.6,y:this.y+Math.sin(this.angle+Math.PI*.7)*t*.6},o={x:this.x+Math.cos(this.angle+Math.PI*1.3)*t*.6,y:this.y+Math.sin(this.angle+Math.PI*1.3)*t*.6};if(this.isMainShip){e.setStroke("#fff",2),e.triangle({x:s,y:a},i,o,!1),e.setFill("#fff");const n=t*.5,l=this.x+Math.cos(this.angle+Math.PI)*n,c=this.y+Math.sin(this.angle+Math.PI)*n,h={x:this.x+Math.cos(this.angle+Math.PI*.75)*n*.6,y:this.y+Math.sin(this.angle+Math.PI*.75)*n*.6},u={x:this.x+Math.cos(this.angle+Math.PI*1.25)*n*.6,y:this.y+Math.sin(this.angle+Math.PI*1.25)*n*.6};e.triangle({x:l,y:c},h,u)}else e.setFill("#fff"),e.triangle({x:s,y:a},i,o)}}class H{x;y;vx=0;vy=0;angle=-Math.PI/2;rotationSpeed=4;acceleration=300;maxSpeed=250;friction=.98;constructor(e,t){this.x=e,this.y=t}rotate(e,t){this.angle+=e*this.rotationSpeed*t}thrust(e){this.vx+=Math.cos(this.angle)*this.acceleration*e,this.vy+=Math.sin(this.angle)*this.acceleration*e;const t=Math.sqrt(this.vx*this.vx+this.vy*this.vy);t>this.maxSpeed&&(this.vx=this.vx/t*this.maxSpeed,this.vy=this.vy/t*this.maxSpeed)}update(e,t,s){this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx*e,this.y+=this.vy*e,this.x<0&&(this.x=t),this.x>t&&(this.x=0),this.y<0&&(this.y=s),this.y>s&&(this.y=0)}getFrontPosition(){return{x:this.x+Math.cos(this.angle)*15,y:this.y+Math.sin(this.angle)*15}}getPosition(){return{x:this.x,y:this.y}}getAngle(){return this.angle}draw(e){const s=this.x+Math.cos(this.angle)*15,a=this.y+Math.sin(this.angle)*15,i={x:this.x+Math.cos(this.angle+Math.PI*2.5/3)*15*.7,y:this.y+Math.sin(this.angle+Math.PI*2.5/3)*15*.7},o={x:this.x+Math.cos(this.angle+Math.PI*3.5/3)*15*.7,y:this.y+Math.sin(this.angle+Math.PI*3.5/3)*15*.7};e.setStroke("#fff",2),e.triangle({x:s,y:a},i,o,!1);const n=Math.sqrt(this.vx*this.vx+this.vy*this.vy);if(n>50){const l=n/this.maxSpeed*15*.5,c=this.x-Math.cos(this.angle)*15*.3,h=this.y-Math.sin(this.angle)*15*.3,u=c-Math.cos(this.angle)*l,g=h-Math.sin(this.angle)*l;e.setStroke("#fff",1),e.line(c,h,u,g)}}}class q{canvas;ctx;dpr;constructor(e){this.canvas=e;const t=this.canvas.getContext("2d");if(!t)throw new Error("Failed to get 2D context");this.ctx=t,this.dpr=window.devicePixelRatio||1,this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){const e=this.canvas.getBoundingClientRect();this.canvas.width=e.width*this.dpr,this.canvas.height=e.height*this.dpr,this.ctx.scale(this.dpr,this.dpr)}getContext(){return this.ctx}getWidth(){return this.canvas.width/this.dpr}getHeight(){return this.canvas.height/this.dpr}getCenterX(){return this.getWidth()/2}getCenterY(){return this.getHeight()/2}clear(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore()}}class V{constructor(e){this.ctx=e}getContext(){return this.ctx}circle(e,t,s,a=!0){this.ctx.beginPath(),this.ctx.arc(e,t,s,0,Math.PI*2),a?this.ctx.fill():this.ctx.stroke()}line(e,t,s,a){this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(s,a),this.ctx.stroke()}setStroke(e,t=1){this.ctx.strokeStyle=e,this.ctx.lineWidth=t}setFill(e){this.ctx.fillStyle=e}setAlpha(e){this.ctx.globalAlpha=e}resetAlpha(){this.ctx.globalAlpha=1}setGlow(e,t){this.ctx.shadowColor=e,this.ctx.shadowBlur=t}clearGlow(){this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0}triangle(e,t,s,a=!0){this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.lineTo(s.x,s.y),this.ctx.closePath(),a?this.ctx.fill():this.ctx.stroke()}text(e,t,s,a="#fff",i="16px monospace",o="left"){this.ctx.fillStyle=a,this.ctx.font=i,this.ctx.textAlign=o,this.ctx.fillText(e,t,s)}}class ${constructor(e,t){this.update=e,this.render=t}running=!1;lastTime=0;accumulator=0;fixedDt=1/60;start(){this.running||(this.running=!0,this.lastTime=performance.now(),this.loop(this.lastTime))}stop(){this.running=!1}loop=e=>{if(!this.running)return;const t=Math.min((e-this.lastTime)/1e3,.1);for(this.lastTime=e,this.accumulator+=t;this.accumulator>=this.fixedDt;)this.update(this.fixedDt),this.accumulator-=this.fixedDt;this.render(),requestAnimationFrame(this.loop)}}class O{constructor(e){this.canvas=e,this.setupListeners()}clickHandlers=[];setupListeners(){this.canvas.addEventListener("click",this.handleClick),this.canvas.addEventListener("touchstart",this.handleTouch,{passive:!1})}handleClick=e=>{const t=this.getCanvasPosition(e.clientX,e.clientY);this.clickHandlers.forEach(s=>s(t))};handleTouch=e=>{if(e.preventDefault(),e.touches.length>0){const t=e.touches[0];if(t){const s=this.getCanvasPosition(t.clientX,t.clientY);this.clickHandlers.forEach(a=>a(s))}}};getCanvasPosition(e,t){const s=this.canvas.getBoundingClientRect(),a=this.canvas.width/s.width,i=this.canvas.height/s.height;return{x:(e-s.left)*a,y:(t-s.top)*i}}onClick(e){this.clickHandlers.push(e)}destroy(){this.canvas.removeEventListener("click",this.handleClick),this.canvas.removeEventListener("touchstart",this.handleTouch)}}class z{state;listeners=[];pendingNotify=!1;lastNotifyPoints=0;constructor(e){this.state={...e},setInterval(()=>{this.pendingNotify&&(Math.abs(this.state.points-this.lastNotifyPoints)>this.lastNotifyPoints*.05||this.pendingNotify)&&(this.notifyListeners(),this.lastNotifyPoints=this.state.points,this.pendingNotify=!1)},30)}getState(){return{...this.state}}setState(e){this.state={...this.state,...e},this.notifyListeners()}addPoints(e){this.state.points+=e,this.state.stats.totalDamage+=e,this.pendingNotify=!0}spendPoints(e){return this.state.points>=e?(this.state.points-=e,this.notifyListeners(),!0):!1}incrementClick(){this.state.stats.totalClicks++}incrementAlienKill(){this.state.stats.aliensKilled++}incrementBossKill(){this.state.stats.bossesKilled++}incrementUpgrade(){this.state.stats.totalUpgrades++}incrementSubUpgrade(){this.state.stats.totalSubUpgrades++}updateMaxLevel(){this.state.level>this.state.stats.maxLevel&&(this.state.stats.maxLevel=this.state.level)}addPlayTime(e){this.state.stats.playTime+=e}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notifyListeners(){this.listeners.forEach(e=>{e()})}}function v(d,e,t){return Math.max(e,Math.min(t,d))}const N="alien-clicker-save";class k{static save(e){const t={points:e.points,shipsCount:e.shipsCount,attackSpeedLevel:e.attackSpeedLevel,autoFireUnlocked:e.autoFireUnlocked,pointMultiplierLevel:e.pointMultiplierLevel,critChanceLevel:e.critChanceLevel,resourceGenLevel:e.resourceGenLevel,xpBoostLevel:e.xpBoostLevel,level:e.level,experience:e.experience,subUpgrades:e.subUpgrades,achievements:e.achievements,stats:e.stats,prestigeLevel:e.prestigeLevel,prestigePoints:e.prestigePoints,prestigeUpgrades:e.prestigeUpgrades,harmonicState:e.harmonicState};try{localStorage.setItem(N,JSON.stringify(t))}catch(s){console.error("Failed to save:",s)}}static load(){try{const e=localStorage.getItem(N);if(e){const t=JSON.parse(e);return k.validate(t)}}catch(e){console.error("Failed to load save:",e)}return k.getDefault()}static clear(){try{localStorage.removeItem(N)}catch(e){console.error("Failed to clear save:",e)}}static validate(e){const t=k.getDefaultStats(),s={streak:0,harmonicCores:0,tuningForkLevel:0,metronomePurchased:!1,chorusLevel:0,quantizedRipplesLevel:0,sigils:{tempo:0,echo:0,focus:0},echoAccumulator:0};return{points:v(e.points??0,0,1e15),shipsCount:v(e.shipsCount??1,1,1e3),attackSpeedLevel:v(e.attackSpeedLevel??0,0,1e3),autoFireUnlocked:e.autoFireUnlocked??!1,pointMultiplierLevel:v(e.pointMultiplierLevel??0,0,1e3),critChanceLevel:v(e.critChanceLevel??0,0,1e3),resourceGenLevel:v(e.resourceGenLevel??0,0,1e3),xpBoostLevel:v(e.xpBoostLevel??0,0,1e3),level:v(e.level??1,1,1e4),experience:v(e.experience??0,0,1e15),subUpgrades:e.subUpgrades??{},achievements:e.achievements??{},stats:{...t,...e.stats,criticalHits:e.stats?.criticalHits??0,totalPrestige:e.stats?.totalPrestige??0,milestonesReached:e.stats?.milestonesReached??0},prestigeLevel:v(e.prestigeLevel??0,0,1e3),prestigePoints:v(e.prestigePoints??0,0,1e15),prestigeUpgrades:e.prestigeUpgrades??{},harmonicState:e.harmonicState?{...s,...e.harmonicState,sigils:{...s.sigils,...e.harmonicState.sigils??{}}}:s}}static getDefault(){return{points:0,shipsCount:1,attackSpeedLevel:0,autoFireUnlocked:!1,pointMultiplierLevel:0,critChanceLevel:0,resourceGenLevel:0,xpBoostLevel:0,level:1,experience:0,subUpgrades:{},achievements:{},stats:k.getDefaultStats(),prestigeLevel:0,prestigePoints:0,prestigeUpgrades:{},harmonicState:{streak:0,harmonicCores:0,tuningForkLevel:0,metronomePurchased:!1,chorusLevel:0,quantizedRipplesLevel:0,sigils:{tempo:0,echo:0,focus:0},echoAccumulator:0}}}static getDefaultStats(){return{totalClicks:0,totalDamage:0,aliensKilled:0,bossesKilled:0,totalUpgrades:0,totalSubUpgrades:0,maxLevel:1,playTime:0,criticalHits:0,totalPrestige:0,milestonesReached:0}}}class X{constructor(e,t,s,a){this.origin=e,this.target=t,this.damage=s,a&&(this.isCrit=a.isCrit??!1,this.color=a.color??"#fff",this.width=a.width??2,this.isFromShip=a.isFromShip??!1)}alive=!0;travelTime=.15;age=0;hasHit=!1;damage;isCrit=!1;color="#fff";width=2;isFromShip=!1;update(e){this.age+=e,this.hasHit&&(this.alive=!1)}getCurrentPosition(){if(this.age>=this.travelTime)return this.target;const e=Math.min(1,this.age/this.travelTime);return{x:this.origin.x+(this.target.x-this.origin.x)*e,y:this.origin.y+(this.target.y-this.origin.y)*e}}checkHit(){return this.hasHit?!1:this.age>=this.travelTime?(this.hasHit=!0,!0):!1}draw(e){if(!this.alive)return;const t=this.getCurrentPosition(),s=Math.min(1,this.age/this.travelTime),a=Math.min(1,s*1.5),i=e.getContext();i.save();const o=this.hexToRgba(this.color,a*.6),n=this.hexToRgba(this.color,0),l=i.createLinearGradient(this.origin.x,this.origin.y,t.x,t.y);l.addColorStop(0,n),l.addColorStop(.5,o),l.addColorStop(1,this.hexToRgba(this.color,a)),i.globalAlpha=a*.7,i.strokeStyle=l,i.lineWidth=this.width,i.lineCap="round",i.beginPath(),i.moveTo(this.origin.x,this.origin.y),i.lineTo(t.x,t.y),i.stroke(),this.isCrit&&(i.globalAlpha=a*.3,i.strokeStyle=this.color,i.lineWidth=this.width+1.5,i.shadowBlur=8,i.shadowColor=this.color,i.beginPath(),i.moveTo(this.origin.x,this.origin.y),i.lineTo(t.x,t.y),i.stroke()),s>=.95&&(i.globalAlpha=a,i.fillStyle=this.color,i.shadowBlur=this.isCrit?6:3,i.shadowColor=this.color,i.beginPath(),i.arc(t.x,t.y,this.isCrit?2:1.5,0,Math.PI*2),i.fill()),i.restore()}hexToRgba(e,t){let s=0,a=0,i=0;return e.startsWith("#")&&(e=e.substring(1)),e.length===3?(s=parseInt((e[0]??"0")+(e[0]??"0"),16),a=parseInt((e[1]??"0")+(e[1]??"0"),16),i=parseInt((e[2]??"0")+(e[2]??"0"),16)):e.length===6&&(s=parseInt(e.substring(0,2),16),a=parseInt(e.substring(2,4),16),i=parseInt(e.substring(4,6),16)),`rgba(${s.toString()}, ${a.toString()}, ${i.toString()}, ${t.toString()})`}}class K{lasers=[];showShipLasers=!0;maxLasers=1e3;maxShipLasers=800;setShowShipLasers(e){this.showShipLasers=e}spawnLaser(e,t,s,a){if(a?.isFromShip??!1){if(this.lasers.filter(n=>n.isFromShip).length>=this.maxShipLasers){let n=-1,l=1/0;for(let c=0;c<this.lasers.length;c++){const h=this.lasers[c];h&&h.isFromShip&&h.age<l&&(l=h.age,n=c)}n!==-1&&this.lasers.splice(n,1)}}else if(this.lasers.filter(n=>n.isFromShip).length>0&&this.lasers.length>=this.maxLasers){let n=-1,l=1/0;for(let c=0;c<this.lasers.length;c++){const h=this.lasers[c];h&&h.isFromShip&&h.age<l&&(l=h.age,n=c)}n!==-1&&this.lasers.splice(n,1)}else if(this.lasers.length>=this.maxLasers){let n=-1,l=1/0;for(let c=0;c<this.lasers.length;c++){const h=this.lasers[c];h&&!h.isFromShip&&h.age<l&&(l=h.age,n=c)}n!==-1&&this.lasers.splice(n,1)}this.lasers.push(new X(e,t,s,a))}update(e,t){for(const s of this.lasers)s.update(e),t&&s.checkHit()&&t(s.damage,s.isCrit);this.lasers=this.lasers.filter(s=>s.alive)}draw(e){for(const t of this.lasers)!this.showShipLasers&&t.isFromShip||t.draw(e)}clear(){this.lasers=[]}getLasers(){return this.lasers}getLaserStats(){const e=this.lasers.filter(s=>s.isFromShip).length,t=this.lasers.filter(s=>!s.isFromShip).length;return{total:this.lasers.length,shipLasers:e,playerLasers:t}}}class W{constructor(e,t){this.center=e,this.maxRadius=t}alive=!0;lifespan=.5;age=0;maxRadius;update(e){this.age+=e,this.age>=this.lifespan&&(this.alive=!1)}draw(e){if(!this.alive)return;const t=this.age/this.lifespan,s=this.maxRadius*t,a=(1-t)*.8,i=Math.floor(255*.7);e.setAlpha(a),e.setStroke(`rgb(${i},${i},${i})`,2),e.circle(this.center.x,this.center.y,s,!1),e.resetAlpha()}}class Y{ripples=[];maxRipples=10;spawnRipple(e,t){this.ripples.length>=this.maxRipples&&this.ripples.shift(),this.ripples.push(new W(e,t))}update(e){for(const t of this.ripples)t.update(e);this.ripples=this.ripples.filter(t=>t.alive)}draw(e){for(const t of this.ripples)t.draw(e)}clear(){this.ripples=[]}}class j{basePoints=1;subUpgrades=[];ascensionSystem=null;constructor(){this.initializeSubUpgrades()}setAscensionSystem(e){this.ascensionSystem=e}initializeSubUpgrades(){this.subUpgrades=[{id:"death_pact",name:"Death Pact Agreement",description:"Ships gain +10% attack speed",flavor:"In space, no one can hear you sign contracts.",cost:500,owned:!1,requires:e=>e.shipsCount>=3,isVisible:e=>e.shipsCount>=3,buy:e=>{e.subUpgrades.death_pact=!0}},{id:"laser_focusing",name:"Laser Focusing Crystals",description:"Increase point gain by 15%",flavor:"These crystals are definitely not from that one forbidden planet...",cost:1e3,owned:!1,requires:e=>e.pointMultiplierLevel>=5,isVisible:e=>e.pointMultiplierLevel>=5,buy:e=>{e.subUpgrades.laser_focusing=!0}},{id:"coffee_machine",name:"Crew Coffee Machine",description:"Passive point generation +50/sec",flavor:"Caffeine-fueled destruction. Now with extra espresso shots.",cost:2e3,owned:!1,requires:e=>e.level>=5,isVisible:e=>e.level>=5,buy:e=>{e.subUpgrades.coffee_machine=!0}},{id:"quantum_targeting",name:"Quantum Targeting Array",description:"Ships fire 20% faster",flavor:"Aims at where the target was, is, and will be simultaneously.",cost:2500,owned:!1,requires:e=>e.attackSpeedLevel>=10,isVisible:e=>e.attackSpeedLevel>=10,buy:e=>{e.subUpgrades.quantum_targeting=!0}},{id:"lucky_dice",name:"Lucky Space Dice",description:"+5% critical hit chance",flavor:"Found them in an asteroid. The previous owner won't miss them.",cost:3500,owned:!1,requires:e=>e.critChanceLevel>=5,isVisible:e=>e.critChanceLevel>=5,buy:e=>{e.subUpgrades.lucky_dice=!0}},{id:"energy_recycling",name:"Energy Recycling System",description:"All upgrades are 5% cheaper",flavor:"Reduce, reuse, recycle... plasma.",cost:5e3,owned:!1,requires:e=>e.shipsCount>=10,isVisible:e=>e.shipsCount>=10,buy:e=>{e.subUpgrades.energy_recycling=!0}},{id:"overclocked_reactors",name:"Overclocked Reactors",description:"Gain 25% more points per hit",flavor:"Safety protocols are just suggestions anyway.",cost:1e4,owned:!1,requires:e=>e.level>=10,isVisible:e=>e.level>=10,buy:e=>{e.subUpgrades.overclocked_reactors=!0}},{id:"ship_swarm",name:"Swarm Intelligence Protocol",description:"Ships coordinate attacks for +20% damage",flavor:"The hivemind accepts all. Resistance is futile.",cost:15e3,owned:!1,requires:e=>e.shipsCount>=15,isVisible:e=>e.shipsCount>=15,buy:e=>{e.subUpgrades.ship_swarm=!0}},{id:"neural_link",name:"Neural Link Interface",description:"Clicking grants 10% bonus points",flavor:"Think faster, click harder.",cost:25e3,owned:!1,requires:e=>e.level>=20,isVisible:e=>e.level>=20,buy:e=>{e.subUpgrades.neural_link=!0}},{id:"space_pizza",name:"Intergalactic Pizza Delivery",description:"Passive generation +200/sec",flavor:"Guaranteed delivery in 30 light-years or less!",cost:3e4,owned:!1,requires:e=>e.resourceGenLevel>=10,isVisible:e=>e.resourceGenLevel>=10,buy:e=>{e.subUpgrades.space_pizza=!0}},{id:"rubber_duck",name:"Debugging Rubber Duck",description:"+3% critical damage multiplier",flavor:"Explains your problems back to you. Very therapeutic.",cost:35e3,owned:!1,requires:e=>e.stats.criticalHits>=100,isVisible:e=>e.stats.criticalHits>=50,buy:e=>{e.subUpgrades.rubber_duck=!0}},{id:"antimatter_rounds",name:"Antimatter Ammunition",description:"Double all point gains",flavor:"What could possibly go wrong with weaponized antimatter?",cost:5e4,owned:!1,requires:e=>e.pointMultiplierLevel>=20,isVisible:e=>e.pointMultiplierLevel>=20,buy:e=>{e.subUpgrades.antimatter_rounds=!0}},{id:"motivational_posters",name:"Motivational Posters",description:"XP gain +25%",flavor:'"Hang in there!" says the cat dangling from a satellite dish.',cost:6e4,owned:!1,requires:e=>e.xpBoostLevel>=10,isVisible:e=>e.xpBoostLevel>=10,buy:e=>{e.subUpgrades.motivational_posters=!0}},{id:"warp_core",name:"Experimental Warp Core",description:"Ships fire 50% faster",flavor:"Theoretical physics becomes practical firepower.",cost:75e3,owned:!1,requires:e=>e.attackSpeedLevel>=25,isVisible:e=>e.attackSpeedLevel>=25,buy:e=>{e.subUpgrades.warp_core=!0}},{id:"disco_ball",name:"Hypnotic Disco Ball",description:"Aliens confused, +15% all stats",flavor:"Saturday Night Fever, but in space. And deadly.",cost:85e3,owned:!1,requires:e=>e.level>=30,isVisible:e=>e.level>=30,buy:e=>{e.subUpgrades.disco_ball=!0}},{id:"ai_optimizer",name:"AI Optimization Subroutines",description:"Ship fire cooldown reduced by 30%",flavor:"The AI promises it won't become self-aware. Probably.",cost:1e5,owned:!1,requires:e=>e.attackSpeedLevel>=30,isVisible:e=>e.attackSpeedLevel>=30,buy:e=>{e.subUpgrades.ai_optimizer=!0}},{id:"lucky_horseshoe",name:"Lucky Horseshoe",description:"Critical hits deal 50% more damage",flavor:"Who needs horses in space? Apparently, luck does.",cost:12e4,owned:!1,requires:e=>e.critChanceLevel>=15,isVisible:e=>e.critChanceLevel>=15,buy:e=>{e.subUpgrades.lucky_horseshoe=!0}},{id:"perfect_precision",name:"Perfect Precision Arrays",description:"Critical hits: 5% chance for 10x damage",flavor:"Every shot finds its mark. Every. Single. One.",cost:15e4,owned:!1,requires:e=>e.shipsCount>=25,isVisible:e=>e.shipsCount>=25,buy:e=>{e.subUpgrades.perfect_precision=!0}},{id:"arcade_machine",name:"Retro Arcade Machine",description:"Passive generation +1000/sec",flavor:"Plays Pac-Man while generating infinite energy. Science!",cost:175e3,owned:!1,requires:e=>e.resourceGenLevel>=20,isVisible:e=>e.resourceGenLevel>=20,buy:e=>{e.subUpgrades.arcade_machine=!0}},{id:"void_channeling",name:"Void Energy Channeling",description:"Destroying aliens grants bonus XP",flavor:"The void stares back, and it likes what it sees.",cost:2e5,owned:!1,requires:e=>e.level>=40,isVisible:e=>e.level>=40,buy:e=>{e.subUpgrades.void_channeling=!0}},{id:"chaos_emeralds",name:"Seven Chaos Emeralds",description:"All damage +35%",flavor:"Gotta go fast! Wait, wrong franchise...",cost:25e4,owned:!1,requires:e=>e.level>=45,isVisible:e=>e.level>=45,buy:e=>{e.subUpgrades.chaos_emeralds=!0}},{id:"time_machine",name:"Malfunctioning Time Machine",description:"XP gain +50%",flavor:"Sets time forward, backward, and sideways. Results may vary.",cost:3e5,owned:!1,requires:e=>e.xpBoostLevel>=20,isVisible:e=>e.xpBoostLevel>=20,buy:e=>{e.subUpgrades.time_machine=!0}},{id:"nanobots",name:"Self-Replicating Nanobots",description:"Passive generation +2500/sec",flavor:"They multiply. They evolve. They pay dividends.",cost:5e6,owned:!1,requires:e=>e.level>=50,isVisible:e=>e.level>=50,buy:e=>{e.subUpgrades.nanobots=!0}},{id:"plasma_matrix",name:"Plasma Energy Matrix",description:"All damage +25%, Attack speed +15%",flavor:"Harness the power of contained supernovas.",cost:75e5,owned:!1,requires:e=>e.level>=52,isVisible:e=>e.level>=52,buy:e=>{e.subUpgrades.plasma_matrix=!0}},{id:"holographic_decoys",name:"Holographic Decoy System",description:"Ships can attack twice as often",flavor:"One ship becomes many. Confusion intensifies.",cost:1e7,owned:!1,requires:e=>e.shipsCount>=18,isVisible:e=>e.shipsCount>=18,buy:e=>{e.subUpgrades.holographic_decoys=!0}},{id:"temporal_acceleration",name:"Temporal Acceleration Field",description:"All ships gain +100% attack speed",flavor:"Time is relative. Especially when you control it.",cost:15e6,owned:!1,requires:e=>e.level>=55,isVisible:e=>e.level>=55,buy:e=>{e.subUpgrades.temporal_acceleration=!0}},{id:"quantum_entanglement",name:"Quantum Entanglement Core",description:"Critical hits +8%, Damage x1.5",flavor:"Spooky action at a distance. Einstein hated it. You'll love it.",cost:2e7,owned:!1,requires:e=>e.critChanceLevel>=20,isVisible:e=>e.critChanceLevel>=20,buy:e=>{e.subUpgrades.quantum_entanglement=!0}},{id:"philosophers_stone",name:"Philosopher's Stone",description:"Passive generation x5",flavor:"Turns lead into gold. And boredom into profit.",cost:6e5,owned:!1,requires:e=>e.resourceGenLevel>=30,isVisible:e=>e.resourceGenLevel>=30,buy:e=>{e.subUpgrades.philosophers_stone=!0}},{id:"stellar_forge",name:"Stellar Forge",description:"XP gain +75%, All damage +20%",flavor:"Where stars are born, and enemies meet their end.",cost:3e7,owned:!1,requires:e=>e.level>=62,isVisible:e=>e.level>=62,buy:e=>{e.subUpgrades.stellar_forge=!0}},{id:"golden_goose",name:"Quantum Golden Goose",description:"Points per click +50%",flavor:"Lays golden eggs. In multiple dimensions. Simultaneously.",cost:4e7,owned:!1,requires:e=>e.stats.totalClicks>=5e3,isVisible:e=>e.stats.totalClicks>=2500,buy:e=>{e.subUpgrades.golden_goose=!0}},{id:"dark_matter_engine",name:"Dark Matter Engine",description:"Passive generation x3, Ships +25% speed",flavor:"95% of the universe is dark matter. Now it's yours.",cost:5e7,owned:!1,requires:e=>e.level>=65,isVisible:e=>e.level>=65,buy:e=>{e.subUpgrades.dark_matter_engine=!0}},{id:"antimatter_cascade",name:"Antimatter Cascade Reactor",description:"All click damage x4",flavor:"Click once. Destroy everything. Repeat.",cost:6e7,owned:!1,requires:e=>e.stats.totalClicks>=7500,isVisible:e=>e.stats.totalClicks>=5e3,buy:e=>{e.subUpgrades.antimatter_cascade=!0}},{id:"infinity_gauntlet",name:"Infinity Gauntlet (Replica)",description:"All stats +40%",flavor:"Perfectly balanced, as all things should be. Also, not trademarked.",cost:8e5,owned:!1,requires:e=>e.level>=70,isVisible:e=>e.level>=70,buy:e=>{e.subUpgrades.infinity_gauntlet=!0}},{id:"nebula_harvester",name:"Nebula Energy Harvester",description:"Passive generation +5000/sec, XP +50%",flavor:"Siphon energy from the cosmic clouds themselves.",cost:75e6,owned:!1,requires:e=>e.resourceGenLevel>=35,isVisible:e=>e.resourceGenLevel>=35,buy:e=>{e.subUpgrades.nebula_harvester=!0}},{id:"alien_cookbook",name:"Alien Recipe Book",description:"Boss kill rewards +100%",flavor:`"To Serve Aliens" - It's a cookbook!`,cost:9e5,owned:!1,requires:e=>e.stats.bossesKilled>=25,isVisible:e=>e.stats.bossesKilled>=15,buy:e=>{e.subUpgrades.alien_cookbook=!0}},{id:"hyper_reactor",name:"Hyper-Dimensional Reactor",description:"All damage x2, Critical chance +5%",flavor:"Powers drawn from dimensions we can't even see.",cost:1e8,owned:!1,requires:e=>e.level>=75,isVisible:e=>e.level>=75,buy:e=>{e.subUpgrades.hyper_reactor=!0}},{id:"nuclear_reactor",name:"Pocket Nuclear Reactor",description:"Passive generation +10000/sec",flavor:"Fits in your pocket. Do not put in pocket.",cost:125e6,owned:!1,requires:e=>e.resourceGenLevel>=40,isVisible:e=>e.resourceGenLevel>=40,buy:e=>{e.subUpgrades.nuclear_reactor=!0}},{id:"photon_amplifier",name:"Photon Wave Amplifier",description:"Ships fire 75% faster, Damage +30%",flavor:"Light speed is too slow. We're going to ludicrous speed!",cost:15e7,owned:!1,requires:e=>e.attackSpeedLevel>=40,isVisible:e=>e.attackSpeedLevel>=40,buy:e=>{e.subUpgrades.photon_amplifier=!0}},{id:"reality_anchor",name:"Reality Anchor",description:"Critical damage x3, All gains +25%",flavor:"Keep reality in check. Or break it. Your choice.",cost:2e8,owned:!1,requires:e=>e.critChanceLevel>=35,isVisible:e=>e.critChanceLevel>=35,buy:e=>{e.subUpgrades.reality_anchor=!0}},{id:"cosmic_battery",name:"Cosmic Energy Battery",description:"Passive generation x7",flavor:"Stores the energy of dying stars. Batteries not included.",cost:25e7,owned:!1,requires:e=>e.resourceGenLevel>=45,isVisible:e=>e.resourceGenLevel>=45,buy:e=>{e.subUpgrades.cosmic_battery=!0}},{id:"singularity_core",name:"Singularity Power Core",description:"Gain 5x points from all sources",flavor:"A black hole in a box. What could be safer?",cost:2e6,owned:!1,requires:e=>e.level>=80,isVisible:e=>e.level>=80,buy:e=>{e.subUpgrades.singularity_core=!0}},{id:"cheat_codes",name:"Cheat Code Manual",description:"All upgrades 20% cheaper",flavor:"Up, Up, Down, Down, Left, Right, Left, Right, B, A, Start.",cost:25e5,owned:!1,requires:e=>e.stats.totalUpgrades>=200,isVisible:e=>e.stats.totalUpgrades>=150,buy:e=>{e.subUpgrades.cheat_codes=!0}},{id:"dragon_egg",name:"Dragon Egg",description:"Critical hit chance +10%, Critical damage x2",flavor:"It's either a dragon egg or a really angry space chicken.",cost:3e6,owned:!1,requires:e=>e.critChanceLevel>=30,isVisible:e=>e.critChanceLevel>=30,buy:e=>{e.subUpgrades.dragon_egg=!0}},{id:"universe_map",name:"Map of the Universe",description:"XP gain x3",flavor:"You are here. So is everything else. Helpful!",cost:4e6,owned:!1,requires:e=>e.xpBoostLevel>=35,isVisible:e=>e.xpBoostLevel>=35,buy:e=>{e.subUpgrades.universe_map=!0}},{id:"answer_to_everything",name:"Answer to Everything",description:"All passive generation x10",flavor:"It's 42. But what was the question again?",cost:5e6,owned:!1,requires:e=>e.resourceGenLevel>=50,isVisible:e=>e.resourceGenLevel>=50,buy:e=>{e.subUpgrades.answer_to_everything=!0}},{id:"heart_of_galaxy",name:"Heart of the Galaxy",description:"All damage x3",flavor:"The galaxy had a heart. HAD.",cost:75e5,owned:!1,requires:e=>e.level>=90,isVisible:e=>e.level>=90,buy:e=>{e.subUpgrades.heart_of_galaxy=!0}},{id:"cosmic_ascension",name:"Cosmic Ascension Protocol",description:"Unlock ultimate power: 10x all gains",flavor:"You have become death, destroyer of alien balls.",cost:1e7,owned:!1,requires:e=>e.level>=95,isVisible:e=>e.level>=95,buy:e=>{e.subUpgrades.cosmic_ascension=!0}},{id:"meaning_of_life",name:"Meaning of Life",description:"Unlock prestige system & all stats x2",flavor:"Spoiler: It's clicking alien balls all the way down.",cost:25e6,owned:!1,requires:e=>e.level>=100,isVisible:e=>e.level>=100,buy:e=>{e.subUpgrades.meaning_of_life=!0}},{id:"master_clicker",name:"Master Clicker",description:"Clicking gives +100% more points",flavor:"Click, click, boom!",cost:5e4,owned:!1,requires:e=>e.stats.totalClicks>=1e3,isVisible:e=>e.stats.totalClicks>=500,buy:e=>{e.subUpgrades.master_clicker=!0}},{id:"rapid_fire",name:"Rapid Fire Protocol",description:"Each click fires 2 additional lasers",flavor:"One click, triple threat!",cost:15e4,owned:!1,requires:e=>e.stats.totalClicks>=2500,isVisible:e=>e.stats.totalClicks>=1500,buy:e=>{e.subUpgrades.rapid_fire=!0}},{id:"click_multiplier",name:"Click Multiplier Matrix",description:"Clicking multiplies damage by 3x",flavor:"Every click echoes through reality.",cost:5e5,owned:!1,requires:e=>e.stats.totalClicks>=5e3,isVisible:e=>e.stats.totalClicks>=3e3,buy:e=>{e.subUpgrades.click_multiplier=!0}},{id:"super_clicker",name:"Super Clicker Ultimate",description:"Clicks deal 5x damage and grant bonus XP",flavor:"The ultimate clicking evolution.",cost:2e6,owned:!1,requires:e=>e.stats.totalClicks>=1e4,isVisible:e=>e.stats.totalClicks>=7500,buy:e=>{e.subUpgrades.super_clicker=!0}},{id:"missile_launcher",name:"Missile Launcher Array",description:"Enhanced targeting systems for improved precision",flavor:"Advanced missile technology for maximum firepower.",cost:5e5,owned:!1,requires:e=>e.shipsCount>=15,isVisible:e=>e.shipsCount>=15,buy:e=>{e.subUpgrades.missile_launcher=!0}}]}getSubUpgrades(){return this.subUpgrades.map(e=>({...e,owned:e.owned}))}updateSubUpgradesFromState(e){for(const t of this.subUpgrades)t.owned=e.subUpgrades[t.id]??!1}getUpgrades(){const e=this.subUpgrades.filter(r=>["death_pact","ship_swarm","perfect_precision","missile_launcher"].includes(r.id)),t=this.subUpgrades.filter(r=>["quantum_targeting","warp_core","ai_optimizer","temporal_acceleration","holographic_decoys","photon_amplifier"].includes(r.id)),s=this.subUpgrades.filter(r=>["laser_focusing","overclocked_reactors","neural_link","antimatter_rounds","singularity_core","cosmic_ascension","disco_ball","chaos_emeralds","infinity_gauntlet","heart_of_galaxy","meaning_of_life","golden_goose","master_clicker","rapid_fire","click_multiplier","super_clicker","plasma_matrix","quantum_entanglement","stellar_forge","antimatter_cascade","hyper_reactor","photon_amplifier","reality_anchor"].includes(r.id)),a=this.subUpgrades.filter(r=>["lucky_dice","rubber_duck","lucky_horseshoe","dragon_egg","quantum_entanglement","hyper_reactor","reality_anchor"].includes(r.id)),i=this.subUpgrades.filter(r=>["coffee_machine","space_pizza","arcade_machine","philosophers_stone","nuclear_reactor","answer_to_everything","nanobots","dark_matter_engine","nebula_harvester","cosmic_battery"].includes(r.id)),o=this.subUpgrades.filter(r=>["motivational_posters","void_channeling","time_machine","universe_map","stellar_forge","nebula_harvester"].includes(r.id)),n=this.subUpgrades.filter(r=>["energy_recycling","cheat_codes","alien_cookbook"].includes(r.id));return[{id:"ship",name:"ðŸš€ Starship Fleet",description:"Recruit another starship to your armada. More ships = more firepower!",getCost:r=>this.applyDiscount(Math.ceil(10*Math.pow(1.15,r))),canBuy:r=>{const f=this.applyDiscount(Math.ceil(10*Math.pow(1.15,r.shipsCount)));return r.points>=f},buy:r=>{r.shipsCount++},getLevel:r=>r.shipsCount,getDisplayText:r=>`Fleet: ${r.shipsCount.toString()}`,subUpgrades:e},{id:"attackSpeed",name:"âš¡ Attack Speed",description:"Upgrade targeting computers to fire faster. Speed is everything.",getCost:r=>this.applyDiscount(Math.ceil(50*Math.pow(1.25,r))),canBuy:r=>{const f=this.applyDiscount(Math.ceil(50*Math.pow(1.25,r.attackSpeedLevel))),b=this.getFireCooldown(r);return r.points>=f&&b>50},buy:r=>{r.attackSpeedLevel++},getLevel:r=>r.attackSpeedLevel,getDisplayText:r=>{const f=this.getFireCooldown(r),b=f<=50?" [MAX]":"";return`Lv.${r.attackSpeedLevel.toString()} (${f.toString()}ms${b})`},subUpgrades:t},{id:"pointMultiplier",name:"ðŸ’Ž Damage Amplifier",description:"Enhance laser power for maximum destruction per hit.",getCost:r=>this.applyDiscount(Math.ceil(100*Math.pow(1.3,r))),canBuy:r=>{const f=this.applyDiscount(Math.ceil(100*Math.pow(1.3,r.pointMultiplierLevel)));return r.points>=f},buy:r=>{r.pointMultiplierLevel++},getLevel:r=>r.pointMultiplierLevel,getDisplayText:r=>`Lv.${r.pointMultiplierLevel.toString()} (${this.getPointsPerHit(r).toFixed(1)}/hit)`,subUpgrades:s},{id:"critChance",name:"âœ¨ Critical Strike",description:"Increase critical hit chance and damage for devastating strikes.",getCost:r=>this.applyDiscount(Math.ceil(150*Math.pow(1.35,r))),canBuy:r=>{const f=this.applyDiscount(Math.ceil(150*Math.pow(1.35,r.critChanceLevel)));return r.points>=f},buy:r=>{r.critChanceLevel++},getLevel:r=>r.critChanceLevel,getDisplayText:r=>`Lv.${r.critChanceLevel.toString()} (${this.getCritChance(r).toFixed(1)}%)`,subUpgrades:a},{id:"resourceGen",name:"ðŸ­ Passive Income",description:"Generate points automatically over time. Scales exponentially!",getCost:r=>this.applyDiscount(Math.ceil(200*Math.pow(1.4,r))),canBuy:r=>{const f=this.applyDiscount(Math.ceil(200*Math.pow(1.4,r.resourceGenLevel)));return r.points>=f},buy:r=>{r.resourceGenLevel++},getLevel:r=>r.resourceGenLevel,getDisplayText:r=>`Lv.${r.resourceGenLevel.toString()} (${this.formatPassiveGen(this.getPassiveGen(r))}/sec)`,subUpgrades:i},{id:"xpBoost",name:"ðŸ“š Knowledge Core",description:"Learn faster and level up quicker. Knowledge is power!",getCost:r=>this.applyDiscount(Math.ceil(250*Math.pow(1.38,r))),canBuy:r=>{const f=this.applyDiscount(Math.ceil(250*Math.pow(1.38,r.xpBoostLevel)));return r.points>=f},buy:r=>{r.xpBoostLevel++},getLevel:r=>r.xpBoostLevel,getDisplayText:r=>`Lv.${r.xpBoostLevel.toString()} (+${(this.getXPMultiplier(r)*100-100).toFixed(0)}% XP)`,subUpgrades:o},{id:"misc",name:"ðŸ”¬ Research & Development",description:"Unlock experimental technologies and forbidden knowledge.",getCost:()=>0,canBuy:()=>!1,buy:()=>{},getLevel:()=>0,getDisplayText:()=>"Special Technologies",subUpgrades:n}]}applyDiscount(e){let t=1;return this.subUpgrades.find(s=>s.id==="energy_recycling")?.owned&&(t*=.95),this.subUpgrades.find(s=>s.id==="cheat_codes")?.owned&&(t*=.8),Math.floor(e*t)}getPointsPerHit(e){this.updateSubUpgradesFromState(e);let t=this.basePoints*(1+.15*e.pointMultiplierLevel);return e.subUpgrades.laser_focusing&&(t*=1.15),e.subUpgrades.overclocked_reactors&&(t*=1.25),e.subUpgrades.ship_swarm&&(t*=1.2),e.subUpgrades.neural_link&&(t*=1.1),e.subUpgrades.antimatter_rounds&&(t*=2),e.subUpgrades.plasma_matrix&&(t*=1.25),e.subUpgrades.quantum_entanglement&&(t*=1.5),e.subUpgrades.stellar_forge&&(t*=1.2),e.subUpgrades.antimatter_cascade&&(t*=4),e.subUpgrades.hyper_reactor&&(t*=2),e.subUpgrades.photon_amplifier&&(t*=1.3),e.subUpgrades.reality_anchor&&(t*=1.25),e.subUpgrades.disco_ball&&(t*=1.15),e.subUpgrades.chaos_emeralds&&(t*=1.35),e.subUpgrades.infinity_gauntlet&&(t*=1.4),e.subUpgrades.golden_goose&&(t*=1.5),e.subUpgrades.heart_of_galaxy&&(t*=3),e.subUpgrades.singularity_core&&(t*=5),e.subUpgrades.cosmic_ascension&&(t*=10),e.subUpgrades.meaning_of_life&&(t*=2),e.subUpgrades.master_clicker&&(t*=2),e.subUpgrades.click_multiplier&&(t*=3),e.subUpgrades.super_clicker&&(t*=5),e.subUpgrades.perfect_precision&&Math.random()<.05&&(t*=10),this.ascensionSystem&&(t*=this.ascensionSystem.getDamageMultiplier(e),t*=this.ascensionSystem.getPointsMultiplier(e)),t}getCritChance(e){this.updateSubUpgradesFromState(e);let t=2+e.critChanceLevel*.5;return e.subUpgrades.lucky_dice&&(t+=5),e.subUpgrades.dragon_egg&&(t+=10),e.subUpgrades.quantum_entanglement&&(t+=8),e.subUpgrades.hyper_reactor&&(t+=5),this.ascensionSystem&&(t+=this.ascensionSystem.getCritBonus(e)),Math.min(t,75)}getCritMultiplier(e){this.updateSubUpgradesFromState(e);let t=2;return e.subUpgrades.rubber_duck&&(t+=3),e.subUpgrades.lucky_horseshoe&&(t*=1.5),e.subUpgrades.dragon_egg&&(t*=2),e.subUpgrades.reality_anchor&&(t*=3),t}getPassiveGen(e){this.updateSubUpgradesFromState(e);let t=e.resourceGenLevel*10*Math.pow(1.2,e.resourceGenLevel*.5);return e.subUpgrades.coffee_machine&&(t+=50),e.subUpgrades.space_pizza&&(t+=200),e.subUpgrades.arcade_machine&&(t+=1e3),e.subUpgrades.nanobots&&(t+=2500),e.subUpgrades.nebula_harvester&&(t+=5e3),e.subUpgrades.philosophers_stone&&(t*=5),e.subUpgrades.dark_matter_engine&&(t*=3),e.subUpgrades.nuclear_reactor&&(t+=1e4),e.subUpgrades.cosmic_battery&&(t*=7),e.subUpgrades.answer_to_everything&&(t*=10),this.ascensionSystem&&(t*=this.ascensionSystem.getPassiveMultiplier(e)),t}getXPMultiplier(e){this.updateSubUpgradesFromState(e);let t=1+e.xpBoostLevel*.1;return e.subUpgrades.motivational_posters&&(t*=1.25),e.subUpgrades.time_machine&&(t*=1.5),e.subUpgrades.stellar_forge&&(t*=1.75),e.subUpgrades.nebula_harvester&&(t*=1.5),e.subUpgrades.universe_map&&(t*=3),this.ascensionSystem&&(t*=this.ascensionSystem.getXPMultiplier(e)),t}getFireCooldown(e){this.updateSubUpgradesFromState(e);let t=Math.max(Math.floor(1e4*Math.pow(.985,e.attackSpeedLevel)),120);if(e.subUpgrades.death_pact&&(t*=.9),e.subUpgrades.quantum_targeting&&(t*=.8),e.subUpgrades.warp_core&&(t*=.67),e.subUpgrades.ai_optimizer&&(t*=.7),e.subUpgrades.plasma_matrix&&(t*=.85),e.subUpgrades.holographic_decoys&&(t*=.5),e.subUpgrades.temporal_acceleration&&(t*=.5),e.subUpgrades.dark_matter_engine&&(t*=.75),e.subUpgrades.photon_amplifier&&(t*=.57),e.subUpgrades.disco_ball&&(t*=.85),e.subUpgrades.infinity_gauntlet&&(t*=.6),this.ascensionSystem){const s=this.ascensionSystem.getSpeedMultiplier(e);t/=s}return Math.max(Math.floor(t),50)}getBonusXP(e){this.updateSubUpgradesFromState(e);let t=1;return e.subUpgrades.void_channeling&&(t=2),t*=this.getXPMultiplier(e),t}formatPassiveGen(e){return e>=1e9?`${(e/1e9).toFixed(2)}B`:e>=1e6?`${(e/1e6).toFixed(2)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toFixed(1)}}class J{shipTimers=[];setShipCount(e){for(;this.shipTimers.length<e;){const t=Math.random()*.3;this.shipTimers.push(t)}for(;this.shipTimers.length>e;)this.shipTimers.pop()}update(e,t,s,a){if(!t)return;const i=s/1e3;for(let o=0;o<this.shipTimers.length;o++)this.shipTimers[o]+=e,this.shipTimers[o]>=i&&(this.shipTimers[o]=0,a(o))}reset(){this.shipTimers=this.shipTimers.map(()=>Math.random()*.5)}staggerExistingShips(){this.shipTimers=this.shipTimers.map(()=>Math.random()*.5)}}class Q{achievements=[];onUnlockCallback;constructor(){this.initializeAchievements()}initializeAchievements(){this.achievements=[{id:"first_click",name:"First Contact",description:"Click an alien for the first time",icon:"ðŸ‘†",category:"combat",unlocked:!1,check:e=>e.stats.totalClicks>=1},{id:"click_master",name:"Click Master",description:"Click 100 times",icon:"ðŸ–±ï¸",category:"combat",unlocked:!1,check:e=>e.stats.totalClicks>=100},{id:"click_legend",name:"Click Legend",description:"Click 1,000 times",icon:"âš¡",category:"combat",unlocked:!1,check:e=>e.stats.totalClicks>=1e3},{id:"click_god",name:"Click God",description:"Click 10,000 times",icon:"ðŸ‘‘",category:"combat",unlocked:!1,check:e=>e.stats.totalClicks>=1e4},{id:"click_transcendent",name:"Transcendent Clicker",description:"Click 50,000 times",icon:"ðŸŒŸ",category:"combat",unlocked:!1,check:e=>e.stats.totalClicks>=5e4},{id:"first_blood",name:"First Blood",description:"Destroy your first alien",icon:"ðŸ’¥",category:"combat",unlocked:!1,check:e=>e.stats.aliensKilled>=1},{id:"alien_hunter",name:"Alien Hunter",description:"Destroy 50 aliens",icon:"ðŸŽ¯",category:"combat",unlocked:!1,check:e=>e.stats.aliensKilled>=50},{id:"alien_slayer",name:"Alien Slayer",description:"Destroy 250 aliens",icon:"âš”ï¸",category:"combat",unlocked:!1,check:e=>e.stats.aliensKilled>=250},{id:"alien_destroyer",name:"Alien Destroyer",description:"Destroy 1,000 aliens",icon:"ðŸ”¥",category:"combat",unlocked:!1,check:e=>e.stats.aliensKilled>=1e3},{id:"alien_annihilator",name:"Alien Annihilator",description:"Destroy 5,000 aliens",icon:"ðŸ’€",category:"combat",unlocked:!1,check:e=>e.stats.aliensKilled>=5e3},{id:"alien_apocalypse",name:"Alien Apocalypse",description:"Destroy 10,000 aliens",icon:"â˜ ï¸",category:"combat",unlocked:!1,check:e=>e.stats.aliensKilled>=1e4},{id:"damage_dealer",name:"Damage Dealer",description:"Deal 10,000 total damage",icon:"ðŸ’ª",category:"combat",unlocked:!1,check:e=>e.stats.totalDamage>=1e4},{id:"damage_master",name:"Damage Master",description:"Deal 100,000 total damage",icon:"ðŸ”¨",category:"combat",unlocked:!1,check:e=>e.stats.totalDamage>=1e5},{id:"damage_overlord",name:"Damage Overlord",description:"Deal 1,000,000 total damage",icon:"âš¡",category:"combat",unlocked:!1,check:e=>e.stats.totalDamage>=1e6},{id:"damage_deity",name:"Damage Deity",description:"Deal 100,000,000 total damage",icon:"ðŸŒ©ï¸",category:"combat",unlocked:!1,check:e=>e.stats.totalDamage>=1e8},{id:"damage_universe",name:"Universe Destroyer",description:"Deal 1,000,000,000 total damage",icon:"ðŸ’«",category:"combat",unlocked:!1,check:e=>e.stats.totalDamage>=1e9},{id:"boss_slayer",name:"Boss Slayer",description:"Defeat your first boss",icon:"ðŸ‘‘",category:"combat",unlocked:!1,check:e=>e.stats.bossesKilled>=1},{id:"boss_hunter",name:"Boss Hunter",description:"Defeat 10 bosses",icon:"ðŸ‘¹",category:"combat",unlocked:!1,check:e=>e.stats.bossesKilled>=10},{id:"boss_master",name:"Boss Master",description:"Defeat 50 bosses",icon:"ðŸ‰",category:"combat",unlocked:!1,check:e=>e.stats.bossesKilled>=50},{id:"boss_annihilator",name:"Boss Annihilator",description:"Defeat 100 bosses",icon:"ðŸ‘¾",category:"combat",unlocked:!1,check:e=>e.stats.bossesKilled>=100},{id:"boss_obliterator",name:"Boss Obliterator",description:"Defeat 200 bosses",icon:"ðŸŒ ",category:"combat",unlocked:!1,check:e=>e.stats.bossesKilled>=200},{id:"alien_extinction",name:"Alien Extinction",description:"Destroy 25,000 aliens",icon:"ðŸŒªï¸",category:"combat",unlocked:!1,check:e=>e.stats.aliensKilled>=25e3},{id:"damage_omnipotent",name:"Omnipotent Destroyer",description:"Deal 10,000,000,000 total damage",icon:"ðŸŒŒ",category:"combat",unlocked:!1,check:e=>e.stats.totalDamage>=1e10},{id:"first_crit",name:"Lucky Shot",description:"Land your first critical hit",icon:"âœ¨",category:"combat",unlocked:!1,check:e=>e.stats.criticalHits>=1},{id:"crit_hunter",name:"Crit Hunter",description:"Land 100 critical hits",icon:"ðŸ’Ž",category:"combat",unlocked:!1,check:e=>e.stats.criticalHits>=100},{id:"crit_master",name:"Crit Master",description:"Land 1,000 critical hits",icon:"ðŸ’¥",category:"combat",unlocked:!1,check:e=>e.stats.criticalHits>=1e3},{id:"crit_legend",name:"Crit Legend",description:"Land 10,000 critical hits",icon:"â­",category:"combat",unlocked:!1,check:e=>e.stats.criticalHits>=1e4},{id:"level_5",name:"Novice",description:"Reach level 5",icon:"ðŸŒŸ",category:"progression",unlocked:!1,check:e=>e.level>=5},{id:"level_10",name:"Apprentice",description:"Reach level 10",icon:"âœ¨",category:"progression",unlocked:!1,check:e=>e.level>=10},{id:"level_25",name:"Journeyman",description:"Reach level 25",icon:"ðŸ’«",category:"progression",unlocked:!1,check:e=>e.level>=25},{id:"level_50",name:"Expert",description:"Reach level 50",icon:"ðŸŒ ",category:"progression",unlocked:!1,check:e=>e.level>=50},{id:"level_60",name:"Veteran",description:"Reach level 60",icon:"ðŸŽ–ï¸",category:"progression",unlocked:!1,check:e=>e.level>=60},{id:"level_65",name:"Elite",description:"Reach level 65",icon:"ðŸ’ ",category:"progression",unlocked:!1,check:e=>e.level>=65},{id:"level_70",name:"Champion",description:"Reach level 70",icon:"ðŸ”±",category:"progression",unlocked:!1,check:e=>e.level>=70},{id:"level_75",name:"Master",description:"Reach level 75",icon:"â­",category:"progression",unlocked:!1,check:e=>e.level>=75},{id:"level_80",name:"Grandmaster",description:"Reach level 80",icon:"ðŸ’Ž",category:"progression",unlocked:!1,check:e=>e.level>=80},{id:"level_85",name:"Titan",description:"Reach level 85",icon:"âš¡",category:"progression",unlocked:!1,check:e=>e.level>=85},{id:"level_90",name:"Demigod",description:"Reach level 90",icon:"âœ¨",category:"progression",unlocked:!1,check:e=>e.level>=90},{id:"level_95",name:"Immortal",description:"Reach level 95",icon:"ðŸŒŸ",category:"progression",unlocked:!1,check:e=>e.level>=95},{id:"level_100",name:"Legendary",description:"Reach level 100",icon:"ðŸ†",category:"progression",unlocked:!1,check:e=>e.level>=100},{id:"level_150",name:"Transcendent",description:"Reach level 150",icon:"ðŸ‘‘",category:"progression",unlocked:!1,check:e=>e.level>=150},{id:"level_200",name:"Ascended",description:"Reach level 200",icon:"ðŸŒŒ",category:"progression",unlocked:!1,check:e=>e.level>=200},{id:"first_ship",name:"Fleet Commander",description:"Recruit your first additional ship",icon:"ðŸš€",category:"collection",unlocked:!1,check:e=>e.shipsCount>=2},{id:"small_fleet",name:"Small Fleet",description:"Command 5 ships",icon:"ðŸ›¸",category:"collection",unlocked:!1,check:e=>e.shipsCount>=5},{id:"armada",name:"Armada",description:"Command 10 ships",icon:"ðŸŒŒ",category:"collection",unlocked:!1,check:e=>e.shipsCount>=10},{id:"space_force",name:"Space Force",description:"Command 20 ships",icon:"ðŸŒ ",category:"collection",unlocked:!1,check:e=>e.shipsCount>=20},{id:"galactic_empire",name:"Galactic Empire",description:"Command 30 ships",icon:"ðŸ‘‘",category:"collection",unlocked:!1,check:e=>e.shipsCount>=30},{id:"armada_supreme",name:"Supreme Armada",description:"Command 50 ships",icon:"ðŸ’«",category:"collection",unlocked:!1,check:e=>e.shipsCount>=50},{id:"first_upgrade",name:"Innovator",description:"Purchase your first upgrade",icon:"ðŸ”§",category:"collection",unlocked:!1,check:e=>e.stats.totalUpgrades>=1},{id:"upgrade_enthusiast",name:"Upgrade Enthusiast",description:"Purchase 25 upgrades",icon:"âš™ï¸",category:"collection",unlocked:!1,check:e=>e.stats.totalUpgrades>=25},{id:"upgrade_master",name:"Upgrade Master",description:"Purchase 100 upgrades",icon:"ðŸ”©",category:"collection",unlocked:!1,check:e=>e.stats.totalUpgrades>=100},{id:"upgrade_legend",name:"Upgrade Legend",description:"Purchase 500 upgrades",icon:"ðŸ› ï¸",category:"collection",unlocked:!1,check:e=>e.stats.totalUpgrades>=500},{id:"upgrade_deity",name:"Upgrade Deity",description:"Purchase 1,000 upgrades",icon:"ðŸ­",category:"collection",unlocked:!1,check:e=>e.stats.totalUpgrades>=1e3},{id:"first_subupgrade",name:"Researcher",description:"Unlock your first special technology",icon:"ðŸ”¬",category:"collection",unlocked:!1,check:e=>e.stats.totalSubUpgrades>=1},{id:"tech_collector",name:"Tech Collector",description:"Unlock 5 special technologies",icon:"ðŸ“¡",category:"collection",unlocked:!1,check:e=>e.stats.totalSubUpgrades>=5},{id:"tech_master",name:"Tech Master",description:"Unlock 10 special technologies",icon:"ðŸ›°ï¸",category:"collection",unlocked:!1,check:e=>e.stats.totalSubUpgrades>=10},{id:"tech_legend",name:"Tech Legend",description:"Unlock 20 special technologies",icon:"ðŸ”­",category:"collection",unlocked:!1,check:e=>e.stats.totalSubUpgrades>=20},{id:"tech_god",name:"Technology God",description:"Unlock all special technologies",icon:"ðŸŒ",category:"collection",unlocked:!1,check:e=>e.stats.totalSubUpgrades>=33},{id:"first_thousand",name:"Starter Capital",description:"Accumulate 1,000 points",icon:"ðŸ’°",category:"mastery",unlocked:!1,check:e=>e.points>=1e3},{id:"ten_thousand",name:"Entrepreneur",description:"Accumulate 10,000 points",icon:"ðŸ’Ž",category:"mastery",unlocked:!1,check:e=>e.points>=1e4},{id:"hundred_thousand",name:"Wealthy",description:"Accumulate 100,000 points",icon:"ðŸ’µ",category:"mastery",unlocked:!1,check:e=>e.points>=1e5},{id:"million",name:"Millionaire",description:"Accumulate 1,000,000 points",icon:"ðŸ¤‘",category:"mastery",unlocked:!1,check:e=>e.points>=1e6},{id:"ten_million",name:"Tycoon",description:"Accumulate 10,000,000 points",icon:"ðŸ‘‘",category:"mastery",unlocked:!1,check:e=>e.points>=1e7},{id:"hundred_million",name:"Magnate",description:"Accumulate 100,000,000 points",icon:"ðŸ’«",category:"mastery",unlocked:!1,check:e=>e.points>=1e8},{id:"billion",name:"Billionaire",description:"Accumulate 1,000,000,000 points",icon:"ðŸŒŸ",category:"mastery",unlocked:!1,check:e=>e.points>=1e9},{id:"five_minutes",name:"Getting Started",description:"Play for 5 minutes",icon:"â±ï¸",category:"progression",unlocked:!1,check:e=>e.stats.playTime>=300},{id:"thirty_minutes",name:"Committed",description:"Play for 30 minutes",icon:"â°",category:"progression",unlocked:!1,check:e=>e.stats.playTime>=1800},{id:"one_hour",name:"Dedicated",description:"Play for 1 hour",icon:"ðŸ•",category:"progression",unlocked:!1,check:e=>e.stats.playTime>=3600},{id:"three_hours",name:"Addicted",description:"Play for 3 hours",icon:"âŒš",category:"progression",unlocked:!1,check:e=>e.stats.playTime>=10800},{id:"ten_hours",name:"Obsessed",description:"Play for 10 hours",icon:"ðŸ•°ï¸",category:"progression",unlocked:!1,check:e=>e.stats.playTime>=36e3},{id:"one_day",name:"No Life",description:"Play for 24 hours (total)",icon:"ðŸ“…",category:"progression",unlocked:!1,check:e=>e.stats.playTime>=86400},{id:"speed_demon",name:"Speed Demon",description:"Reach Attack Speed level 20",icon:"ðŸ’¨",category:"mastery",unlocked:!1,check:e=>e.attackSpeedLevel>=20},{id:"speed_god",name:"Speed God",description:"Reach Attack Speed level 50",icon:"âš¡",category:"mastery",unlocked:!1,check:e=>e.attackSpeedLevel>=50},{id:"damage_king",name:"Damage King",description:"Reach Damage Amplifier level 20",icon:"ðŸ‘‘",category:"mastery",unlocked:!1,check:e=>e.pointMultiplierLevel>=20},{id:"damage_emperor",name:"Damage Emperor",description:"Reach Damage Amplifier level 50",icon:"ðŸ”¥",category:"mastery",unlocked:!1,check:e=>e.pointMultiplierLevel>=50},{id:"crit_specialist",name:"Crit Specialist",description:"Reach Critical Strike level 20",icon:"âœ¨",category:"mastery",unlocked:!1,check:e=>e.critChanceLevel>=20},{id:"passive_master",name:"Passive Master",description:"Reach Passive Income level 30",icon:"ðŸ­",category:"mastery",unlocked:!1,check:e=>e.resourceGenLevel>=30},{id:"scholar",name:"Scholar",description:"Reach Knowledge Core level 25",icon:"ðŸ“š",category:"mastery",unlocked:!1,check:e=>e.xpBoostLevel>=25},{id:"balanced",name:"Balanced",description:"Have all main upgrades at level 10 or higher",icon:"âš–ï¸",category:"mastery",unlocked:!1,check:e=>e.shipsCount>=10&&e.attackSpeedLevel>=10&&e.pointMultiplierLevel>=10&&e.critChanceLevel>=10&&e.resourceGenLevel>=10&&e.xpBoostLevel>=10},{id:"well_rounded",name:"Well Rounded",description:"Have all main upgrades at level 25 or higher",icon:"ðŸŽ¯",category:"mastery",unlocked:!1,check:e=>e.shipsCount>=25&&e.attackSpeedLevel>=25&&e.pointMultiplierLevel>=25&&e.critChanceLevel>=25&&e.resourceGenLevel>=25&&e.xpBoostLevel>=25},{id:"ultimate_power",name:"Ultimate Power",description:"Have all main upgrades at level 50 or higher",icon:"ðŸ’¥",category:"mastery",unlocked:!1,check:e=>e.shipsCount>=50&&e.attackSpeedLevel>=50&&e.pointMultiplierLevel>=50&&e.critChanceLevel>=50&&e.resourceGenLevel>=50&&e.xpBoostLevel>=50},{id:"mega_fleet",name:"Mega Fleet Commander",description:"Command 75 ships",icon:"ðŸš",category:"mastery",unlocked:!1,check:e=>e.shipsCount>=75},{id:"ultra_speed",name:"Ultra Speed",description:"Reach Attack Speed level 75",icon:"ðŸ’«",category:"mastery",unlocked:!1,check:e=>e.attackSpeedLevel>=75},{id:"damage_cosmic",name:"Cosmic Damage",description:"Reach Damage Amplifier level 75",icon:"ðŸ”†",category:"mastery",unlocked:!1,check:e=>e.pointMultiplierLevel>=75},{id:"crit_god",name:"Critical God",description:"Reach Critical Strike level 40",icon:"âš¡",category:"mastery",unlocked:!1,check:e=>e.critChanceLevel>=40},{id:"passive_overlord",name:"Passive Overlord",description:"Reach Passive Income level 60",icon:"ðŸ¦",category:"mastery",unlocked:!1,check:e=>e.resourceGenLevel>=60},{id:"knowledge_deity",name:"Knowledge Deity",description:"Reach Knowledge Core level 50",icon:"ðŸ§ ",category:"mastery",unlocked:!1,check:e=>e.xpBoostLevel>=50},{id:"super_rich",name:"Super Rich",description:"Accumulate 10,000,000,000 points",icon:"ðŸ°",category:"mastery",unlocked:!1,check:e=>e.points>=1e10},{id:"ultra_rich",name:"Ultra Rich",description:"Accumulate 100,000,000,000 points",icon:"ðŸŒ ",category:"mastery",unlocked:!1,check:e=>e.points>=1e11},{id:"click_maniac",name:"Click Maniac",description:"Click 100,000 times",icon:"ðŸ”¥",category:"mastery",unlocked:!1,check:e=>e.stats.totalClicks>=1e5},{id:"crit_storm",name:"Critical Storm",description:"Land 50,000 critical hits",icon:"â›ˆï¸",category:"mastery",unlocked:!1,check:e=>e.stats.criticalHits>=5e4},{id:"secret_patience",name:"Patience is a Virtue",description:"Wait without clicking for 30 seconds",icon:"ðŸ§˜",category:"secret",unlocked:!1,hidden:!0,check:e=>e.stats.totalClicks===0&&e.stats.playTime>=30},{id:"secret_speed",name:"Speed Clicker",description:"Click 100 times in the first minute",icon:"ðŸ’¨",category:"secret",unlocked:!1,hidden:!0,check:e=>e.stats.totalClicks>=100&&e.stats.playTime<=60},{id:"secret_cosmic",name:"Cosmic Ascension",description:"Unlock the Cosmic Ascension Protocol",icon:"ðŸŒŒ",category:"secret",unlocked:!1,check:e=>e.subUpgrades.cosmic_ascension===!0},{id:"secret_singularity",name:"Singularity",description:"Unlock the Singularity Power Core",icon:"âš«",category:"secret",unlocked:!1,check:e=>e.subUpgrades.singularity_core===!0},{id:"secret_meaning",name:"The Meaning of Life",description:"Unlock the Meaning of Life upgrade",icon:"ðŸ”®",category:"secret",unlocked:!1,check:e=>e.subUpgrades.meaning_of_life===!0},{id:"secret_perfect",name:"Perfection",description:"Unlock all special technologies",icon:"âœ¨",category:"secret",unlocked:!1,hidden:!0,check:e=>e.stats.totalSubUpgrades>=33},{id:"secret_coffee",name:"Caffeine Addict",description:"Unlock the Crew Coffee Machine",icon:"â˜•",category:"secret",unlocked:!1,check:e=>e.subUpgrades.coffee_machine===!0},{id:"secret_answer",name:"42",description:"Unlock the Answer to Everything",icon:"4ï¸âƒ£2ï¸âƒ£",category:"secret",unlocked:!1,check:e=>e.subUpgrades.answer_to_everything===!0},{id:"secret_dragon",name:"Dragon Tamer",description:"Unlock the Dragon Egg",icon:"ðŸ¥š",category:"secret",unlocked:!1,check:e=>e.subUpgrades.dragon_egg===!0},{id:"secret_gauntlet",name:"Perfectly Balanced",description:"Unlock the Infinity Gauntlet (Replica)",icon:"ðŸ’",category:"secret",unlocked:!1,check:e=>e.subUpgrades.infinity_gauntlet===!0},{id:"secret_plasma",name:"Plasma Master",description:"Unlock the Plasma Energy Matrix",icon:"âš›ï¸",category:"secret",unlocked:!1,check:e=>e.subUpgrades.plasma_matrix===!0},{id:"secret_temporal",name:"Time Lord",description:"Unlock Temporal Acceleration Field",icon:"â°",category:"secret",unlocked:!1,check:e=>e.subUpgrades.temporal_acceleration===!0},{id:"secret_quantum",name:"Quantum Physicist",description:"Unlock Quantum Entanglement Core",icon:"ðŸ”¬",category:"secret",unlocked:!1,check:e=>e.subUpgrades.quantum_entanglement===!0},{id:"secret_dark_matter",name:"Dark Matter Harvester",description:"Unlock Dark Matter Engine",icon:"ðŸŒ‘",category:"secret",unlocked:!1,check:e=>e.subUpgrades.dark_matter_engine===!0},{id:"secret_hyper",name:"Hyper-Dimensional",description:"Unlock Hyper-Dimensional Reactor",icon:"ðŸ”®",category:"secret",unlocked:!1,check:e=>e.subUpgrades.hyper_reactor===!0},{id:"secret_reality",name:"Reality Bender",description:"Unlock Reality Anchor",icon:"ðŸŒ€",category:"secret",unlocked:!1,check:e=>e.subUpgrades.reality_anchor===!0},{id:"secret_nanobots",name:"Nanotech Engineer",description:"Unlock Self-Replicating Nanobots",icon:"ðŸ¤–",category:"secret",unlocked:!1,check:e=>e.subUpgrades.nanobots===!0},{id:"secret_hologram",name:"Master of Illusion",description:"Unlock Holographic Decoy System",icon:"ðŸ‘»",category:"secret",unlocked:!1,check:e=>e.subUpgrades.holographic_decoys===!0},{id:"secret_photon",name:"Light Speed Master",description:"Unlock Photon Wave Amplifier",icon:"ðŸ’¡",category:"secret",unlocked:!1,check:e=>e.subUpgrades.photon_amplifier===!0},{id:"secret_stellar",name:"Stellar Engineer",description:"Unlock Stellar Forge",icon:"ðŸŒŸ",category:"secret",unlocked:!1,check:e=>e.subUpgrades.stellar_forge===!0},{id:"secret_nebula",name:"Nebula Harvester",description:"Unlock Nebula Energy Harvester",icon:"ðŸŒŒ",category:"secret",unlocked:!1,check:e=>e.subUpgrades.nebula_harvester===!0},{id:"secret_battery",name:"Cosmic Energy Master",description:"Unlock Cosmic Energy Battery",icon:"ðŸ”‹",category:"secret",unlocked:!1,check:e=>e.subUpgrades.cosmic_battery===!0},{id:"secret_tech_master_v2",name:"Technology Master V2",description:"Unlock 40 special technologies",icon:"ðŸ›¸",category:"secret",unlocked:!1,hidden:!0,check:e=>e.stats.totalSubUpgrades>=40}]}setOnUnlock(e){this.onUnlockCallback=e}checkAchievements(e){for(const t of this.achievements)!t.unlocked&&t.check(e)&&(t.unlocked=!0,e.achievements[t.id]=!0,this.onUnlockCallback&&this.onUnlockCallback(t))}updateFromState(e){for(const t of this.achievements)t.unlocked=e.achievements[t.id]??!1}getAchievements(){return this.achievements}getUnlockedCount(){return this.achievements.filter(e=>e.unlocked).length}getTotalCount(){return this.achievements.length}getProgress(){return this.getUnlockedCount()/this.getTotalCount()*100}}class Z{ascensionUpgrades=[];constructor(){this.initializeUpgrades()}initializeUpgrades(){this.ascensionUpgrades=[{id:"prestige_damage",name:"Eternal Power",description:"Permanently increase all damage",cost:1,maxLevel:50,getCurrentLevel:e=>e.prestigeUpgrades?.prestige_damage??0,effect:"+10% damage per level"},{id:"prestige_points",name:"Cosmic Fortune",description:"Permanently increase point gains",cost:1,maxLevel:50,getCurrentLevel:e=>e.prestigeUpgrades?.prestige_points??0,effect:"+15% points per level"},{id:"prestige_xp",name:"Ancient Wisdom",description:"Permanently increase XP gains",cost:1,maxLevel:50,getCurrentLevel:e=>e.prestigeUpgrades?.prestige_xp??0,effect:"+20% XP per level"},{id:"prestige_crit",name:"Lucky Stars",description:"Permanently increase critical hit chance",cost:2,maxLevel:25,getCurrentLevel:e=>e.prestigeUpgrades?.prestige_crit??0,effect:"+2% crit chance per level"},{id:"prestige_passive",name:"Idle Mastery",description:"Permanently increase passive generation",cost:2,maxLevel:30,getCurrentLevel:e=>e.prestigeUpgrades?.prestige_passive??0,effect:"+25% passive per level"},{id:"prestige_speed",name:"Time Dilation",description:"Permanently increase attack speed",cost:3,maxLevel:20,getCurrentLevel:e=>e.prestigeUpgrades?.prestige_speed??0,effect:"+5% attack speed per level"},{id:"prestige_starting_level",name:"Head Start",description:"Start at a higher level after ascension",cost:5,maxLevel:10,getCurrentLevel:e=>e.prestigeUpgrades?.prestige_starting_level??0,effect:"Start +5 levels per level"},{id:"prestige_retain_upgrades",name:"Persistent Memory",description:"Retain a percentage of upgrade levels",cost:10,maxLevel:5,getCurrentLevel:e=>e.prestigeUpgrades?.prestige_retain_upgrades??0,effect:"Retain +10% upgrades per level"}]}getUpgrades(){return this.ascensionUpgrades}calculatePrestigePoints(e){if(e.level<100)return 0;const t=e.level-100,s=Math.floor(5+Math.pow(t/10,1.5)),a=Math.floor(e.stats.bossesKilled/2);return Math.max(5,s+a)}canAscend(e){return e.level>=100}getDamageMultiplier(e){return 1+(e.prestigeUpgrades?.prestige_damage??0)*.1}getPointsMultiplier(e){return 1+(e.prestigeUpgrades?.prestige_points??0)*.15}getXPMultiplier(e){return 1+(e.prestigeUpgrades?.prestige_xp??0)*.2}getCritBonus(e){return(e.prestigeUpgrades?.prestige_crit??0)*2}getPassiveMultiplier(e){return 1+(e.prestigeUpgrades?.prestige_passive??0)*.25}getSpeedMultiplier(e){return 1+(e.prestigeUpgrades?.prestige_speed??0)*.05}getStartingLevel(e){return 1+(e.prestigeUpgrades?.prestige_starting_level??0)*5}getRetainPercentage(e){return(e.prestigeUpgrades?.prestige_retain_upgrades??0)*.1}buyPrestigeUpgrade(e,t){const s=this.ascensionUpgrades.find(o=>o.id===t);if(!s)return!1;const a=s.getCurrentLevel(e);if(a>=s.maxLevel)return!1;const i=s.cost;return e.prestigePoints<i?!1:(e.prestigeUpgrades||(e.prestigeUpgrades={}),e.prestigePoints-=i,e.prestigeUpgrades[t]=a+1,!0)}}class ee{x;y;vx;vy;color;size;life;maxLife;decay;glow;constructor(e){this.x=e.x,this.y=e.y,this.vx=e.vx,this.vy=e.vy,this.color=e.color,this.size=e.size,this.life=e.life,this.maxLife=e.life,this.decay=e.decay,this.glow=e.glow??!1}update(e){return this.x+=this.vx*e,this.y+=this.vy*e,this.life-=this.decay*e,this.vy+=100*e,this.vx*=.99,this.vy*=.99,this.life<=0}draw(e){const t=this.life/this.maxLife;e.setAlpha(t),this.glow&&e.setGlow(this.color,10),e.setFill(this.color),e.circle(this.x,this.y,this.size),this.glow&&e.clearGlow(),e.resetAlpha()}}class te{particles=[];maxParticles=200;spawnParticles(e){const{x:t,y:s,count:a,color:i="#fff",spread:o=Math.PI*2,speed:n=100,size:l=3,life:c=1,glow:h=!1}=e;for(let u=0;u<a&&!(this.particles.length>=this.maxParticles);u++){const g=Math.random()*o-o/2,p=n*(.5+Math.random()*.5);this.particles.push(new ee({x:t,y:s,vx:Math.cos(g)*p,vy:Math.sin(g)*p,color:i,size:l*(.5+Math.random()),life:c,decay:1,glow:h}))}}spawnExplosion(e,t,s="#ff0000"){this.spawnParticles({x:e,y:t,count:30,color:s,spread:Math.PI*2,speed:200,size:4,life:.8,glow:!0})}spawnTrail(e,t,s="#ffffff"){this.spawnParticles({x:e,y:t,count:2,color:s,spread:Math.PI/4,speed:30,size:2,life:.4,glow:!1})}update(e){this.particles=this.particles.filter(t=>!t.update(e))}draw(e){for(const t of this.particles)t.draw(e)}clear(){this.particles=[]}}class se{numbers=[];enabled=!0;maxNumbers=15;setEnabled(e){this.enabled=e}spawnDamageNumber(e,t,s,a=!1){if(!this.enabled)return;this.numbers.length>=this.maxNumbers&&this.numbers.shift();const i=this.formatDamage(s),o=a?"#ffff00":"#ffffff";this.numbers.push({x:e+(Math.random()-.5)*40,y:t+(Math.random()-.5)*20,text:i,color:o,life:1,maxLife:1,vy:-120,isCrit:a})}update(e){for(const t of this.numbers)t.y+=t.vy*e,t.vy+=50*e,t.life-=e;this.numbers=this.numbers.filter(t=>t.life>0)}draw(e){const t=e.getContext();t.save(),t.textAlign="center",t.textBaseline="middle";for(const s of this.numbers){const a=Math.min(1,s.life/.4);t.globalAlpha=a;const i=s.isCrit?18:14;t.font=`bold ${i}px monospace`,t.fillStyle="#000",t.fillText(s.text,s.x-1,s.y-1),t.fillText(s.text,s.x+1,s.y+1),t.fillStyle=s.color,t.fillText(s.text,s.x,s.y)}t.restore()}clear(){this.numbers=[]}formatDamage(e){return e>=1e9?`${(e/1e9).toFixed(1)}B`:e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:Math.floor(e).toString()}}class ie{combo=0;comboTimer=0;comboTimeout=3;maxCombo=0;comboAnimationTime=0;hit(){this.combo++,this.comboTimer=this.comboTimeout,this.comboAnimationTime=.3,this.combo>this.maxCombo&&(this.maxCombo=this.combo)}miss(){this.combo=0,this.comboTimer=0}update(e){this.comboTimer>0&&(this.comboTimer-=e,this.comboTimer<=0&&(this.combo=0)),this.comboAnimationTime>0&&(this.comboAnimationTime-=e)}getCombo(){return this.combo}getMaxCombo(){return this.maxCombo}getMultiplier(){return this.combo<10?1:this.combo<25?1.1:this.combo<50?1.25:this.combo<100?1.5:2}draw(e,t){if(this.combo<5)return;const s=e.getContext(),a=t-150,i=100;s.save();const o=this.comboAnimationTime>0?1+this.comboAnimationTime/.3*.3:1;s.translate(a,i),s.scale(o,o),s.translate(-a,-i),s.fillStyle="rgba(0, 0, 0, 0.7)",s.fillRect(a-70,i-35,140,70),s.strokeStyle=this.getComboColor(),s.lineWidth=3,s.strokeRect(a-70,i-35,140,70),s.font='bold 32px "Courier New", monospace',s.textAlign="center",s.textBaseline="middle",s.shadowColor=this.getComboColor(),s.shadowBlur=15,s.fillStyle=this.getComboColor(),s.fillText(`${this.combo}x`,a,i-5),s.font='bold 14px "Courier New", monospace',s.shadowBlur=5,s.fillText("COMBO!",a,i+20);const n=this.getMultiplier();n>1&&(s.font='bold 12px "Courier New", monospace',s.fillStyle="#ffaa00",s.fillText(`${n.toFixed(1)}x DMG`,a,i-25));const l=this.comboTimer/this.comboTimeout;s.shadowBlur=0,s.fillStyle="rgba(0, 0, 0, 0.5)",s.fillRect(a-65,i+30,130,4),s.fillStyle=this.getComboColor(),s.fillRect(a-65,i+30,130*l,4),s.restore()}getComboColor(){return this.combo>=100?"#ff00ff":this.combo>=50?"#ff0000":this.combo>=25?"#ffaa00":this.combo>=10?"#ffff00":"#ffffff"}reset(){this.combo=0,this.comboTimer=0,this.comboAnimationTime=0}}class ae{enabled=!0;context=null;volume=.3;constructor(){try{this.context=new(window.AudioContext||window.webkitAudioContext)}catch{console.warn("Audio not supported"),this.enabled=!1}}setEnabled(e){this.enabled=e}isEnabled(){return this.enabled}setVolume(e){this.volume=Math.max(0,Math.min(1,e))}getVolume(){return this.volume}playTone(e,t,s="sine",a=this.volume){if(!this.enabled||!this.context)return;const i=this.context.createOscillator(),o=this.context.createGain();i.connect(o),o.connect(this.context.destination),i.frequency.value=e,i.type=s,o.gain.setValueAtTime(a,this.context.currentTime),o.gain.exponentialRampToValueAtTime(.01,this.context.currentTime+t),i.start(this.context.currentTime),i.stop(this.context.currentTime+t)}playClick(){if(!this.enabled||!this.context)return;const e=this.context.createOscillator(),t=this.context.createGain();e.connect(t),t.connect(this.context.destination),e.frequency.setValueAtTime(800,this.context.currentTime),e.frequency.exponentialRampToValueAtTime(200,this.context.currentTime+.08),e.type="square",t.gain.setValueAtTime(.25*this.volume,this.context.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.context.currentTime+.08),e.start(this.context.currentTime),e.stop(this.context.currentTime+.08)}playPurchase(){!this.enabled||!this.context||([523,659,784,1047].forEach((e,t)=>{setTimeout(()=>{this.playTone(e,.12,"triangle",.22*this.volume)},t*40)}),this.playTone(100,.08,"square",.3*this.volume))}playLevelUp(){!this.enabled||!this.context||([392,523,659,784,1047].forEach((e,t)=>{setTimeout(()=>{this.playTone(e,.2,"triangle",.25*this.volume)},t*55)}),setTimeout(()=>{this.playTone(98,.3,"sine",.35*this.volume)},280))}playBossAppear(){if(!this.enabled||!this.context)return;const e=this.context.createOscillator(),t=this.context.createGain();e.connect(t),t.connect(this.context.destination),e.frequency.setValueAtTime(200,this.context.currentTime),e.frequency.exponentialRampToValueAtTime(100,this.context.currentTime+.5),e.type="sawtooth",t.gain.setValueAtTime(.3*this.volume,this.context.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.context.currentTime+.5),e.start(this.context.currentTime),e.stop(this.context.currentTime+.5)}playBossDefeat(){!this.enabled||!this.context||[523,659,784,1047].forEach((e,t)=>{setTimeout(()=>{this.playTone(e,.2,"triangle",.25*this.volume)},t*80)})}playCombo(e){if(!this.enabled||!this.context)return;const t=600+e*30,s=Math.min(t,1500),a=this.context.createOscillator(),i=this.context.createGain();a.connect(i),i.connect(this.context.destination),a.frequency.setValueAtTime(s,this.context.currentTime),a.frequency.exponentialRampToValueAtTime(s*.5,this.context.currentTime+.1),a.type="square",i.gain.setValueAtTime(.3*this.volume,this.context.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.context.currentTime+.1),a.start(this.context.currentTime),a.stop(this.context.currentTime+.1)}playAchievement(){!this.enabled||!this.context||([523,659,784,1047,1319].forEach((e,t)=>{setTimeout(()=>{this.playTone(e,.18,"triangle",.25*this.volume)},t*45)}),setTimeout(()=>{this.playTone(130,.25,"sine",.4*this.volume)},225))}playMetronomeTick(){if(!this.enabled||!this.context)return;const e=this.context.createOscillator(),t=this.context.createGain();e.connect(t),t.connect(this.context.destination),e.frequency.setValueAtTime(1200,this.context.currentTime),e.type="sine",t.gain.setValueAtTime(.15*this.volume,this.context.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.context.currentTime+.05),e.start(this.context.currentTime),e.stop(this.context.currentTime+.05)}playPerfectHit(){if(!this.enabled||!this.context)return;const e=this.context.createOscillator(),t=this.context.createGain();e.connect(t),t.connect(this.context.destination),e.frequency.setValueAtTime(1500,this.context.currentTime),e.frequency.exponentialRampToValueAtTime(2e3,this.context.currentTime+.1),e.type="sine",t.gain.setValueAtTime(.25*this.volume,this.context.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.context.currentTime+.1),e.start(this.context.currentTime),e.stop(this.context.currentTime+.1)}playMissSound(){if(!this.enabled||!this.context)return;const e=this.context.createOscillator(),t=this.context.createGain();e.connect(t),t.connect(this.context.destination),e.frequency.setValueAtTime(200,this.context.currentTime),e.frequency.exponentialRampToValueAtTime(100,this.context.currentTime+.15),e.type="sawtooth",t.gain.setValueAtTime(.2*this.volume,this.context.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.context.currentTime+.15),e.start(this.context.currentTime),e.stop(this.context.currentTime+.15)}}class oe{pointsDisplay;levelText;expText;levelBarFill;dpsDisplay=null;passiveDisplay=null;critDisplay=null;damageHistory=[];DPS_WINDOW=5e3;constructor(){const e=document.getElementById("points-display");if(!e)throw new Error("Points display element not found");this.pointsDisplay=e;const t=document.getElementById("level-text");if(!t)throw new Error("Level text element not found");this.levelText=t;const s=document.getElementById("exp-text");if(!s)throw new Error("Exp text element not found");this.expText=s;const a=document.getElementById("level-bar-fill");if(!a)throw new Error("Level bar fill element not found");this.levelBarFill=a,this.createStatsDisplay()}createStatsDisplay(){const e=document.createElement("div");e.id="stats-display",e.style.cssText=`
      margin-top: 15px;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      font-size: 14px;
      max-width: 300px;
    `,this.dpsDisplay=document.createElement("div"),this.dpsDisplay.style.cssText="margin-bottom: 5px; color: #ff8888;",this.dpsDisplay.textContent="âš”ï¸ DPS: 0",this.passiveDisplay=document.createElement("div"),this.passiveDisplay.style.cssText="margin-bottom: 5px; color: #88ff88;",this.passiveDisplay.textContent="ðŸ­ Passive: 0/sec",this.critDisplay=document.createElement("div"),this.critDisplay.style.cssText="color: #ffff88;",this.critDisplay.textContent="âœ¨ Crit: 0%",e.appendChild(this.dpsDisplay),e.appendChild(this.passiveDisplay),e.appendChild(this.critDisplay);const t=document.getElementById("hud");t&&t.appendChild(e)}update(e){this.pointsDisplay.textContent=`ðŸ’° Points: ${this.formatNumber(e)}`}updateStats(e,t,s){this.dpsDisplay&&(this.dpsDisplay.textContent=`âš”ï¸ DPS: ${this.formatNumber(e)}`),this.passiveDisplay&&(this.passiveDisplay.textContent=`ðŸ­ Passive: ${this.formatNumber(t)}/sec`),this.critDisplay&&(this.critDisplay.textContent=`âœ¨ Crit: ${s.toFixed(1)}%`)}recordDamage(e){const t=Date.now();this.damageHistory.push({damage:e,time:t}),this.damageHistory=this.damageHistory.filter(s=>t-s.time<this.DPS_WINDOW)}calculateDPS(){if(this.damageHistory.length===0)return 0;const e=Date.now(),t=e-this.DPS_WINDOW,s=this.damageHistory.filter(o=>o.time>=t);if(s.length===0)return 0;const a=s.reduce((o,n)=>o+n.damage,0),i=(e-s[0].time)/1e3;return i>0?a/i:0}updateLevel(e,t,s){this.levelText.textContent=`â­ Level ${e}`,this.expText.textContent=`${Math.floor(t)} / ${s}`;const a=Math.min(100,t/s*100);this.levelBarFill.style.width=`${a}%`,e%10===0&&e>0?(this.levelText.style.color="#ffd700",this.levelText.style.textShadow="0 0 10px #ffd700"):e%5===0?(this.levelText.style.color="#ffaa00",this.levelText.style.textShadow="0 0 8px #ffaa00"):(this.levelText.style.color="#fff",this.levelText.style.textShadow="0 0 2px rgba(255, 255, 255, 0.8)")}formatNumber(e){return e>=1e9?`${(e/1e9).toFixed(2)}B`:e>=1e6?`${(e/1e6).toFixed(2)}M`:e>=1e3?`${(e/1e3).toFixed(2)}K`:Math.floor(e).toString()}}class ne{element;clickHandler;lastClickTime=0;clickDelay=100;constructor(e,t){this.clickHandler=t,this.element=document.createElement("button"),this.element.textContent=e,this.element.className="shop-button",this.element.addEventListener("click",s=>{s.stopPropagation(),this.handleClick()}),this.element.addEventListener("keydown",s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),s.stopPropagation(),this.handleClick())})}handleClick(){const e=Date.now();e-this.lastClickTime<this.clickDelay||this.element.disabled||(this.lastClickTime=e,this.clickHandler())}getElement(){return this.element}setEnabled(e){this.element.disabled=!e}setText(e){this.element.textContent=e}}class re{constructor(e,t){this.store=e,this.upgradeSystem=t;const s=document.getElementById("shop-content");if(!s)throw new Error("Shop content element not found");this.container=s;const a=document.getElementById("shop-panel");a&&(a.addEventListener("click",i=>{i.stopPropagation()}),a.addEventListener("touchstart",i=>{i.stopPropagation()}),a.addEventListener("mousedown",i=>{i.stopPropagation()})),this.setupTabs(),this.render(),this.store.subscribe(()=>{this.scheduleRender()})}container;renderTimeout=null;isRendering=!1;isProcessingPurchase=!1;lastAffordability=new Map;currentTab="available";buttonCache=new Map;soundManager=null;lastUpdateTime=0;updateThrottle=30;setSoundManager(e){this.soundManager=e}setupTabs(){const e=document.getElementById("tab-available"),t=document.getElementById("tab-owned");e?.addEventListener("click",()=>{this.currentTab="available",e.classList.add("active"),t?.classList.remove("active"),this.render()}),t?.addEventListener("click",()=>{this.currentTab="owned",t.classList.add("active"),e?.classList.remove("active"),this.render()})}scheduleRender(){if(this.isProcessingPurchase)return;const t=this.store.getState().points,a=this.isNearAffordable(t)?10:this.updateThrottle,i=Date.now();i-this.lastUpdateTime<a||(this.lastUpdateTime=i,this.renderTimeout!==null&&cancelAnimationFrame(this.renderTimeout),this.renderTimeout=requestAnimationFrame(()=>{this.hasAffordabilityChanged()&&this.updateButtonStates(),this.renderTimeout=null}))}isNearAffordable(e){const t=this.store.getState(),s=this.upgradeSystem.getUpgrades();for(const i of s){const o=i.getCost(i.getLevel(t));if(e>=o*.9&&e<o)return!0}const a=this.upgradeSystem.getSubUpgrades();for(const i of a)if(!(!i.isVisible(t)||i.owned)&&e>=i.cost*.9&&e<i.cost)return!0;return!1}hasAffordabilityChanged(){const e=this.store.getState(),t=this.upgradeSystem.getUpgrades();let s=!1;for(const i of t){const o=i.id,n=i.canBuy(e);this.lastAffordability.get(o)!==n&&(s=!0,this.lastAffordability.set(o,n))}const a=this.upgradeSystem.getSubUpgrades();for(const i of a){if(!i.isVisible(e))continue;const o=`sub_${i.id}`,n=!i.owned&&e.points>=i.cost;this.lastAffordability.get(o)!==n&&(s=!0,this.lastAffordability.set(o,n))}return s}updateButtonStates(){const e=this.store.getState();requestAnimationFrame(()=>{const t=this.upgradeSystem.getUpgrades();for(const a of t){const i=this.buttonCache.get(a.id);if(i){const o=a.canBuy(e);i.disabled===o&&(i.disabled=!o,o?i.classList.remove("disabled"):i.classList.add("disabled"))}}const s=this.upgradeSystem.getSubUpgrades();for(const a of s){const i=document.querySelector(`[data-upgrade-id="${a.id}"]`);if(i&&!a.owned){const o=e.points>=a.cost;i.style.opacity=o?"1":"0.7",i.style.cursor=o?"pointer":"not-allowed",i.style.border=o?"2px solid #fff":"1px solid #666",i.style.pointerEvents="auto"}}})}render(){if(this.isRendering)return;this.isRendering=!0,this.container.innerHTML="";const e=this.store.getState();this.upgradeSystem.updateSubUpgradesFromState(e),this.currentTab==="available"?this.renderAvailableTab(e):this.renderOwnedTab(e),this.isRendering=!1}renderAvailableTab(e){const t=this.upgradeSystem.getUpgrades(),s=this.upgradeSystem.getSubUpgrades();this.buttonCache.clear();const a=s.filter(i=>i.isVisible(e)&&!i.owned);if(a.length>0){const i=document.createElement("div");i.className="special-upgrades-box";const o=document.createElement("h3");o.textContent="â­ SPECIAL UPGRADES â­",i.appendChild(o);const n=document.createElement("div");n.className="special-upgrades-grid";for(const l of a){const c=this.createSubUpgradeCard(l,e);n.appendChild(c)}i.appendChild(n),this.container.appendChild(i)}for(const i of t){if(i.id==="misc")continue;const o=document.createElement("div");o.className="upgrade-item";const n=document.createElement("div");n.className="upgrade-header";const l=document.createElement("div");l.className="upgrade-name",l.textContent=i.name;const c=document.createElement("div");c.className="upgrade-level",c.textContent=i.getDisplayText(e),n.appendChild(l),n.appendChild(c);const h=document.createElement("div");h.className="upgrade-description",h.textContent=i.description;const u=document.createElement("div");u.className="upgrade-footer";const g=document.createElement("div");g.className="upgrade-cost";const p=i.getCost(i.getLevel(e));g.textContent=`Cost: ${this.formatNumber(p)}`;const y=new ne("BUY",()=>{this.buyUpgrade(i)});y.setEnabled(i.canBuy(e));const r=y.getElement();this.buttonCache.set(i.id,r),u.appendChild(g),u.appendChild(r),o.appendChild(n),o.appendChild(h),o.appendChild(u),this.container.appendChild(o)}}renderOwnedTab(e){const s=this.upgradeSystem.getSubUpgrades().filter(i=>i.owned);if(s.length===0){const i=document.createElement("div");i.style.padding="40px",i.style.textAlign="center",i.style.color="#666",i.textContent="No special upgrades owned yet.",this.container.appendChild(i);return}const a=document.createElement("div");a.className="special-upgrades-grid",a.style.padding="10px 0";for(const i of s){const o=this.createSubUpgradeCard(i,e);a.appendChild(o)}this.container.appendChild(a)}createSubUpgradeCard(e,t){const s=document.createElement("div");s.className=`sub-upgrade ${e.owned?"owned":""}`,s.setAttribute("data-upgrade-id",e.id);const a=document.createElement("div");a.className="sub-upgrade-icon",a.textContent=this.getUpgradeEmoji(e.id),s.appendChild(a);const i=document.createElement("div");i.className="sub-upgrade-name",i.textContent=e.name,s.appendChild(i);const o=document.createElement("div");o.className="sub-upgrade-cost",o.textContent=e.owned?"âœ“ OWNED":this.formatNumber(e.cost),s.appendChild(o);const n=document.createElement("div");if(n.className="sub-upgrade-tooltip",n.innerHTML=`<strong>${e.name}</strong><br>${e.description}<br><em style="color: #888; font-size: 10px;">${e.flavor}</em>`,s.appendChild(n),!e.owned){const l=t.points>=e.cost;s.style.opacity=l?"1":"0.7",s.style.cursor=l?"pointer":"not-allowed",s.addEventListener("click",()=>{this.store.getState().points>=e.cost&&this.buySubUpgrade(e)})}return s}getUpgradeEmoji(e){return{auto_fire:"ðŸ”¥",death_pact:"ðŸ’€",laser_focusing:"ðŸ’Ž",quantum_targeting:"ðŸŽ¯",energy_recycling:"â™»ï¸",overclocked_reactors:"âš›ï¸",ship_swarm:"ðŸ",neural_link:"ðŸ§ ",antimatter_rounds:"ðŸ’¥",warp_core:"ðŸŒ€",ai_optimizer:"ðŸ¤–",perfect_precision:"âœ¨",void_channeling:"ðŸŒŒ",temporal_acceleration:"â°",singularity_core:"ðŸ•³ï¸",cosmic_ascension:"ðŸŒŸ",coffee_machine:"â˜•",lucky_dice:"ðŸŽ²",space_pizza:"ðŸ•",rubber_duck:"ðŸ¦†",motivational_posters:"ðŸ“‹",disco_ball:"ðŸª©",lucky_horseshoe:"ðŸ€",arcade_machine:"ðŸ•¹ï¸",chaos_emeralds:"ðŸ’š",time_machine:"â±ï¸",philosophers_stone:"ðŸ—¿",golden_goose:"ðŸ¦¢",infinity_gauntlet:"ðŸ’",alien_cookbook:"ðŸ“–",nuclear_reactor:"â˜¢ï¸",cheat_codes:"ðŸŽ®",dragon_egg:"ðŸ¥š",universe_map:"ðŸ—ºï¸",answer_to_everything:"4ï¸âƒ£2ï¸âƒ£",heart_of_galaxy:"â¤ï¸",meaning_of_life:"ðŸ”®",master_clicker:"ðŸ‘†",rapid_fire:"âš¡",click_multiplier:"âœ¨",super_clicker:"ðŸ’ª",missile_launcher:"ðŸš€"}[e]||"â­"}buyUpgrade(e){if(this.isProcessingPurchase)return;this.isProcessingPurchase=!0;const t=this.store.getState();if(!e.canBuy(t)){this.isProcessingPurchase=!1;return}const s=e.getCost(e.getLevel(t));t.points>=s&&(t.points-=s,e.buy(t),this.store.incrementUpgrade(),this.store.setState(t),this.soundManager&&this.soundManager.playPurchase(),this.lastAffordability.clear(),this.render()),this.isProcessingPurchase=!1}buySubUpgrade(e){if(this.isProcessingPurchase||e.owned)return;this.isProcessingPurchase=!0;const t=this.store.getState();t.points>=e.cost&&(t.points-=e.cost,e.buy(t),this.store.incrementSubUpgrade(),this.store.setState(t),this.soundManager&&this.soundManager.playPurchase(),this.lastAffordability.clear(),this.render()),this.isProcessingPurchase=!1}formatNumber(e){return e>=1e9?`${(e/1e9).toFixed(2)}B`:e>=1e6?`${(e/1e6).toFixed(2)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:Math.floor(e).toString()}}class le{constructor(e){this.upgradeSystem=e;const t=document.getElementById("upgrades-display");if(!t)throw new Error("Upgrades display element not found");this.container=t}container;update(e){this.container.innerHTML="",this.upgradeSystem.updateSubUpgradesFromState(e);const s=this.upgradeSystem.getSubUpgrades().filter(a=>a.owned);if(s.length!==0)for(const a of s){const i=document.createElement("div");i.className="upgrade-icon";const o=this.getUpgradeEmoji(a.id);i.textContent=o;const n=document.createElement("div");n.className="tooltip",n.textContent=a.name,i.appendChild(n),this.container.appendChild(i)}}getUpgradeEmoji(e){return{auto_fire:"ðŸ”¥",death_pact:"ðŸ’€",laser_focusing:"ðŸ’Ž",quantum_targeting:"ðŸŽ¯",energy_recycling:"â™»ï¸",overclocked_reactors:"âš›ï¸",ship_swarm:"ðŸ",neural_link:"ðŸ§ ",antimatter_rounds:"ðŸ’¥",warp_core:"ðŸŒ€",ai_optimizer:"ðŸ¤–",perfect_precision:"âœ¨",void_channeling:"ðŸŒŒ",temporal_acceleration:"â°",singularity_core:"ðŸ•³ï¸",cosmic_ascension:"ðŸŒŸ"}[e]||"â­"}}class ce{queue=[];currentSnackbar=null;isShowing=!1;show(e){this.queue.push(e),this.isShowing||this.showNext()}showNext(){if(this.queue.length===0){this.isShowing=!1;return}this.isShowing=!0;const e=this.queue.shift(),t=document.createElement("div");t.className="achievement-snackbar",t.innerHTML=`
      <div class="achievement-icon">${e.icon}</div>
      <div class="achievement-content">
        <div class="achievement-title">Achievement Unlocked!</div>
        <div class="achievement-name">${e.name}</div>
        <div class="achievement-desc">${e.description}</div>
      </div>
    `,document.body.appendChild(t),this.currentSnackbar=t,setTimeout(()=>{t.classList.add("show")},10),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>{t.parentElement&&t.parentElement.removeChild(t),this.currentSnackbar=null,this.showNext()},300)},4e3)}clear(){this.queue=[],this.currentSnackbar&&(this.currentSnackbar.parentElement&&this.currentSnackbar.parentElement.removeChild(this.currentSnackbar),this.currentSnackbar=null),this.isShowing=!1}}class he{modal;achievementSystem;constructor(e){this.achievementSystem=e,this.modal=this.createModal(),this.setupEventListeners()}createModal(){const e=document.createElement("div");return e.id="achievements-modal",e.className="modal",e.style.display="none",e.innerHTML=`
      <div class="modal-content achievements-content">
        <div class="modal-header">
          <h2>ðŸ† Achievements</h2>
          <button class="modal-close" id="achievements-close">&times;</button>
        </div>
        <div class="achievements-progress">
          <div class="progress-text">
            <span id="achievements-count">0/0</span>
            <span id="achievements-percent">0%</span>
          </div>
          <div class="progress-bar-container">
            <div class="progress-bar" id="achievements-progress-bar"></div>
          </div>
        </div>
        <div class="achievements-filters">
          <button class="filter-btn active" data-filter="all">All</button>
          <button class="filter-btn" data-filter="combat">âš”ï¸ Combat</button>
          <button class="filter-btn" data-filter="progression">ðŸ“ˆ Progression</button>
          <button class="filter-btn" data-filter="collection">ðŸ“¦ Collection</button>
          <button class="filter-btn" data-filter="mastery">ðŸ‘‘ Mastery</button>
          <button class="filter-btn" data-filter="secret">ðŸ”’ Secret</button>
        </div>
        <div class="achievements-grid" id="achievements-grid"></div>
      </div>
    `,document.body.appendChild(e),e}setupEventListeners(){const e=this.modal.querySelector("#achievements-close");e&&e.addEventListener("click",()=>{this.hide()}),this.modal.addEventListener("click",s=>{s.target===this.modal&&this.hide()});const t=this.modal.querySelectorAll(".filter-btn");t.forEach(s=>{s.addEventListener("click",a=>{const i=a.target,o=i.dataset.filter;t.forEach(n=>{n.classList.remove("active")}),i.classList.add("active"),this.applyFilter(o||"all")})})}applyFilter(e){const t=this.modal.querySelector("#achievements-grid");if(!t)return;t.querySelectorAll(".achievement-item").forEach(a=>{const i=a;e==="all"||i.dataset.category===e?i.style.display="":i.style.display="none"})}show(){this.update(),this.modal.style.display="flex"}hide(){this.modal.style.display="none"}update(){const e=this.achievementSystem.getAchievements(),t=this.modal.querySelector("#achievements-grid");if(!t)return;const s=this.achievementSystem.getUnlockedCount(),a=this.achievementSystem.getTotalCount(),i=this.achievementSystem.getProgress(),o=this.modal.querySelector("#achievements-count"),n=this.modal.querySelector("#achievements-percent"),l=this.modal.querySelector("#achievements-progress-bar");o&&(o.textContent=`${s}/${a}`),n&&(n.textContent=`${Math.floor(i)}%`),l&&(l.style.width=`${i}%`),t.innerHTML=e.map(c=>{const h=!c.unlocked,u=h&&c.hidden;return`
        <div class="achievement-item ${h?"locked":"unlocked"}" data-category="${c.category}">
          <div class="achievement-icon-large ${h?"grayscale":""}">${c.icon}</div>
          <div class="achievement-details">
            <div class="achievement-item-name">${u?"???":c.name}</div>
            <div class="achievement-item-desc">${u?"Hidden achievement":c.description}</div>
            <div class="achievement-category-badge ${c.category}">${this.getCategoryLabel(c.category)}</div>
          </div>
          ${h?'<div class="achievement-lock">ðŸ”’</div>':'<div class="achievement-checkmark">âœ“</div>'}
        </div>
      `}).join("")}getCategoryLabel(e){return{combat:"âš”ï¸ Combat",progression:"ðŸ“ˆ Progression",collection:"ðŸ“¦ Collection",mastery:"ðŸ‘‘ Mastery",secret:"ðŸ”’ Secret"}[e]||e}}class de{constructor(e,t,s){this.ascensionSystem=e,this.store=t,this.onAscend=s,this.modal=this.createModal(),document.body.appendChild(this.modal),this.setupEventListeners()}modal;onAscend;createModal(){const e=document.createElement("div");return e.className="modal ascension-modal",e.style.display="none",e.innerHTML=`
      <div class="modal-content ascension-content">
        <div class="modal-header">
          <h2>ðŸŒŸ ASCENSION ðŸŒŸ</h2>
          <button class="modal-close" id="ascension-close">&times;</button>
        </div>
        <div class="ascension-info">
          <div class="ascension-description">
            <p>Ascend to a higher plane of existence. You will lose all progress except:</p>
            <ul>
              <li>âœ“ Special Upgrades (Owned)</li>
              <li>âœ“ Achievements</li>
              <li>âœ“ Statistics</li>
              <li>âœ“ Prestige Upgrades</li>
            </ul>
            <p style="margin-top: 15px;"><strong>You will gain Prestige Points to unlock permanent bonuses!</strong></p>
          </div>
          <div class="ascension-rewards">
            <div class="prestige-points-display">
              <div class="prestige-current">Current: <span id="prestige-current">0</span> PP</div>
              <div class="prestige-gain">Gain on Ascension: <span id="prestige-gain">0</span> PP</div>
            </div>
          </div>
        </div>
        <div class="ascension-upgrades">
          <h3>Prestige Upgrades</h3>
          <div id="prestige-upgrades-grid" class="prestige-grid"></div>
        </div>
        <div class="ascension-actions">
          <button id="ascend-btn" class="ascension-btn ascend-confirm">ASCEND NOW</button>
        </div>
      </div>
    `,e}setupEventListeners(){this.modal.querySelector("#ascension-close")?.addEventListener("click",()=>this.hide()),this.modal.addEventListener("click",s=>{s.target===this.modal&&this.hide()}),this.modal.querySelector("#ascend-btn")?.addEventListener("click",()=>{confirm("Are you sure you want to ascend? All non-permanent progress will be reset!")&&(this.onAscend(),this.hide())}),this.store.subscribe(()=>{this.modal.style.display!=="none"&&this.updatePrestigeUpgrades()})}show(){const e=this.store.getState(),t=document.getElementById("prestige-current"),s=document.getElementById("prestige-gain");if(t&&(t.textContent=e.prestigePoints.toString()),s){const o=this.ascensionSystem.calculatePrestigePoints(e);s.textContent=o.toString()}this.updatePrestigeUpgrades();const a=this.ascensionSystem.canAscend(e),i=this.modal.querySelector("#ascend-btn");i&&(a?(i.disabled=!1,i.textContent="ASCEND NOW"):(i.disabled=!0,i.textContent=`REACH LEVEL 100 TO ASCEND (Current: ${e.level})`)),this.modal.style.display="flex"}hide(){this.modal.style.display="none"}updatePrestigeUpgrades(){const e=this.store.getState(),t=document.getElementById("prestige-current");t&&(t.textContent=e.prestigePoints.toString());const s=this.modal.querySelector("#prestige-upgrades-grid");if(!s)return;s.innerHTML="";const a=this.ascensionSystem.getUpgrades();for(const i of a){const o=i.getCurrentLevel(e),n=e.prestigePoints>=i.cost,l=o>=i.maxLevel,c=document.createElement("div");c.className=`prestige-upgrade-card ${l?"maxed":""} ${!n&&!l?"locked":""}`,c.innerHTML=`
        <div class="prestige-upgrade-name">${i.name}</div>
        <div class="prestige-upgrade-level">Level: ${o} / ${i.maxLevel}</div>
        <div class="prestige-upgrade-desc">${i.description}</div>
        <div class="prestige-upgrade-effect">${i.effect}</div>
        <div class="prestige-upgrade-cost">
          ${l?"MAX":`Cost: ${i.cost} PP`}
        </div>
      `,l||c.addEventListener("click",()=>{this.ascensionSystem.buyPrestigeUpgrade(e,i.id)&&(this.store.setState(e),this.updatePrestigeUpgrades())}),s.appendChild(c)}}}class pe{modalElement=null;isOpen=!1;constructor(){this.createModal(),this.setupButton()}setupButton(){const e=document.getElementById("stats-btn");e&&e.addEventListener("click",()=>{this.toggle()})}createModal(){this.modalElement=document.createElement("div"),this.modalElement.className="modal stats-modal",this.modalElement.style.display="none",this.modalElement.addEventListener("click",o=>{o.target===this.modalElement&&this.hide()});const e=document.createElement("div");e.className="modal-content stats-content";const t=document.createElement("div");t.className="modal-header";const s=document.createElement("h2");s.textContent="ðŸ“Š Statistics";const a=document.createElement("button");a.className="modal-close",a.textContent="Ã—",a.addEventListener("click",()=>{this.hide()}),t.appendChild(s),t.appendChild(a);const i=document.createElement("div");i.id="stats-container",i.className="stats-container",e.appendChild(t),e.appendChild(i),this.modalElement.appendChild(e),document.body.appendChild(this.modalElement)}toggle(){this.isOpen?this.hide():this.show()}show(){this.modalElement&&(this.modalElement.style.display="flex",this.isOpen=!0,this.render())}hide(){this.modalElement&&(this.modalElement.style.display="none",this.isOpen=!1)}update(e){this.isOpen&&this.render()}render(){const e=document.getElementById("stats-container");if(!e)return;const t=localStorage.getItem("alien-clicker-save");if(!t)return;const s=JSON.parse(t);e.innerHTML="";const a=[{title:"âš”ï¸ Combat Stats",stats:[{label:"Total Clicks",value:this.formatNumber(s.stats.totalClicks)},{label:"Total Damage",value:this.formatNumber(s.stats.totalDamage)},{label:"Aliens Killed",value:this.formatNumber(s.stats.aliensKilled)},{label:"Bosses Defeated",value:this.formatNumber(s.stats.bossesKilled)},{label:"Critical Hits",value:this.formatNumber(s.stats.criticalHits)}]},{title:"ðŸ“ˆ Progression Stats",stats:[{label:"Current Level",value:s.level.toString()},{label:"Max Level Reached",value:s.stats.maxLevel.toString()},{label:"Total Experience",value:this.formatNumber(Math.floor(s.experience))},{label:"Play Time",value:this.formatTime(s.stats.playTime)}]},{title:"ðŸ›¸ Fleet Stats",stats:[{label:"Ships",value:s.shipsCount.toString()},{label:"Attack Speed Level",value:s.attackSpeedLevel.toString()},{label:"Damage Level",value:s.pointMultiplierLevel.toString()},{label:"Crit Level",value:s.critChanceLevel.toString()},{label:"Passive Gen Level",value:s.resourceGenLevel.toString()},{label:"XP Boost Level",value:s.xpBoostLevel.toString()}]},{title:"ðŸ”¬ Technology Stats",stats:[{label:"Total Upgrades",value:this.formatNumber(s.stats.totalUpgrades)},{label:"Special Technologies",value:`${s.stats.totalSubUpgrades} / 33`},{label:"Technology Progress",value:`${Math.floor(s.stats.totalSubUpgrades/33*100)}%`}]},{title:"ðŸ’° Wealth Stats",stats:[{label:"Current Points",value:this.formatNumber(s.points)},{label:"Total Points Earned",value:this.formatNumber(s.stats.totalDamage)}]}];for(const i of a){const o=document.createElement("div");o.className="stats-category";const n=document.createElement("h3");n.className="stats-category-title",n.textContent=i.title,o.appendChild(n);const l=document.createElement("div");l.className="stats-grid";for(const c of i.stats){const h=document.createElement("div");h.className="stat-item";const u=document.createElement("div");u.className="stat-label",u.textContent=c.label;const g=document.createElement("div");g.className="stat-value",g.textContent=c.value,h.appendChild(u),h.appendChild(g),l.appendChild(h)}o.appendChild(l),e.appendChild(o)}}formatNumber(e){return e>=1e9?`${(e/1e9).toFixed(2)}B`:e>=1e6?`${(e/1e6).toFixed(2)}M`:e>=1e3?`${(e/1e3).toFixed(2)}K`:Math.floor(e).toString()}formatTime(e){const t=Math.floor(e/3600),s=Math.floor(e%3600/60),a=Math.floor(e%60);return t>0?`${t}h ${s}m ${a}s`:s>0?`${s}m ${a}s`:`${a}s`}}class ue{modal=null;soundManager;volumeSlider=null;volumeValue=null;graphicsCallback=null;shipLasersCallback=null;ripplesCallback=null;damageNumbersCallback=null;soundCallback=null;volumeCallback=null;graphicsToggle=null;shipLasersToggle=null;ripplesToggle=null;damageNumbersToggle=null;constructor(e){this.soundManager=e,this.createModal()}setGraphicsCallback(e){this.graphicsCallback=e}setShipLasersCallback(e){this.shipLasersCallback=e}setRipplesCallback(e){this.ripplesCallback=e}setDamageNumbersCallback(e){this.damageNumbersCallback=e}setSoundCallback(e){this.soundCallback=e}setVolumeCallback(e){this.volumeCallback=e}updateGraphicsToggles(e,t,s,a){this.graphicsToggle&&(this.graphicsToggle.textContent=e?"ON":"OFF",this.graphicsToggle.style.backgroundColor=e?"#4CAF50":"#666"),this.shipLasersToggle&&(this.shipLasersToggle.textContent=t?"ON":"OFF",this.shipLasersToggle.style.backgroundColor=t?"#4CAF50":"#666"),this.ripplesToggle&&(this.ripplesToggle.textContent=s?"ON":"OFF",this.ripplesToggle.style.backgroundColor=s?"#4CAF50":"#666"),this.damageNumbersToggle&&(this.damageNumbersToggle.textContent=a?"ON":"OFF",this.damageNumbersToggle.style.backgroundColor=a?"#4CAF50":"#666")}createModal(){this.modal=document.createElement("div"),this.modal.id="settings-modal",this.modal.className="modal",this.modal.style.display="none";const e=document.createElement("div");e.className="modal-content",e.style.maxWidth="600px",e.style.maxHeight="85vh",e.style.overflowY="auto";const t=document.createElement("h2");t.textContent="âš™ï¸ Settings",t.style.marginBottom="20px",t.style.textAlign="center",e.appendChild(t);const s=document.createElement("div");s.style.marginBottom="25px";const a=document.createElement("h3");a.textContent="Sound Settings",a.style.marginBottom="15px",s.appendChild(a);const i=document.createElement("div");i.style.marginBottom="15px",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="space-between";const o=document.createElement("label");o.textContent="Sound Enabled:",o.style.fontSize="16px";const n=document.createElement("button");n.className="modal-button",n.textContent=this.soundManager.isEnabled()?"ON":"OFF",n.style.width="80px",n.addEventListener("click",()=>{const m=!this.soundManager.isEnabled();this.soundManager.setEnabled(m),n.textContent=m?"ON":"OFF",n.style.backgroundColor=m?"#4CAF50":"#666",this.soundCallback&&this.soundCallback(m)}),n.style.backgroundColor=this.soundManager.isEnabled()?"#4CAF50":"#666",i.appendChild(o),i.appendChild(n),s.appendChild(i);const l=document.createElement("div");l.textContent="Enable or disable all game sounds",l.style.fontSize="12px",l.style.color="#888",l.style.marginTop="5px",l.style.marginBottom="15px",s.appendChild(l);const c=document.createElement("div");c.style.marginBottom="15px";const h=document.createElement("label");h.textContent="Volume:",h.style.display="block",h.style.marginBottom="8px",h.style.fontSize="16px",c.appendChild(h);const u=document.createElement("div");u.style.display="flex",u.style.alignItems="center",u.style.gap="10px",this.volumeSlider=document.createElement("input"),this.volumeSlider.type="range",this.volumeSlider.min="0",this.volumeSlider.max="100",this.volumeSlider.value=String(Math.round(this.soundManager.getVolume()*100)),this.volumeSlider.style.flex="1",this.volumeSlider.style.cursor="pointer",this.volumeValue=document.createElement("span"),this.volumeValue.textContent=`${this.volumeSlider.value}%`,this.volumeValue.style.minWidth="45px",this.volumeValue.style.textAlign="right",this.volumeValue.style.fontSize="14px";const g=this;this.volumeSlider.addEventListener("input",function(){const m=parseInt(this.value)/100;g.soundManager.setVolume(m),g.volumeValue&&(g.volumeValue.textContent=String(this.value)+"%"),g.volumeCallback&&g.volumeCallback(m),g.soundManager.playClick()}),u.appendChild(this.volumeSlider),u.appendChild(this.volumeValue),c.appendChild(u),s.appendChild(c),e.appendChild(s);const p=document.createElement("div");p.style.marginBottom="25px";const y=document.createElement("h3");y.textContent="Graphics Settings",y.style.marginBottom="15px",p.appendChild(y);const r=document.createElement("div");r.style.marginBottom="10px",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="space-between";const f=document.createElement("label");f.textContent="High Graphics (Particles):",f.style.fontSize="16px",this.graphicsToggle=document.createElement("button"),this.graphicsToggle.className="modal-button",this.graphicsToggle.textContent="ON",this.graphicsToggle.style.width="80px",this.graphicsToggle.style.backgroundColor="#4CAF50",this.graphicsToggle.addEventListener("click",()=>{if(!this.graphicsToggle)return;const m=this.graphicsToggle.textContent==="OFF";this.graphicsToggle.textContent=m?"ON":"OFF",this.graphicsToggle.style.backgroundColor=m?"#4CAF50":"#666",this.graphicsCallback&&this.graphicsCallback(m)}),r.appendChild(f),r.appendChild(this.graphicsToggle),p.appendChild(r);const b=document.createElement("div");b.textContent="Disable particles for better performance",b.style.fontSize="12px",b.style.color="#888",b.style.marginTop="5px",p.appendChild(b);const S=document.createElement("div");S.style.marginBottom="10px",S.style.display="flex",S.style.alignItems="center",S.style.justifyContent="space-between";const A=document.createElement("label");A.textContent="Ship Auto-Fire Lasers:",A.style.fontSize="16px",this.shipLasersToggle=document.createElement("button"),this.shipLasersToggle.className="modal-button",this.shipLasersToggle.textContent="ON",this.shipLasersToggle.style.width="80px",this.shipLasersToggle.style.backgroundColor="#4CAF50",this.shipLasersToggle.addEventListener("click",()=>{if(!this.shipLasersToggle)return;const m=this.shipLasersToggle.textContent==="OFF";this.shipLasersToggle.textContent=m?"ON":"OFF",this.shipLasersToggle.style.backgroundColor=m?"#4CAF50":"#666",this.shipLasersCallback&&this.shipLasersCallback(m)}),S.appendChild(A),S.appendChild(this.shipLasersToggle),p.appendChild(S);const L=document.createElement("div");L.textContent="Disable to reduce lag (only your clicks will fire lasers)",L.style.fontSize="12px",L.style.color="#888",L.style.marginTop="5px",p.appendChild(L);const C=document.createElement("div");C.style.marginBottom="10px",C.style.marginTop="15px",C.style.display="flex",C.style.alignItems="center",C.style.justifyContent="space-between";const E=document.createElement("label");E.textContent="Click Ripples:",E.style.fontSize="16px",this.ripplesToggle=document.createElement("button"),this.ripplesToggle.className="modal-button",this.ripplesToggle.textContent="ON",this.ripplesToggle.style.width="80px",this.ripplesToggle.style.backgroundColor="#4CAF50",this.ripplesToggle.addEventListener("click",()=>{if(!this.ripplesToggle)return;const m=this.ripplesToggle.textContent==="OFF";this.ripplesToggle.textContent=m?"ON":"OFF",this.ripplesToggle.style.backgroundColor=m?"#4CAF50":"#666",this.ripplesCallback&&this.ripplesCallback(m)}),C.appendChild(E),C.appendChild(this.ripplesToggle),p.appendChild(C);const w=document.createElement("div");w.textContent="Disable for minimal visual clutter",w.style.fontSize="12px",w.style.color="#888",w.style.marginTop="5px",p.appendChild(w);const _=document.createElement("div");_.style.marginBottom="10px",_.style.marginTop="15px",_.style.display="flex",_.style.alignItems="center",_.style.justifyContent="space-between";const B=document.createElement("label");B.textContent="Damage Numbers:",B.style.fontSize="16px",this.damageNumbersToggle=document.createElement("button"),this.damageNumbersToggle.className="modal-button",this.damageNumbersToggle.textContent="ON",this.damageNumbersToggle.style.width="80px",this.damageNumbersToggle.style.backgroundColor="#4CAF50",this.damageNumbersToggle.addEventListener("click",()=>{if(!this.damageNumbersToggle)return;const m=this.damageNumbersToggle.textContent==="OFF";this.damageNumbersToggle.textContent=m?"ON":"OFF",this.damageNumbersToggle.style.backgroundColor=m?"#4CAF50":"#666",this.damageNumbersCallback&&this.damageNumbersCallback(m)}),_.appendChild(B),_.appendChild(this.damageNumbersToggle),p.appendChild(_);const M=document.createElement("div");M.textContent="Disable to improve performance (damage still applies)",M.style.fontSize="12px",M.style.color="#888",M.style.marginTop="5px",p.appendChild(M),e.appendChild(p);const T=document.createElement("button");T.className="modal-button",T.textContent="Close",T.style.width="100%",T.style.marginTop="20px",T.addEventListener("click",()=>{this.hide()}),e.appendChild(T),this.modal.appendChild(e),document.body.appendChild(this.modal),this.modal.addEventListener("click",m=>{m.target===this.modal&&this.hide()})}show(){if(this.modal){if(this.volumeSlider&&this.volumeValue){const e=Math.round(this.soundManager.getVolume()*100);this.volumeSlider.value=String(e),this.volumeValue.textContent=String(e)+"%"}this.modal.style.display="flex"}}hide(){this.modal&&(this.modal.style.display="none")}}class me{static setupResetButton(e){const t=document.getElementById("reset-btn");t&&t.addEventListener("click",()=>{confirm("Are you sure you want to reset all progress? This cannot be undone.")&&e()})}}class U{static colors=[{fill:"#fff",stroke:"#ccc",hp:10},{fill:"#ddd",stroke:"#aaa",hp:20},{fill:"#bbb",stroke:"#888",hp:35},{fill:"#999",stroke:"#666",hp:55},{fill:"#ff4444",stroke:"#cc0000",hp:120},{fill:"#ff8800",stroke:"#cc6600",hp:180},{fill:"#ffdd00",stroke:"#ccaa00",hp:260},{fill:"#88ff00",stroke:"#66cc00",hp:360},{fill:"#00ff88",stroke:"#00cc66",hp:480},{fill:"#0088ff",stroke:"#0066cc",hp:620},{fill:"#8800ff",stroke:"#6600cc",hp:780},{fill:"#ff0088",stroke:"#cc0066",hp:960},{fill:"#ff6600",stroke:"#cc4400",hp:1160},{fill:"#ffaa00",stroke:"#cc8800",hp:1380},{fill:"#00ffff",stroke:"#00cccc",hp:1620},{fill:"#ff00ff",stroke:"#cc00cc",hp:1880},{fill:"#66ff66",stroke:"#44cc44",hp:2160},{fill:"#ff6666",stroke:"#cc4444",hp:2460},{fill:"#6666ff",stroke:"#4444cc",hp:2780},{fill:"#ffff00",stroke:"#cccc00",hp:3120}];static getColorForLevel(e){const t=Math.min(e-1,this.colors.length-1);return this.colors[t]??this.colors[this.colors.length-1]}static getExpRequired(e){const t=10*Math.pow(1.12,e),s=Math.max(1,Math.log10(e+1));return Math.floor(t/s)}static isBossLevel(e){return e===50||e===100}static getBossHp(e){return Math.floor(5e3*Math.pow(1.5,e/5-1))}}const F="alien-clicker-settings";class x{static save(e){try{localStorage.setItem(F,JSON.stringify(e))}catch(t){console.error("Failed to save settings:",t)}}static load(){try{const e=localStorage.getItem(F);if(e){const t=JSON.parse(e);return{soundEnabled:t.soundEnabled??!0,volume:t.volume??.3,highGraphics:t.highGraphics??!0,showShipLasers:t.showShipLasers??!0,showRipples:t.showRipples??!0,showDamageNumbers:t.showDamageNumbers??!0}}}catch(e){console.error("Failed to load settings:",e)}return x.getDefault()}static getDefault(){return{soundEnabled:!0,volume:.3,highGraphics:!0,showShipLasers:!0,showRipples:!0,showDamageNumbers:!0}}}class ge{canvas;draw;loop;input;store;ball=null;bossBall=null;ships=[];playerShip=null;bossProjectiles=[];laserSystem;rippleSystem;particleSystem;damageNumberSystem;comboSystem;soundManager;upgradeSystem;autoFireSystem;achievementSystem;ascensionSystem;achievementSnackbar;achievementsModal;ascensionModal;statsPanel;settingsModal;hud;upgradesDisplay;saveTimer=0;saveInterval=3;playTimeAccumulator=0;passiveGenAccumulator=0;shakeTime=0;shakeAmount=0;mode="normal";transitionTime=0;transitionDuration=2;keys=new Set;shootCooldown=0;shootCooldownMax=.2;userSettings=x.getDefault();bossClickProgress=0;bossProgressDecayRate=5;bossClickIncrement=2;damageBatch=0;critBatch=!1;batchTimer=0;batchInterval=.05;constructor(){const e=document.getElementById("game-canvas");if(!e)throw new Error("Canvas not found");this.canvas=new q(e),this.draw=new V(this.canvas.getContext()),this.store=new z(k.load()),this.userSettings=x.load(),window.addEventListener("resize",()=>{this.handleResize()}),this.upgradeSystem=new j,this.laserSystem=new K,this.rippleSystem=new Y,this.particleSystem=new te,this.damageNumberSystem=new se,this.comboSystem=new ie,this.soundManager=new ae,this.soundManager.setEnabled(this.userSettings.soundEnabled),this.soundManager.setVolume(this.userSettings.volume),this.autoFireSystem=new J,this.achievementSystem=new Q,this.ascensionSystem=new Z,this.upgradeSystem.setAscensionSystem(this.ascensionSystem),this.achievementSnackbar=new ce,this.achievementsModal=new he(this.achievementSystem),this.ascensionModal=new de(this.ascensionSystem,this.store,()=>{this.performAscension()}),this.statsPanel=new pe,this.settingsModal=new ue(this.soundManager),this.settingsModal.setGraphicsCallback(a=>{this.userSettings.highGraphics=a,a||this.particleSystem.clear(),x.save(this.userSettings)}),this.settingsModal.setShipLasersCallback(a=>{this.userSettings.showShipLasers=a,this.laserSystem.setShowShipLasers(a),x.save(this.userSettings)}),this.settingsModal.setRipplesCallback(a=>{this.userSettings.showRipples=a,a||this.rippleSystem.clear(),x.save(this.userSettings)}),this.settingsModal.setDamageNumbersCallback(a=>{this.userSettings.showDamageNumbers=a,this.damageNumberSystem.setEnabled(a),a||this.damageNumberSystem.clear(),x.save(this.userSettings)}),this.settingsModal.setSoundCallback(a=>{this.userSettings.soundEnabled=a,x.save(this.userSettings)}),this.settingsModal.setVolumeCallback(a=>{this.userSettings.volume=a,x.save(this.userSettings)}),this.laserSystem.setShowShipLasers(this.userSettings.showShipLasers),this.damageNumberSystem.setEnabled(this.userSettings.showDamageNumbers),this.settingsModal.updateGraphicsToggles(this.userSettings.highGraphics,this.userSettings.showShipLasers,this.userSettings.showRipples,this.userSettings.showDamageNumbers);const t=document.getElementById("stats-btn");t&&t.addEventListener("click",()=>{this.statsPanel.show()}),this.hud=new oe,this.upgradesDisplay=new le(this.upgradeSystem),new re(this.store,this.upgradeSystem).setSoundManager(this.soundManager),this.achievementSystem.setOnUnlock(a=>{this.achievementSnackbar.show(a),this.soundManager.playAchievement()}),this.achievementSystem.updateFromState(this.store.getState()),this.input=new O(e),this.loop=new $(a=>{this.update(a)},()=>{this.render()}),this.initGame(),this.setupInput(),this.setupKeyboard(),this.setupAutoSave(),this.setupBossDialog(),this.setupAchievementsButton(),this.setupAscensionButton(),this.setupSettingsButton(),this.setupGraphicsToggle(),me.setupResetButton(()=>{this.resetGame()})}setupGraphicsToggle(){}setupBossDialog(){const e=document.getElementById("boss-start-btn");e&&e.addEventListener("click",()=>{const t=document.getElementById("boss-dialog");t&&(t.style.display="none"),this.startBossFight()})}setupAchievementsButton(){const e=document.getElementById("achievements-btn");e&&e.addEventListener("click",()=>{this.achievementsModal.show()})}setupAscensionButton(){const e=document.getElementById("hud");if(e){const t=document.createElement("button");t.id="ascension-btn",t.className="hud-button ascension-hud-btn",t.textContent="ðŸŒŸ Ascend",t.addEventListener("click",()=>{this.ascensionModal.show()});const s=()=>{const a=this.store.getState(),i=this.ascensionSystem.canAscend(a);t.style.display=i||a.prestigeLevel>0?"block":"none"};this.store.subscribe(s),s(),e.appendChild(t)}}setupSettingsButton(){const e=document.getElementById("hud");if(e){const t=document.createElement("button");t.id="settings-btn",t.className="hud-button",t.textContent="âš™ï¸ Settings",t.addEventListener("click",()=>{this.settingsModal.show()}),e.appendChild(t)}}performAscension(){const e=this.store.getState(),t=this.ascensionSystem.calculatePrestigePoints(e),s={...e.subUpgrades},a={...e.achievements},i={...e.stats},o={...e.prestigeUpgrades},n=e.prestigePoints+t,l=e.prestigeLevel+1;i.totalPrestige=l;const h={points:0,shipsCount:1,attackSpeedLevel:0,autoFireUnlocked:!1,pointMultiplierLevel:0,critChanceLevel:0,resourceGenLevel:0,xpBoostLevel:0,level:this.ascensionSystem.getStartingLevel(e),experience:0,subUpgrades:s,achievements:a,stats:i,prestigeLevel:l,prestigePoints:n,prestigeUpgrades:o,harmonicState:{streak:0,harmonicCores:0,tuningForkLevel:0,metronomePurchased:!1,chorusLevel:0,quantizedRipplesLevel:0,sigils:{tempo:0,echo:0,focus:0},echoAccumulator:0}};this.store.setState(h),k.save(this.store.getState()),this.mode="normal",this.createBall(),this.createShips(),this.laserSystem.clear(),this.rippleSystem.clear(),this.particleSystem.clear(),this.damageNumberSystem.clear(),this.comboSystem.reset(),this.autoFireSystem.reset(),this.saveTimer=0}setupKeyboard(){window.addEventListener("keydown",e=>{this.keys.add(e.key.toLowerCase()),e.key===" "&&this.mode==="boss"&&e.preventDefault()}),window.addEventListener("keyup",e=>{this.keys.delete(e.key.toLowerCase())})}initGame(){this.createBall(),this.createShips();const e=this.store.getState();this.hud.update(e.points),this.hud.updateLevel(e.level,e.experience,U.getExpRequired(e.level)),this.upgradesDisplay.update(e)}createBall(){const e=this.canvas.getCenterX(),t=this.canvas.getCenterY(),s=Math.min(this.canvas.getWidth(),this.canvas.getHeight())*.08,a=this.store.getState();this.ball=P.createRandom(e,t,s,a.level),this.bossBall=null}createBoss(){const e=this.canvas.getCenterX(),t=this.canvas.getCenterY(),s=Math.min(this.canvas.getWidth(),this.canvas.getHeight())*.12,a=this.store.getState(),i=U.getBossHp(a.level);this.bossBall=new I(e,t,s,i),this.ball=null,this.playerShip=new H(e,this.canvas.getHeight()-100)}createShips(){const e=this.store.getState(),t=this.canvas.getCenterX(),s=this.canvas.getCenterY(),a=Math.min(this.canvas.getWidth(),this.canvas.getHeight())*.4;this.ships=[];for(let i=0;i<e.shipsCount;i++){const o=Math.random()*Math.PI*2,n=i===0,l=a*(.7+Math.random()*.6);this.ships.push(new G(o,t,s,l,n))}this.autoFireSystem.setShipCount(e.shipsCount)}setupInput(){this.input.onClick(e=>{this.handleClick(e)}),this.store.subscribe(()=>{const e=this.store.getState();this.ships.length!==e.shipsCount&&this.createShips(),this.hud.update(e.points),this.hud.updateLevel(e.level,e.experience,U.getExpRequired(e.level)),this.upgradesDisplay.update(e)})}setupAutoSave(){window.addEventListener("beforeunload",()=>{const e=this.store.getState();k.save(e)})}handleClick(e){this.mode!=="transition"&&(this.mode==="normal"&&this.ball?.isPointInside(e)&&this.ball.currentHp>0?(this.store.incrementClick(),this.soundManager.playClick(),this.fireVolley()):this.mode==="boss"&&this.bossBall?.isPointInside(e)&&(this.store.incrementClick(),this.soundManager.playClick(),this.bossClickProgress=Math.min(100,this.bossClickProgress+this.bossClickIncrement),this.updateBossProgressBar(),this.bossClickProgress>=100&&this.onBossDefeated()))}fireVolley(){const e=this.store.getState(),t=this.upgradeSystem.getPointsPerHit(e),s={x:this.ball?.x??0,y:this.ball?.y??0},a=this.getLaserVisuals(e);if(this.ships[0]&&(this.laserSystem.spawnLaser(this.ships[0].getFrontPosition(),s,t,a),e.subUpgrades.rapid_fire)){const o=this.ships.slice(1);for(let n=0;n<Math.min(2,o.length);n++){const l=o[Math.floor(Math.random()*o.length)];l&&this.laserSystem.spawnLaser(l.getFrontPosition(),s,t,a)}}const i=this.ball?this.ball.radius*2:100;this.rippleSystem.spawnRipple(s,i)}shootLaser(){if(!this.playerShip||this.shootCooldown>0)return;const e=this.store.getState(),t=this.upgradeSystem.getPointsPerHit(e),s=this.playerShip.getFrontPosition(),a=this.playerShip.getAngle(),i=this.getLaserVisuals(e),o=2e3,n={x:s.x+Math.cos(a)*o,y:s.y+Math.sin(a)*o};this.laserSystem.spawnLaser(s,n,t,i),this.shootCooldown=this.shootCooldownMax}fireSingleShip(e){const t=this.ships[e];if(!t)return;const s=this.store.getState(),a=this.upgradeSystem.getPointsPerHit(s),i={x:this.ball?.x??0,y:this.ball?.y??0},o=this.getLaserVisuals(s);this.laserSystem.spawnLaser(t.getFrontPosition(),i,a,{...o,isFromShip:!0})}debugLaserStats(){const e=this.laserSystem.getLaserStats();e.total>200&&console.log(`Lasers: ${e.total.toString()} total (${e.playerLasers.toString()} player, ${e.shipLasers.toString()} ship)`)}getLaserVisuals(e){let t="#fff",s=1.5,a=!1;const i=this.upgradeSystem.getCritChance(e);return Math.random()*100<i?(a=!0,t="#ffff00",s=2,this.store.getState().stats.criticalHits++,{isCrit:a,color:t,width:s}):e.subUpgrades.perfect_precision&&Math.random()<.05?(a=!0,t="#ff00ff",s=2,this.store.getState().stats.criticalHits++,{isCrit:a,color:t,width:s}):(e.subUpgrades.cosmic_ascension?(t="#ff00ff",s=2):e.subUpgrades.singularity_core?(t="#8800ff",s=2):e.subUpgrades.heart_of_galaxy?(t="#ff0044",s=2):e.subUpgrades.antimatter_rounds?(t="#ff0088",s=1.5):e.subUpgrades.chaos_emeralds?(t="#00ff88",s=1.5):e.subUpgrades.overclocked_reactors?(t="#ff6600",s=1.5):e.subUpgrades.laser_focusing?(t="#00ffff",s=1.5):e.pointMultiplierLevel>=10&&(t="#88ff88",s=1.5),{isCrit:a,color:t,width:s})}handleDamage(e,t=!1){let s=e;if(t){const a=this.store.getState(),i=this.upgradeSystem.getCritMultiplier(a);s=e*i}if(this.mode==="boss"){const a=this.comboSystem.getMultiplier();s*=a;const i=this.comboSystem.getCombo();this.comboSystem.hit();const o=this.comboSystem.getCombo();o%10===0&&o>i&&this.soundManager.playCombo(o/10)}this.hud.recordDamage(s),this.damageBatch+=s,t&&(this.critBatch=!0)}applyDamageBatch(){if(this.damageBatch<=0)return;const e=this.damageBatch,t=this.critBatch;if(this.mode==="normal"&&this.ball){const s=this.ball.takeDamage(e);this.store.addPoints(e),this.damageNumberSystem.spawnDamageNumber(this.ball.x,this.ball.y-this.ball.radius-20,e,t),s&&this.onBallDestroyed()}else if(this.mode==="boss"&&this.bossBall){const s=this.bossBall.takeDamage(e),i=this.store.getState().subUpgrades.alien_cookbook?2:1;this.store.addPoints(e*2*i);const o=this.bossBall.getPosition();if(this.damageNumberSystem.spawnDamageNumber(o.x,o.y-this.bossBall.radius-40,e,t),this.userSettings.highGraphics&&Math.random()<.3){const n=t?"#ffff00":"#ffffff";this.particleSystem.spawnParticles({x:o.x+(Math.random()-.5)*this.bossBall.radius,y:o.y+(Math.random()-.5)*this.bossBall.radius,count:t?10:5,color:n,spread:Math.PI,speed:150,size:t?4:3,life:.6,glow:!1})}s&&(this.onBossDestroyed(),this.userSettings.highGraphics&&this.particleSystem.spawnExplosion(o.x,o.y,"#ff0000"))}this.damageBatch=0,this.critBatch=!1}onBallDestroyed(){this.damageBatch>0&&this.applyDamageBatch();const e=this.store.getState();this.store.incrementAlienKill();const t=Math.floor(5+e.level*2),s=this.upgradeSystem.getBonusXP(e)*t;e.experience+=s;const a=U.getExpRequired(e.level);e.experience>=a?(e.experience-=a,e.level++,this.store.updateMaxLevel(),this.soundManager.playLevelUp(),U.isBossLevel(e.level)?this.showBossDialog():setTimeout(()=>{this.createBall()},400)):setTimeout(()=>{this.createBall()},400),this.store.setState(e)}onBossDefeated(){const e=this.store.getState();this.store.incrementBossKill();const t=Math.floor(e.level*1e4);this.store.addPoints(t),e.experience=0,e.level++,this.store.updateMaxLevel(),this.store.setState(e),this.soundManager.playBossDefeat();const s=document.getElementById("boss-progress-container");s&&(s.style.display="none"),setTimeout(()=>{this.startTransitionToNormal()},600)}onBossDestroyed(){this.onBossDefeated()}showBossDialog(){const e=document.getElementById("boss-dialog");e&&(e.style.display="flex",this.soundManager.playBossAppear())}startBossFight(){this.startTransitionToBoss()}startTransitionToBoss(){this.mode="transition",this.transitionTime=0,this.comboSystem.reset(),this.bossClickProgress=0;const e=document.getElementById("boss-controls");e&&(e.style.display="none"),setTimeout(()=>{this.createBoss(),this.mode="boss",e&&(e.style.display="block");const t=document.getElementById("boss-progress-container");t&&(t.style.display="block"),this.updateBossProgressBar()},this.transitionDuration*500)}updateBossProgressBar(){const e=document.getElementById("boss-progress-fill"),t=document.getElementById("boss-progress-text");e&&(e.style.width=`${this.bossClickProgress.toString()}%`),t&&(t.textContent=`${Math.floor(this.bossClickProgress).toString()}%`)}startTransitionToNormal(){this.mode="transition",this.transitionTime=0,this.playerShip=null,this.bossProjectiles=[];const e=document.getElementById("boss-controls");e&&(e.style.display="none"),setTimeout(()=>{this.createBall(),this.mode="normal"},this.transitionDuration*500)}triggerShake(e,t){this.shakeAmount=e,this.shakeTime=t}spawnBossProjectiles(){if(!this.bossBall||!this.playerShip)return;const e=this.bossBall.getPosition(),t=this.playerShip.getPosition(),s=this.bossBall.getAttackPattern(),a=200;if(s==="single")this.bossProjectiles.push(new D(e.x,e.y,t.x,t.y,a));else if(s==="spread"){const i=Math.atan2(t.y-e.y,t.x-e.x),o=Math.PI/6;for(let n=-1;n<=1;n++){const l=i+n*o,c=e.x+Math.cos(l)*1e3,h=e.y+Math.sin(l)*1e3;this.bossProjectiles.push(new D(e.x,e.y,c,h,a))}}else for(let o=0;o<8;o++){const n=o/8*Math.PI*2,l=e.x+Math.cos(n)*1e3,c=e.y+Math.sin(n)*1e3;this.bossProjectiles.push(new D(e.x,e.y,l,c,a*1.2))}}update(e){const t=this.store.getState();if(this.playTimeAccumulator+=e,this.playTimeAccumulator>=1&&(this.store.addPlayTime(Math.floor(this.playTimeAccumulator)),this.playTimeAccumulator=this.playTimeAccumulator%1),this.passiveGenAccumulator+=e,this.passiveGenAccumulator>=1){const s=this.upgradeSystem.getPassiveGen(t);s>0&&this.store.addPoints(s),this.passiveGenAccumulator=this.passiveGenAccumulator%1}try{const s=this.hud.calculateDPS(),a=this.upgradeSystem.getPassiveGen(t),i=this.upgradeSystem.getCritChance(t);this.hud.updateStats(s,a,i)}catch{}if(this.achievementSystem.checkAchievements(t),this.mode==="transition"&&(this.transitionTime+=e,this.transitionTime>=this.transitionDuration&&(this.transitionTime=0)),this.ball?.update(e),this.bossBall?.update(e,this.canvas.getWidth(),this.canvas.getHeight()),this.laserSystem.update(e,(s,a)=>{this.handleDamage(s,a)}),this.rippleSystem.update(e),this.particleSystem.update(e),this.damageNumberSystem.update(e),this.comboSystem.update(e),Math.random()<.01&&this.debugLaserStats(),this.batchTimer+=e,this.batchTimer>=this.batchInterval&&(this.applyDamageBatch(),this.batchTimer=0),this.userSettings.highGraphics&&this.mode==="boss"&&this.bossBall){const s=this.bossBall.getPosition(),a=this.bossBall.getPhase();let i="#ffffff";a===3?i="#ff0000":a===2&&(i="#ffaa00"),this.particleSystem.spawnTrail(s.x,s.y,i)}if(this.mode==="normal")for(const s of this.ships)s.rotate(e);this.mode==="boss"?(this.bossClickProgress>0&&(this.bossClickProgress=Math.max(0,this.bossClickProgress-this.bossProgressDecayRate*e),this.updateBossProgressBar()),this.playerShip&&((this.keys.has("arrowleft")||this.keys.has("a"))&&this.playerShip.rotate(-1,e),(this.keys.has("arrowright")||this.keys.has("d"))&&this.playerShip.rotate(1,e),(this.keys.has("arrowup")||this.keys.has("w"))&&this.playerShip.thrust(e),(this.keys.has(" ")||this.keys.has("spacebar"))&&this.shootLaser(),this.playerShip.update(e,this.canvas.getWidth(),this.canvas.getHeight()),this.shootCooldown>0&&(this.shootCooldown=Math.max(0,this.shootCooldown-e)),this.bossBall&&this.bossBall.shouldAttack()&&this.spawnBossProjectiles(),this.bossProjectiles=this.bossProjectiles.filter(s=>{const a=s.update(e);if(!a&&this.playerShip){const i=this.playerShip.getPosition();if(s.checkCollision(i,15))return this.triggerShake(3,.1),!0}return!a}))):this.mode==="normal"&&this.autoFireSystem.update(e,!0,this.upgradeSystem.getFireCooldown(t),s=>{s>0&&this.fireSingleShip(s)}),this.saveTimer+=e,this.saveTimer>=this.saveInterval&&(k.save(t),this.saveTimer=0),this.shakeTime>0&&(this.shakeTime=Math.max(0,this.shakeTime-e))}render(){this.canvas.clear();const e=this.canvas.getContext();if(e.save(),this.shakeTime>0){const t=this.shakeAmount*(this.shakeTime/.1),s=(Math.random()-.5)*t,a=(Math.random()-.5)*t;e.translate(s,a)}if(this.mode==="transition")this.renderTransition();else{if(this.userSettings.highGraphics&&this.particleSystem.draw(this.draw),this.userSettings.showRipples&&this.rippleSystem.draw(this.draw),this.laserSystem.draw(this.draw),this.ball?.draw(this.draw),this.bossBall?.draw(this.draw),this.mode==="boss"){this.playerShip?.draw(this.draw);for(const t of this.bossProjectiles)t.draw(this.draw)}else for(const t of this.ships)t.draw(this.draw);this.damageNumberSystem.draw(this.draw),this.mode==="boss"&&this.comboSystem.draw(this.draw,this.canvas.getWidth())}e.restore()}renderTransition(){const e=this.transitionTime/this.transitionDuration,t=Math.sin(e*Math.PI);this.draw.setAlpha(t);const s=this.canvas.getCenterX(),a=this.canvas.getCenterY(),i=Math.max(this.canvas.getWidth(),this.canvas.getHeight());for(let o=0;o<5;o++){const n=i*(e+o*.2);this.draw.setStroke("#fff",2),this.draw.circle(s,a,n,!1)}this.draw.resetAlpha()}start(){this.loop.start()}resetGame(){k.clear(),this.store.setState(k.load()),this.mode="normal",this.createBall(),this.createShips(),this.laserSystem.clear(),this.rippleSystem.clear(),this.particleSystem.clear(),this.damageNumberSystem.clear(),this.comboSystem.reset(),this.autoFireSystem.reset(),this.saveTimer=0}handleResize(){if(this.ball&&(this.ball.x=this.canvas.getCenterX(),this.ball.y=this.canvas.getCenterY()),this.bossBall){const e=this.canvas.getCenterX(),t=this.canvas.getCenterY();this.bossBall.x=e,this.bossBall.y=t}this.ships.length>0&&this.mode==="normal"&&this.createShips(),this.playerShip&&(this.playerShip.x=this.canvas.getCenterX(),this.playerShip.y=this.canvas.getHeight()-100)}}function R(){new ge().start()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",R):R();
//# sourceMappingURL=index-pjX7IlIu.js.map
